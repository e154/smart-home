<div class="docs-section">
    <h2 id="overview" class="page-header">Обзор</h2>

    <p><strong>Система умного дома</strong> имеет модульную структуру, и состоит из следующих частей:</p>
    <ul class="list-unstyled">
        <li><strong>Сервер</strong> - Основной системный модуль, предоставление api для внешних служб, контроль доступа,
            исполнение процессов, логирование, оповещенние, реагирование на события по заложенному сценарию.</li>
        <li><strong>Конфигуратор</strong> - Клиентский модуль подключается к серверу по API, позволяет конфигурировать
            систему под свои нужды, требуется как првило на этапе конфигурации.</li>
        <li><strong>Нода</strong> - посредник связи сервера с активными устройствами, позволяет связать один сервер с
            множеством териториально удалённых устройств по сети интернет, локальной сети, или по различным шифрованным туннелям.
        Работает по принципу клиент сервер. Стартует и ожидает соединения на заданном ADDRESS:PORT. Сервер подключается к ноде
        по требованию сценария, либо доступности последней.</li>
        <li><strong>Монитор</strong>(в разработке) - мобильное клиентское приложение android, ios.</li>
    </ul>

    <p>Для работы <strong>системы умного дома</strong> требуется запущенный сервер, и минимум одна локальная нода, либо одна запущенная
        нода в том же сегменте сети. Конфигуратор требуется только на этапе конфигурации.</p>

    <p>На данный момент общение с исполнительными устройствами возможно только по адаптированному портоколу modbus.
        В дальнейшем этот список будет расширен. Если Вам требуется добавить какой-то свой вид связи, напишите нам, либо
        создайте реквест с предложением в репозиторий <a href="https://github.com/e154/smart-home">Сервер</a>, <a href="https://github.com/e154/smart-home-node">Нода</a>.

        Модифицированный modbus подразумевает соответствующее установленное ПО на ваше исполнительное устройство, простой пример устройства
        со схемой и программой прошивки для <strong>AVR mega 168pu</strong> управляющего розетой, легко поддающееся модификации под более сложные задачи можно
        посмотреть в репозитории - <a href="https://github.com/e154/smart-home-socket">пример устройства управления розеткой</a>.
    </p>

    <p>Схематичная сеть <strong>системы умного дома</strong>:</p>

    <img src="/img/default_network.svg" title="Схематичная сеть умного дома" alt="Схематичная сеть умного дома">
</div>

<div class="docs-section">
    <h2 id="requirements" class="page-header">Системные требования</h2>

    <p>Поддерживаемые операционные системы:</p>
    <ul>
        <li><strong>macOS</strong> 386 10.6</li>
        <li><strong>macOS</strong> amd64 10.6</li>
        <li><strong>linux</strong> 386</li>
        <li><strong>linux</strong> amd64</li>
        <li><strong>linux</strong> arm-5</li>
        <li><strong>linux</strong> arm-6</li>
        <li><strong>linux</strong> arm-7</li>
        <li><strong>linux</strong> arm-64</li>
        <li><strong>linux</strong> mips64</li>
        <li><strong>linux</strong> mips64le</li>
        <li><strong>windows</strong> 386</li>
        <li><strong>windows</strong> amd64</li>
    </ul>

    <p>Системные требования:</p>
    <ul>
        <li>50 MB RAM Минимальные</li>
        <li>100 MB RAM Рекомендуемые</li>
    </ul>

</div>


<div class="docs-section">

{% callout info %}
#### Для работы серверов не требуется запуск графической оболочки
{% endcallout %}

</div>

<div class="docs-section">
    <h2 id="download" class="page-header">Загрузка</h2>

    <p>Готовые архиве содержат все исполняемые фйлы под все поддерживаемые архитектуры и операционные системы.</p>

    <div class="row download-block">
        <div class="col-md-4 download-item text-center">
            <h3>{% t download.server %}</h3>
            <p class="text-muted">{% t download.server_description %}</p>
            <a id="smart-home-server" href="https://github.com/e154/smart-home/releases" target="_blank" class="btn btn-primary btn-xl sr-button">{% t download.download %}</a>
        </div>
        <div class="col-md-4 download-item text-center">
            <h3>{% t download.configurator %}</h3>
            <p class="text-muted">{% t download.configurator_description %}</p>
            <a id="smart-home-configurator" href="https://github.com/e154/smart-home-configurator/releases" target="_blank" class="btn btn-primary btn-xl sr-button">{% t download.download %}</a>
        </div>
        <div class="col-md-4 download-item text-center">
            <h3>{% t download.node %}</h3>
            <p class="text-muted">{% t download.node_description %}</p>
            <a id="smart-home-node" href="https://github.com/e154/smart-home-node/releases" target="_blank" class="btn btn-primary btn-xl sr-button">{% t download.download %}</a>
        </div>
    </div>
</div>

<div class="docs-section">
    <h2 id="whats-included">Что входит в пакеты</h2>

    <h3 id="server">Сервер</h3>

    <p>Список файлов в корне архива.</p>

{% highlight bash %}
├── conf
├── contributors.txt
├── data
├── dump.sql
├── LICENSE
├── README.md
├── server-darwin-10.6-386
├── server-darwin-10.6-amd64
├── server-linux-386
├── server-linux-amd64
├── server-linux-arm-5
├── server-linux-arm-6
├── server-linux-arm64
├── server-linux-arm-7
├── server-linux-mips64
├── server-linux-mips64le
├── server-windows-4.0-386.exe
└── server-windows-4.0-amd64.exe
{% endhighlight %}

    <ul class="list-unstyled">
        <li><strong>conf</strong> - директория конфигурационных файлов</li>
        <li><strong>contributors.txt</strong> - текстовый файл, список разработчиков системы умный дом</li>
        <li><strong>data</strong> - директория хранения рабочих файлов иконки, изображения</li>
        <li><strong>dump.sql</strong> - дамп sql базы данных</li>
        <li><strong>LICENSE</strong> - текстовый файл лицензионного соглашения</li>
        <li><strong>README.md</strong> - текстовый файл краткой вводной информации</li>
        <li><strong>server-*</strong> - Платформо зависимый исполняемый файл</li>
    </ul>

    <h3 id="configurator">Конфигуратор</h3>

    <p>Список файлов в корне архива.</p>

{% highlight bash %}
├── build
├── conf
├── views
├── configurator-darwin-10.6-386
├── configurator-darwin-10.6-amd64
├── configurator-linux-386
├── configurator-linux-amd64
├── configurator-linux-arm-5
├── configurator-linux-arm-6
├── configurator-linux-arm64
├── configurator-linux-arm-7
├── configurator-linux-mips64
├── configurator-linux-mips64le
├── configurator-windows-4.0-386.exe
├── configurator-windows-4.0-amd64.exe
├── contributors.txt
├── LICENSE
└── README.md
{% endhighlight %}

    <ul class="list-unstyled">
        <li><strong>build</strong> - директория фронтенд приложения</li>
        <li><strong>conf</strong> - директория конфигурационных файлов</li>
        <li><strong>views</strong> - директория html шаблонов страниц входа,выхода,восстановления пароля</li>
        <li><strong>LICENSE</strong> - текстовый файл лицензионного соглашения</li>
        <li><strong>README.md</strong> - текстовый файл краткой вводной информации</li>
        <li><strong>contributors.txt</strong> - текстовый файл, список разработчиков системы умный дом</li>
        <li><strong>configurator-*</strong> - Платформо зависимый исполняемый файл</li>
    </ul>

    <h3 id="node">Нода</h3>

    <p>Список файлов в корне архива.</p>

{% highlight bash %}
├── conf
├── contributors.txt
├── LICENSE
├── node-darwin-10.6-386
├── node-darwin-10.6-amd64
├── node-linux-386
├── node-linux-amd64
├── node-linux-arm-5
├── node-linux-arm-6
├── node-linux-arm64
├── node-linux-arm-7
├── node-linux-mips64
├── node-linux-mips64le
├── node-windows-4.0-386.exe
├── node-windows-4.0-amd64.exe
└── README.md
{% endhighlight %}

    <ul class="list-unstyled">
        <li><strong>conf</strong> - директория конфигурационных файлов</li>
        <li><strong>LICENSE</strong> - текстовый файл лицензионного соглашения</li>
        <li><strong>README.md</strong> - текстовый файл краткой вводной информации</li>
        <li><strong>contributors.txt</strong> - текстовый файл, список разработчиков системы умный дом</li>
        <li><strong>node-*</strong> - Платформо зависимый исполняемый файл</li>
    </ul>
</div>

<div class="docs-section">
    <h2 id="install">Установка</h2>

    <p>Будет произведена базовая установка системы <strong>Умный дом</strong> на сервер под операционной системой linux Debian.
    С не большими изменениями установка будет схожа и для других операционных систем.</p>

    <p>План действий:</p>

    <ul>
        <li><a href="#install-mkdir">Создание директорий</a></li>
        <li><a href="#install-download-and-unpack">Скачивание и распаковка</a></li>
        <li><a href="#install-server-conf">Настройка сервера</a></li>
        <li><a href="#install-configuration-conf">Настройка конфигуратора</a></li>
        <li><a href="#install-node-conf">Настройка ноды</a></li>
        <li><a href="#install-mysql">База mysql</a></li>
    </ul>

    <p></p>

    <div class="row">
        <div class="col-md-6">
            <img src="/img/default_network2.svg" title="Схематичная сеть умного дома" alt="Схематичная сеть умного дома">
        </div>
    </div>


    <p>Информация о системе на которой производилось тестовое развёртывание:</p>

{% highlight bash %}
delta54@darkstar:tmp$ uname -a
Linux darkstar 3.16.0-4-amd64 #1 SMP Debian 3.16.36-1+deb8u2 (2016-10-19) x86_64 GNU/Linux
{% endhighlight %}

{% highlight bash %}
delta54@darkstar:tmp$ cat /etc/*release*
PRETTY_NAME="Debian GNU/Linux 8 (jessie)"
{% endhighlight %}

    <h3 id="install-mkdir">Создание директорий</h3>

    <p>Рекомендуемая директория установки сервера /opt/smart-home. Подготовьте директорию, укажите требуемые права доступа на директорию
        /opt/smart-home
    </p>

{% highlight bash %}
sudo mkdir -p /opt/smart-home
sudo chown $USER:$USER /opt/smart-home -R
mkdir -p /opt/smart-home/server
mkdir -p /opt/smart-home/configurator
mkdir -p /opt/smart-home/node
{% endhighlight %}

    <h3 id="install-download-and-unpack">Скачивание и распаковка</h3>

    <p>Скачаем последний релиз сервер, и распакуем в директории <strong>server</strong></p>

{% highlight bash %}
cd /opt/smart-home/server
wget https://github.com/e154/smart-home/releases/download/v75/smart-home-server.tar.gz
tar -zxvf smart-home-server.tar.gz
{% endhighlight %}

    <p>В директории <strong>data</strong> хранятся файлы изображений, ключи шифрования, требуемые как серверу, так и коиентским приложения.
        Вынесите директорию <strong>data</strong> на один уровень выше.</p>

{% highlight bash %}
cd /opt/smart-home/server
mv data ../
{% endhighlight %}

    <p>Тоже самое сделаем для конфигуратора, и ноды</p>

{% highlight bash %}
cd /opt/smart-home/configurator
wget https://github.com/e154/smart-home-configurator/releases/download/v22/smart-home-configurator.tar.gz
tar -zxvf smart-home-configurator.tar.gz
cd /opt/smart-home/node
wget https://github.com/e154/smart-home-node/releases/download/v45/smart-home-node.tar.gz
tar -zxvf smart-home-node.tar.gz
{% endhighlight %}

    <p>В итоге мы должны получит следующую корневую структуру:</p>

{% highlight bash %}
cd /opt/smart-home
├── data
├── node
├── configurator
└── server
{% endhighlight %}

    <h3 id="install-server-conf">Настройка сервера</h3>

    <p>Важные переменные в конфигурационном файле серевера:</p>
    <ul>
        <li><strong>httpaddr</strong> - адрес сервера REST API</li>
        <li><strong>httpport</strong> - порт сервера REST API</li>
        <li><strong>data_dir</strong> - директория хранения общих файлов</li>
        <li><strong>db_user</strong> - пользователь для соединени mysql</li>
        <li><strong>db_pass</strong> - пароль доступка к mysql</li>
        <li><strong>db_host</strong> - адрес сервера mysql</li>
        <li><strong>db_name</strong> - название базы mysql</li>
        <li><strong>db_port</strong> - порт сервера mysql</li>
    </ul>
    <p>Отредактируйте переменную <strong>httpaddr</strong> в /opt/smart-home/server/conf/app.conf,
    адресс 0.0.0.0 - означает, что сервер будет принимать соединение со всех сетевых интерфейсов.</p>

{% highlight bash %}
httpaddr = "0.0.0.0"
{% endhighlight %}

    <p>По желанию отредактируйте переменную <strong>httpport</strong> в /opt/smart-home/server/conf/prod/app.conf,
    или оставьте без изменений, это порт на котором сервер ожидает REST API соединения, со всех клиентских
    приложений.</p>

{% highlight bash %}
httpport = 3000
{% endhighlight %}

    <p>Для работы сервера требуется подключение к базе mysql. По желанию отредактируйте файл /opt/smart-home/server/conf/prod/db.conf,
        или оставьте без изменений, и настройте базу в соответствии с установленными значениями.</p>

{% highlight bash %}
db_user = smarthome
db_pass = smarthome
db_host = "127.0.0.1"
db_name = smarthome
db_port = "3306"
db_type = mysql
{% endhighlight %}

    <h3 id="install-configuration-conf">Настройка конфигуратора</h3>

    <p>Конфиг файлы конфигуратора лежат в директории /opt/smart-home/configurator/conf/
        Важные переменные:</p>
    <ul>
        <li><strong>httpaddr</strong> - адрес веб интерфеса конфигуратора</li>
        <li><strong>httpport</strong> - порт веб интерфеса конфигуратора</li>
        <li><strong>serveraddr</strong> - порт сервера REST API</li>
        <li><strong>serverport</strong> - порт сервера REST API</li>
        <li><strong>data_dir</strong> - директория хранения общих файлов</li>
    </ul>

    <h3 id="install-node-conf">Настройка ноды</h3>

    <p>Конфигурационный файл ноды лежит в директории /opt/smart-home/node/conf/  Если файл node.conf, создайте его из файла примера:</p>

{% highlight bash %}
cp /opt/smart-home/node/conf/node.sample.conf node.conf
{% endhighlight %}

{% highlight bash %}
cat /opt/smart-home/node/conf/node.conf
app_version=0.1.0
ip=127.0.0.1
port=3001
baud=19200
timeout=2
stopbits=2
{% endhighlight %}

    <ul>
        <li><strong>app_version</strong> - версия внутреннего api ноды</li>
        <li><strong>ip</strong> - адрес ожидания соединения от сервера</li>
        <li><strong>port</strong> - порт ожидания соединения от сервера</li>
        <li><strong>baud</strong> - скорость работы порта ввода вывода, используется если с сервера пришёл запрос на
        обращение к устройству, но baud не был указан</li>
        <li><strong>timeout</strong> - используется при обработке ошибок связи с устройствами</li>
        <li><strong>stopbits</strong> - стоп бит, используется в общении с устройствами</li>
    </ul>

    <h3 id="install-mysql">База mysql</h3>

</div>

<div class="docs-section">

{% callout danger %}
#### Не запускайте сервера от пользователя root, это ограничение накладывается требованиями безопасности эксплуатации системы
{% endcallout %}

</div>

<div class="docs-section">

    <h2 id="install-from-source">Сборка из исходного кода</h2>


</div>
