---
weight: 3
title: overview
groups:
    - "getting_started"
---

<div class="docs-section">
    <h2 id="install">Установка</h2>

    <p>Будет произведена базовая установка системы <strong>Умный дом</strong> на сервер под операционной системой linux Debian.
        С не большими изменениями установка будет схожа и для других операционных систем.</p>

    <p>План действий:</p>

    <ul>
        <li><a href="#install-mkdir">Создание директорий</a></li>
        <li><a href="#install-download-and-unpack">Скачивание и распаковка</a></li>
        <li><a href="#install-server-conf">Настройка сервера</a></li>
        <li><a href="#install-configuration-conf">Настройка конфигуратора</a></li>
        <li><a href="#install-node-conf">Настройка ноды</a></li>
        <li><a href="#install-mysql">База mysql</a></li>
    </ul>

    <p></p>

    <div class="row">
        <div class="col-md-6">
            <img src="/smart-home/img/default_network2.png" title="Схематичная сеть умного дома" alt="Схематичная сеть умного дома">
        </div>
    </div>


    <p>Информация о системе на которой производилось тестовое развёртывание:</p>

{{< highlight bash >}}
delta54@darkstar:tmp$ uname -a
Linux darkstar 3.16.0-4-amd64 #1 SMP Debian 3.16.36-1+deb8u2 (2016-10-19) x86_64 GNU/Linux
{{< /highlight >}}

{{< highlight bash >}}
delta54@darkstar:tmp$ cat /etc/*release*
PRETTY_NAME="Debian GNU/Linux 8 (jessie)"
{{< /highlight >}}

    <h3 id="install-mkdir">Создание директорий</h3>

    <p>Рекомендуемая директория установки сервера /opt/smart-home. Подготовьте директорию, укажите требуемые права доступа на директорию
        /opt/smart-home
    </p>

{{< highlight bash >}}
sudo mkdir -p /opt/smart-home
sudo chown $USER:$USER /opt/smart-home -R
mkdir -p /opt/smart-home/server
mkdir -p /opt/smart-home/configurator
mkdir -p /opt/smart-home/node
{{< /highlight >}}

    <h3 id="install-download-and-unpack">Скачивание и распаковка</h3>

    <p>Скачаем последний релиз сервер, и распакуем в директории <strong>server</strong></p>

{{< highlight bash >}}
cd /opt/smart-home/server
wget https://github.com/e154/smart-home/releases/download/.../smart-home-server.tar.gz
tar -zxvf smart-home-server.tar.gz
{{< /highlight >}}

    <p>В директории <strong>data</strong> хранятся файлы изображений, ключи шифрования, требуемые как серверу, так и коиентским приложения.
        Вынесите директорию <strong>data</strong> на один уровень выше.</p>

{{< highlight bash >}}
cd /opt/smart-home/server
mv data ../
{{< /highlight >}}

    <p>Тоже самое сделаем для конфигуратора, и ноды</p>

{{< highlight bash >}}
cd /opt/smart-home/configurator
wget https://github.com/e154/smart-home-configurator/releases/download/.../smart-home-configurator.tar.gz
tar -zxvf smart-home-configurator.tar.gz
cd /opt/smart-home/node
wget https://github.com/e154/smart-home-node/releases/download/.../smart-home-node.tar.gz
tar -zxvf smart-home-node.tar.gz
{{< /highlight >}}

    <p>В итоге мы должны получит следующую корневую структуру:</p>

{{< highlight bash >}}
cd /opt/smart-home
├── data
├── node
├── configurator
└── server
{{< /highlight >}}

    <h3 id="install-server-conf">Настройка сервера</h3>

    <p>Важные переменные в конфигурационном файле серевера:</p>
    <ul>
        <li><strong>httpaddr</strong> - адрес сервера REST API</li>
        <li><strong>httpport</strong> - порт сервера REST API</li>
        <li><strong>data_dir</strong> - директория хранения общих файлов</li>
        <li><strong>db_user</strong> - пользователь для соединени mysql</li>
        <li><strong>db_pass</strong> - пароль доступка к mysql</li>
        <li><strong>db_host</strong> - адрес сервера mysql</li>
        <li><strong>db_name</strong> - название базы mysql</li>
        <li><strong>db_port</strong> - порт сервера mysql</li>
    </ul>
    <p>Отредактируйте переменную <strong>httpaddr</strong> в /opt/smart-home/server/conf/app.conf,
        адресс 0.0.0.0 - означает, что сервер будет принимать соединение со всех сетевых интерфейсов.</p>

{{< highlight bash >}}
httpaddr = "0.0.0.0"
{{< /highlight >}}

    <p>По желанию отредактируйте переменную <strong>httpport</strong> в /opt/smart-home/server/conf/prod/app.conf,
        или оставьте без изменений, это порт на котором сервер ожидает REST API соединения, со всех клиентских
        приложений.</p>

{{< highlight bash >}}
httpport = 3000
{{< /highlight >}}

    <p>Для работы сервера требуется подключение к базе mysql. По желанию отредактируйте файл /opt/smart-home/server/conf/prod/db.conf,
        или оставьте без изменений, и настройте базу в соответствии с установленными значениями.</p>

{{< highlight bash >}}
db_user = smarthome
db_pass = smarthome
db_host = "127.0.0.1"
db_name = smarthome
db_port = "3306"
db_type = mysql
{{< /highlight >}}

    <h3 id="install-configuration-conf">Настройка конфигуратора</h3>

    <p>Конфиг файлы конфигуратора лежат в директории /opt/smart-home/configurator/conf/
        Важные переменные:</p>
    <ul>
        <li><strong>httpaddr</strong> - адрес веб интерфеса конфигуратора</li>
        <li><strong>httpport</strong> - порт веб интерфеса конфигуратора</li>
        <li><strong>serveraddr</strong> - порт сервера REST API</li>
        <li><strong>serverport</strong> - порт сервера REST API</li>
        <li><strong>data_dir</strong> - директория хранения общих файлов</li>
    </ul>

    <h3 id="install-node-conf">Настройка ноды</h3>

    <p>Конфигурационный файл ноды лежит в директории /opt/smart-home/node/conf/  Если файл node.conf, создайте его из файла примера:</p>

{{< highlight bash >}}
cp /opt/smart-home/node/conf/node.sample.conf node.conf
{{< /highlight >}}

{{< highlight bash >}}
cat /opt/smart-home/node/conf/node.conf
app_version=0.1.0
ip=127.0.0.1
port=3001
baud=19200
timeout=2
stopbits=2
{{< /highlight >}}

    <ul>
        <li><strong>app_version</strong> - версия внутреннего api ноды</li>
        <li><strong>ip</strong> - адрес ожидания соединения от сервера</li>
        <li><strong>port</strong> - порт ожидания соединения от сервера</li>
        <li><strong>baud</strong> - скорость работы порта ввода вывода, используется если с сервера пришёл запрос на
            обращение к устройству, но baud не был указан</li>
        <li><strong>timeout</strong> - используется при обработке ошибок связи с устройствами</li>
        <li><strong>stopbits</strong> - стоп бит, используется в общении с устройствами</li>
    </ul>

    <h3 id="install-mysql">База mysql</h3>

    <p>Подключимся к консоли mysql, приготовьте пароль для рута:</p>

{{< highlight bash >}}
mysql -u root -p
{{< /highlight >}}

    <p>Создадим базу для сервера <strong>умного дома</strong>:</p>

{{< highlight bash >}}
CREATE DATABASE smarthome;
{{< /highlight >}}

    <p>Создадим нового пользователя, и дадим права на доступ к базе <strong>smarthome</strong> из консоли mysql</p>
    <ul>
        <li><strong>smarthome</strong> - пользователь</li>
        <li><strong>smarthome</strong> - пароль</li>
    </ul>

{{< highlight bash >}}
CREATE USER 'smarthome'@'localhost' IDENTIFIED BY 'smarthome';
GRANT ALL PRIVILEGES ON smarthome . * TO 'smarthome'@'localhost';
FLUSH PRIVILEGES;
{{< /highlight >}}

    <p>осталось импортировать базу</p>

{{< highlight bash >}}
use smarthome
source /opt/smart-home/server/dump.sql
{{< /highlight >}}

    <h3 id="install-exec">Запуск</h3>

    <p>Осталось запустить сервера в фоновом режиме</p>

{{< highlight bash >}}
/opt/smart-home/server/server-linux-amd64 > /dev/null 2>&1 &
/opt/smart-home/configurator/configurator-linux-amd64 > /dev/null 2>&1 &
/opt/smart-home/node/node-linux-amd64 > /dev/null 2>&1 &
{{< /highlight >}}

    <ul>
        <li><strong>nohup</strong> - команда будет продолжать выполняться в фоновом режиме и после того, как пользователь выйдет из системы</li>
        <li><strong>> /dev/null</strong> - выводить все сообщения в данное устройство</li>
        <li><strong>2>&1</strong> - вывод ошибок в стандартный поток</li>
        <li><strong>&</strong> - запуск в фоновом режиме</li>
    </ul>

</div>

<div class="docs-section">

    <div class="boc-callout boc-callout-danger">
        <h4>Не запускайте сервера от пользователя root, это ограничение накладывается требованиями безопасности эксплуатации системы</h4>
    </div>

</div>

<div class="docs-section">

    <h2 id="install-from-source">Сборка из исходного кода</h2>

    <div class="boc-callout boc-callout-info">
        <h4>Извините Раздел в разработке</h4>
    </div>


</div>
