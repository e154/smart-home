<!doctype html><html lang=ru class=no-js>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=generator content="Hugo 0.89.4"><link rel=canonical type=text/html href=https://e154.github.io/smart-home/docs/>
<meta name=ROBOTS content="NOINDEX, NOFOLLOW">
<link rel="shortcut icon" href=/smart-home/favicons/favicon.ico>
<link rel=apple-touch-icon href=/smart-home/favicons/apple-touch-icon-180x180.png sizes=180x180>
<link rel=icon type=image/png href=/smart-home/favicons/favicon-16x16.png sizes=16x16>
<link rel=icon type=image/png href=/smart-home/favicons/favicon-32x32.png sizes=32x32>
<link rel=icon type=image/png href=/smart-home/favicons/android-36x36.png sizes=36x36>
<link rel=icon type=image/png href=/smart-home/favicons/android-48x48.png sizes=48x48>
<link rel=icon type=image/png href=/smart-home/favicons/android-72x72.png sizes=72x72>
<link rel=icon type=image/png href=/smart-home/favicons/android-96x96.png sizes=96x96>
<link rel=icon type=image/png href=/smart-home/favicons/android-144x144.png sizes=144x144>
<link rel=icon type=image/png href=/smart-home/favicons/android-192x192.png sizes=192x192>
<title>Документация | Умный дом</title>
<meta name=description content="

     


 
 
Добро пожаловать в документацию проекта Smart Home! Этот проект представляет собой открытое программное обеспечение, разработанное для …">
<meta property="og:title" content="Документация">
<meta property="og:description" content="Програмный комплекс">
<meta property="og:type" content="website">
<meta property="og:url" content="https://e154.github.io/smart-home/docs/"><meta property="og:site_name" content="Умный дом">
<meta itemprop=name content="Документация">
<meta itemprop=description content="Програмный комплекс"><meta name=twitter:card content="summary">
<meta name=twitter:title content="Документация">
<meta name=twitter:description content="Програмный комплекс">
<link rel=preload href=/smart-home/scss/main.min.8ebd0f8570c5c2da16785e52cb8f20394c6d706e75009a748bfe4c38f7ae92c1.css as=style>
<link href=/smart-home/scss/main.min.8ebd0f8570c5c2da16785e52cb8f20394c6d706e75009a748bfe4c38f7ae92c1.css rel=stylesheet integrity>
<script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script>
</head>
<body class=td-section>
<header>
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
<a class=navbar-brand href=/smart-home/>
<span class=navbar-logo></span><span class="text-uppercase font-weight-bold">Умный дом</span>
</a>
<div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar>
<ul class="navbar-nav mt-2 mt-lg-0">
<li class="nav-item mr-4 mb-2 mb-lg-0">
<a class="nav-link active" href=/smart-home/docs/><span class=active>Документация</span></a>
</li>
<li class="nav-item dropdown mr-4 d-none d-lg-block">
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>
Русский
</a>
<div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink>
<a class=dropdown-item href=/smart-home/en/docs/>English</a>
</div>
</li>
</ul>
</div>
<div class="navbar-nav d-none d-lg-block">
</div>
</nav>
</header>
<div class="container-fluid td-outer">
<div class=td-main>
<div class="row flex-xl-nowrap">
<div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
</div>
<div class="d-none d-xl-block col-xl-2 td-toc d-print-none">
</div>
<main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main>
<div class=td-content>
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.
</p><p>
<a href=/smart-home/docs/>Return to the regular view of this page</a>.
</p>
</div>
<h1 class=title>Документация</h1>
<ul>
<li>1: <a href=#pg-6ad45a4c07647ef1437167d1474c3cfe>Dashboard</a></li>
<ul>
<li>1.1: <a href=#pg-6bea25be625ccc9f997ef24efc5fe445>Entity</a></li>
<li>1.2: <a href=#pg-92a1ce490d5b2270e82a38d7ec4e5f5e>Automation</a></li>
<ul>
<li>1.2.1: <a href=#pg-663b794f38e2652ec4da941b3cce1ac3>Actions</a></li>
<li>1.2.2: <a href=#pg-f398915e040cbcdbf88478a38ed8f7c1>Conditions</a></li>
<li>1.2.3: <a href=#pg-649333aa8bab35b619f6967595405b2d>Triggers</a></li>
</ul>
<li>1.3: <a href=#pg-4177dcddfec763697e168bfb1da48ab1>MQTT</a></li>
<ul>
</ul>
</ul>
<li>2: <a href=#pg-d7eeb6b04c8fab1ac4227a60a3668820>Javascript</a></li>
<ul>
<li>2.1: <a href=#pg-f2652915967ab8262030eca600e1a90e>Actor</a></li>
<li>2.2: <a href=#pg-06d7c61a07052c87c879ee9a9edbc449>Устройство</a></li>
<li>2.3: <a href=#pg-e20be52d8b581bb8e117649fd2265871>entityManager</a></li>
<li>2.4: <a href=#pg-9da4eb53c4b9af52d6292b0dc7500e49>hex2arr</a></li>
<li>2.5: <a href=#pg-0680a74cdf0541bf29b386fcca15603d>marshal</a></li>
<li>2.6: <a href=#pg-a9a66c35c8f75d979eae68e087939baf>Mqtt</a></li>
<li>2.7: <a href=#pg-ec6a1606c6e250e3fe20a21896c0fc43>print</a></li>
<li>2.8: <a href=#pg-9c346cca743f679c9d069ea0fb09421c>unmarshal</a></li>
<li>2.9: <a href=#pg-32950fcaf7eadb1a6af01e12b8d6fccc>Выполнение системных команд</a></li>
<li>2.10: <a href=#pg-25ccac5b56080fcd6d09c27147bbc75c>Логирование</a></li>
<li>2.11: <a href=#pg-def052376f274f2e8abb4278c4e332e3>Временное хранилище</a></li>
<li>2.12: <a href=#pg-35746c1f299b0a71f998b8b6a7ff748a>http запросы</a></li>
</ul>
<li>3: <a href=#pg-bb346cf0596c62e042775b393e7fd9b8>Plugins</a></li>
<ul>
<li>3.1: <a href=#pg-421d1625cd3fc0768a5e9395096f9ba0>Modbus</a></li>
<ul>
<li>3.1.1: <a href=#pg-83ccc62bb21aa1015dc85c4aa89b620d>Modbus rtu</a></li>
<li>3.1.2: <a href=#pg-2ab89625f67635397c493f87afe8c5f2>Modbus tcp</a></li>
</ul>
<li>3.2: <a href=#pg-0369b4decf3a671c6e8e5d18b35ebcef>Alexa</a></li>
<li>3.3: <a href=#pg-ef2b94f1a2a793c6662e60a76d3c9154>Cgminer</a></li>
<ul>
<li>3.3.1: <a href=#pg-e8459aa132552732476b3a393a8246c7>Bitmine</a></li>
</ul>
<li>3.4: <a href=#pg-2cd4f07024ce46a2072e53614567c7fb>CPU</a></li>
<li>3.5: <a href=#pg-d57edab1df39efff0606d11217501497>HDD</a></li>
<li>3.6: <a href=#pg-ad72d5bfe8ed58703be4f95c5433bbbb>Memory</a></li>
<li>3.7: <a href=#pg-646b43ce7e0c9ecd76b7e1b081534840>Memory app</a></li>
<li>3.8: <a href=#pg-95c950e340c5f9306b492b322325c66d>Moon</a></li>
<li>3.9: <a href=#pg-75a67472ccb2a758f48c263d48be08d3>MQTT</a></li>
<li>3.10: <a href=#pg-98e5f3c64adb1e62039387bca695fb54>Node</a></li>
<li>3.11: <a href=#pg-25150d443099ad5064f1a3a39214945d>Отправка сообщений</a></li>
<ul>
<li>3.11.1: <a href=#pg-db0e74844d4ec70b97b7eed2dcaa6fde>Push уведомления</a></li>
<li>3.11.2: <a href=#pg-b9e7dc050746e93f66a3fcdc54072720>HTML5 Уведомления</a></li>
<li>3.11.3: <a href=#pg-ffcf992bf86dcf75fc98ea391689be36>Messagebird</a></li>
<li>3.11.4: <a href=#pg-ae8769291a804111fe0f11577b37bb14>Slack</a></li>
<li>3.11.5: <a href=#pg-3474b889257fbfc72d90e2b2883e468a>Telegram</a></li>
<li>3.11.6: <a href=#pg-8d473157f65e8e52157febb9c1671a23>Twilio</a></li>
<li>3.11.7: <a href=#pg-56027f5b7f86e356eca9778287b4e9b7>Шаблон сообщения</a></li>
</ul>
<li>3.12: <a href=#pg-c611e1f9047c1d78be304f536e42a8a9>Scene</a></li>
<li>3.13: <a href=#pg-0a07d6aae278970d2834de3c5c8ba6fd>Sensor</a></li>
<li>3.14: <a href=#pg-07071769f18bcd958fb6807bfc051634>Sun</a></li>
<li>3.15: <a href=#pg-e2fff1dd07e3240d15c8fe3dda77a94e>Triggers</a></li>
<li>3.16: <a href=#pg-4183e9971a270328fbc64107268e1231>Updater</a></li>
<li>3.17: <a href=#pg-d3da1ca7f3ff8128df9b7a16dfe42fe6>Uptime</a></li>
<li>3.18: <a href=#pg-50e5123a4407c924b74ee84b77d3efbf>Version</a></li>
<li>3.19: <a href=#pg-64ab3664ef92bf81dcd376de6083e938>Weather</a></li>
<ul>
<li>3.19.1: <a href=#pg-4e6b5c2d397c558708e54206184aa268>Met</a></li>
<li>3.19.2: <a href=#pg-b2af757d2aed5c975040722fd880df27>Met</a></li>
</ul>
<li>3.20: <a href=#pg-61b4e27718e29c034a152d0ee2706628>Zigbee2mqtt</a></li>
<li>3.21: <a href=#pg-3d0aa008355dfb5e447bc3db96976c8e>Zone</a></li>
</ul>
</ul>
<div class=content>
<figure>
<img src=/smart-home/layer-scheme.png>
</figure>
<p> </p>
<p> </p>
<p>Добро пожаловать в документацию проекта <strong>Smart Home</strong>! Этот проект представляет собой открытое программное обеспечение, разработанное для умного дома. Он предлагает набор функций и инструментов, позволяющих автоматизировать и контролировать различные аспекты вашего дома, обеспечивая удобство, энергоэффективность и безопасность.</p>
<p>Целью проекта <strong>Smart Home</strong> является создание гибкой и расширяемой платформы, которая позволяет управлять устройствами и системами вашего дома с помощью простого и интуитивно понятного интерфейса. Наша цель - сделать ваш дом более удобным, экологически эффективным и безопасным, предоставляя вам возможность контролировать и настраивать его в соответствии с вашими потребностями и предпочтениями.</p>
<p>Эта документация предназначена для разработчиков, исследователей и энтузиастов, желающих использовать проект <strong>Smart Home</strong> в своих собственных проектах или внести свой вклад в его развитие. Она содержит подробную информацию о различных аспектах проекта, включая архитектуру, установку, настройку, API-интерфейсы и примеры использования.</p>
<p>Прежде чем приступить к использованию <strong>Smart Home</strong>, рекомендуется ознакомиться с этой документацией, чтобы получить полное представление о возможностях и функциях проекта. Если у вас возникнут вопросы или затруднения, не стесняйтесь обратиться к этой документации или обратиться к сообществу проекта для поддержки.</p>
<p>Мы надеемся, что проект <strong>Smart Home</strong> поможет вам создать умный дом, который отвечает вашим потребностям и обеспечивает комфорт, безопасность и эффективность. Спасибо за выбор нашего проекта, и мы желаем вам успехов в его использовании и настройке вашего умного дома!</p>
<p>Документация включает в себя следующие разделы:</p>
<p> </p>
<p> </p>
</div>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-6ad45a4c07647ef1437167d1474c3cfe>1 - Dashboard</h1>
<figure>
<img src=/smart-home/dashboard1.png>
</figure>
<p> </p>
<p> </p>
<p>Проект <strong>Smart Home</strong> включает в себя мощный конструктор панели управления (dashboard), который позволяет пользователям
создавать индивидуальные пользовательские интерфейсы для контроля и управления своим умным домом.</p>
<p>Конструктор панели управления предоставляет гибкий и интуитивно понятный способ настройки визуального представления
умного дома. Пользователи могут создавать персонализированные панели управления, располагая виджеты и элементы управления
в удобном для них порядке.</p>
<p>С использованием конструктора панели управления, вы можете добавлять и настраивать различные виджеты, такие как кнопки
управления, ползунки, датчики, графики и многое другое. Вы можете выбирать и располагать эти виджеты на панели управления
таким образом, чтобы отображать и контролировать нужные вам устройства и функции.</p>
<p>Конструктор панели управления также предоставляет возможность создавать пользовательские макеты и группы виджетов для
организации и структурирования панели управления. Это позволяет пользователю создавать несколько панелей управления для
разных зон или функциональных областей умного дома.</p>
<p>Благодаря гибким настройкам и функциям конструктора панели управления, вы можете создавать уникальные пользовательские
интерфейсы, отображающие и управляющие вашими устройствами и системами умного дома так, как вам удобно. Вы можете выбирать
цветовые схемы, шрифты, размещение виджетов и другие параметры, чтобы создать панель управления, которая соответствует вашим предпочтениям и стилю.</p>
<p>В документации проекта <strong>Smart Home</strong> вы найдете подробные инструкции по использованию конструктора панели управления, а
также примеры создания и настройки пользовательских интерфейсов. Это позволит вам создать индивидуальный и удобный
пользовательский опыт для управления вашим умным домом и взаимодействия с его функциями.</p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-6bea25be625ccc9f997ef24efc5fe445>1.1 - Entity</h1>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>+---------------------+
<span style=color:#000;font-weight:700>|</span>       Entity        <span style=color:#000;font-weight:700>|</span>
+---------------------+
<span style=color:#000;font-weight:700>|</span>      Actions        <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>      State          <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>    Attributes       <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>     Settings        <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>      Metrics        <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>      Storage        <span style=color:#000;font-weight:700>|</span>
+---------------------+
</code></pre></div><p>Это простая схема, которая представляет объект &ldquo;Entity&rdquo;.
Каждый компонент имеет свою роль и функциональность в управлении и мониторинге объекта &ldquo;Entity&rdquo; в умном доме.</p>
<p>Объект &ldquo;Entity&rdquo; является центральным элементом системы Smart Home и объединяет различные аспекты объекта, его состояния,
атрибутов, действий, настроек и метрик. Это позволяет системе эффективно управлять и контролировать объекты в умном доме.</p>
<p>Вот подробное описание компонентов объекта &ldquo;Entity&rdquo;:</p>
<ol>
<li>
<p>Actions (Действия): Объект &ldquo;Entity&rdquo; может принимать и обрабатывать различные действия или команды. Действия представляют
собой операции, которые можно выполнить над объектом, такие как включение, выключение, изменение параметров и т.д.</p>
</li>
<li>
<p>State (Состояние): Объект &ldquo;Entity&rdquo; имеет список состояний, в которые он может переходить. В каждый конкретный момент
времени объект может находиться только в одном состоянии. Примеры состояний могут включать &ldquo;Включено&rdquo;, &ldquo;Выключено&rdquo;,
&ldquo;Режим ожидания&rdquo;, &ldquo;Воспроизведение&rdquo; и т.д.</p>
</li>
<li>
<p>Attributes (Атрибуты): Атрибуты представляют собой хранилище состояния объекта. Это заранее определенный перечень
полей и свойств, который содержит информацию о текущем состоянии объекта. Атрибуты могут быть представлены в виде map[string]any,
где ключ - имя атрибута, а значение - соответствующее значение атрибута.</p>
</li>
<li>
<p>Settings (Настройки): Настройки объекта &ldquo;Entity&rdquo; представляют собой неизменяемый заранее определенный перечень полей и свойств.
Они определяют конфигурационные параметры объекта, которые могут быть установлены во время его настройки. Настройки также могут
быть представлены в виде map[string]any.</p>
</li>
<li>
<p>Metrics (Метрики): Метрики объекта &ldquo;Entity&rdquo; представляют собой информацию о его атрибутах или состоянии, которая используется
для мониторинга и измерения производительности или поведения объекта. Метрики могут включать такие данные, как среднее значение
атрибута, количество изменений состояния и т.д.</p>
</li>
<li>
<p>Storage (Хранилище): Хранилище объекта &ldquo;Entity&rdquo; предоставляет историю изменений его состояния или атрибутов. Оно записывает
и сохраняет предыдущие значения, позволяя отслеживать и анализировать историю изменений объекта. Хранилище может использоваться
для отображения графиков, аналитики или выполнения других операций с историческими данными объекта.</p>
</li>
</ol>
<p>Объект &ldquo;Entity&rdquo; собирает все эти компоненты вместе, обеспечивая унифицированный и гибкий подход
к управлению и мониторингу различных устройств и систем в умном доме.</p>
<p>В системе Smart Home каждый объект &ldquo;Entity&rdquo; реализован на основе определенного плагина. Плагины предоставляют различные
функциональности и возможности для объектов &ldquo;Entity&rdquo; в системе. Некоторые популярные плагины, которые могут быть
использованы для создания объектов &ldquo;Entity&rdquo;, включают плагины sensor, mqtt, weather, automation, и другие.</p>
<p>Когда создается новый объект &ldquo;Entity&rdquo;, он связывается с определенным плагином, который определяет его функциональность и
возможности. Например, если объект &ldquo;Entity&rdquo; представляет собой датчик, то для его реализации может использоваться плагин
sensor. Если объект &ldquo;Entity&rdquo; предназначен для взаимодействия с брокером MQTT, то для него может быть использован плагин mqtt.</p>
<p>Каждый плагин предоставляет свои собственные хэндлеры (обработчики) и методы, которые позволяют объектам &ldquo;Entity&rdquo; выполнять
определенные действия, получать данные, отправлять сообщения и т.д.</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>              +-----------------------+
              <span style=color:#000;font-weight:700>|</span>                       <span style=color:#000;font-weight:700>|</span>
              <span style=color:#000;font-weight:700>|</span>     Smart Home        <span style=color:#000;font-weight:700>|</span>
              <span style=color:#000;font-weight:700>|</span>                       <span style=color:#000;font-weight:700>|</span>
              +-----------------------+
                         <span style=color:#000;font-weight:700>|</span>
                         <span style=color:#000;font-weight:700>|</span>
                         v
              +-----------------------+
              <span style=color:#000;font-weight:700>|</span>                       <span style=color:#000;font-weight:700>|</span>
              <span style=color:#000;font-weight:700>|</span>       Entities        <span style=color:#000;font-weight:700>|</span>
              <span style=color:#000;font-weight:700>|</span>                       <span style=color:#000;font-weight:700>|</span>
              +-----------------------+
                         <span style=color:#000;font-weight:700>|</span>
                         <span style=color:#000;font-weight:700>|</span>
                         v
   +----------------------------------------+
   <span style=color:#000;font-weight:700>|</span>                                        <span style=color:#000;font-weight:700>|</span>
   <span style=color:#000;font-weight:700>|</span>              Plugins                   <span style=color:#000;font-weight:700>|</span>
   <span style=color:#000;font-weight:700>|</span>                                        <span style=color:#000;font-weight:700>|</span>
   +----------------------------------------+
   <span style=color:#000;font-weight:700>|</span>             <span style=color:#000;font-weight:700>|</span>           <span style=color:#000;font-weight:700>|</span>              <span style=color:#000;font-weight:700>|</span>
   <span style=color:#000;font-weight:700>|</span>             <span style=color:#000;font-weight:700>|</span>           <span style=color:#000;font-weight:700>|</span>              <span style=color:#000;font-weight:700>|</span>
   v             v           v              v
+----------+ +----------+ +----------+ +----------+
<span style=color:#000;font-weight:700>|</span>          <span style=color:#000;font-weight:700>|</span> <span style=color:#000;font-weight:700>|</span>          <span style=color:#000;font-weight:700>|</span> <span style=color:#000;font-weight:700>|</span>          <span style=color:#000;font-weight:700>|</span> <span style=color:#000;font-weight:700>|</span>          <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>  Plugin  <span style=color:#000;font-weight:700>|</span> <span style=color:#000;font-weight:700>|</span>  Plugin  <span style=color:#000;font-weight:700>|</span> <span style=color:#000;font-weight:700>|</span>  Plugin  <span style=color:#000;font-weight:700>|</span> <span style=color:#000;font-weight:700>|</span>  Plugin  <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>          <span style=color:#000;font-weight:700>|</span> <span style=color:#000;font-weight:700>|</span>          <span style=color:#000;font-weight:700>|</span> <span style=color:#000;font-weight:700>|</span>          <span style=color:#000;font-weight:700>|</span> <span style=color:#000;font-weight:700>|</span>          <span style=color:#000;font-weight:700>|</span>
+----------+ +----------+ +----------+ +----------+
   <span style=color:#000;font-weight:700>|</span>             <span style=color:#000;font-weight:700>|</span>           <span style=color:#000;font-weight:700>|</span>              <span style=color:#000;font-weight:700>|</span>
   <span style=color:#000;font-weight:700>|</span>             <span style=color:#000;font-weight:700>|</span>           <span style=color:#000;font-weight:700>|</span>              <span style=color:#000;font-weight:700>|</span>
   v             v           v              v
+----------+ +----------+ +----------+ +----------+
<span style=color:#000;font-weight:700>|</span>          <span style=color:#000;font-weight:700>|</span> <span style=color:#000;font-weight:700>|</span>          <span style=color:#000;font-weight:700>|</span> <span style=color:#000;font-weight:700>|</span>          <span style=color:#000;font-weight:700>|</span> <span style=color:#000;font-weight:700>|</span>          <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span> Entity <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>|</span> <span style=color:#000;font-weight:700>|</span> Entity <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#000;font-weight:700>|</span> <span style=color:#000;font-weight:700>|</span> Entity <span style=color:#0000cf;font-weight:700>3</span> <span style=color:#000;font-weight:700>|</span> <span style=color:#000;font-weight:700>|</span> Entity <span style=color:#0000cf;font-weight:700>4</span> <span style=color:#000;font-weight:700>|</span>
<span style=color:#000;font-weight:700>|</span>          <span style=color:#000;font-weight:700>|</span> <span style=color:#000;font-weight:700>|</span>          <span style=color:#000;font-weight:700>|</span> <span style=color:#000;font-weight:700>|</span>          <span style=color:#000;font-weight:700>|</span> <span style=color:#000;font-weight:700>|</span>          <span style=color:#000;font-weight:700>|</span>
+----------+ +----------+ +----------+ +----------+

                     ^
                     <span style=color:#000;font-weight:700>|</span>
                     <span style=color:#000;font-weight:700>|</span>
              +------------------+
              <span style=color:#000;font-weight:700>|</span>                  <span style=color:#000;font-weight:700>|</span>
              <span style=color:#000;font-weight:700>|</span>  Automation      <span style=color:#000;font-weight:700>|</span>
              <span style=color:#000;font-weight:700>|</span>                  <span style=color:#000;font-weight:700>|</span>
              +------------------+
</code></pre></div><p>На схеме представлена общая структура связи между объектами &ldquo;Entity&rdquo;, плагинами и компонентом автоматизации в системе Smart Home.</p>
<ol>
<li>Smart Home является центральной частью системы и координирует взаимодействие между всеми компонентами.</li>
<li>Объекты &ldquo;Entity&rdquo; представляют конкретные устройства, датчики или другие компоненты в системе. Каждый объект &ldquo;Entity&rdquo; может использовать определенный плагин для своей реализации.</li>
<li>Плагины предоставляют функциональность и возможности для объектов &ldquo;Entity&rdquo;. Они содержат логику и методы, которые позволяют объектам &ldquo;Entity&rdquo; взаимодействовать с внешними устройствами, собирать данные, отправлять команды и т.д.</li>
<li>Компонент автоматизации отвечает за создание сценариев и запуск определенных действий на основе условий и триггеров. Он может использовать объекты &ldquo;Entity&rdquo; и их плагины для определения условий, триггеров и действий в сценариях.</li>
</ol>
<p>Такая структура позволяет системе Smart Home быть гибкой и расширяемой, так как новые плагины и объекты &ldquo;Entity&rdquo; могут быть добавлены,
а компонент автоматизации может использовать их для создания разнообразных сценариев и автоматизации действий.</p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-92a1ce490d5b2270e82a38d7ec4e5f5e>1.2 - Automation</h1>
<p>В системе присутствует компонент &ldquo;Automation&rdquo;, который предназначен для реализации сценариев и автоматизированных ответов
на определенные действия или события. Он позволяет создавать и настраивать автоматические действия, которые выполняются при
выполнении определенных условий или триггеров.</p>
<p>Компонент &ldquo;Automation&rdquo; предоставляет возможности для создания сложных сценариев, объединения нескольких действий, проверки
условий и взаимодействия с различными устройствами или сервисами в системе. Каждый сценарий включает в себя три основных
компонента: триггеры (Triggers), условия (Conditions) и действия (Actions).</p>
<p>Вот схематическое представление работы сценария автоматизации:</p>
<pre tabindex=0><code>              +----------------+
              |   Triggers     |
              |   (Триггеры)   |
              +-------+--------+
                      |
                      v
              +----------------+
              |  Conditions    |
              |  (Условия)     |
              +-------+--------+
                      |
                      v
              +----------------+
              |   Actions      |
              |   (Действия)   |
              +----------------+
</code></pre><ol>
<li>
<p>Триггеры (Triggers):</p>
<ul>
<li>Триггеры инициируют выполнение сценария. Они могут быть связаны с событиями, такими как изменение состояния устройства, получение команды от пользователя, срабатывание таймера и другие.</li>
</ul>
</li>
<li>
<p>Условия (Conditions):</p>
<ul>
<li>Условия определяют, должны ли быть выполнены дополнительные проверки, чтобы сценарий мог быть выполнен. Например, условие может проверять текущее время суток, состояние определенного устройства или другие факторы.</li>
</ul>
</li>
<li>
<p>Действия (Actions):</p>
<ul>
<li>Действия определяют задачи, которые должны быть выполнены при выполнении сценария. Это может быть изменение состояния устройств, отправка команды другому устройству, выполнение HTTP-запроса, отправка уведомления и другие действия.</li>
</ul>
</li>
</ol>
<p>Вся система автоматизации строится вокруг этих компонентов, позволяя создавать сложные сценарии, которые реагируют на события и выполняют определенные задачи в умном доме.</p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-663b794f38e2652ec4da941b3cce1ac3>1.2.1 - Actions</h1>
<figure>
<img src=/smart-home/actions_window1.png>
</figure>
<p> </p>
<p> </p>
<p>Действия определяют задачи, которые должны быть выполнены при выполнении сценария. Это может быть изменение состояния
устройств, отправка команды другому устройству, выполнение HTTP-запроса, отправка уведомления и другие действия.</p>
<p>Пример реализации обработчика:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript><span style=color:#000>automationAction = </span><span style=color:#000>(entityId)-&gt;</span>
    <span style=color:#8f5902;font-style:italic>#print &#39;---action---&#39;
</span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#000>Action</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>callAction</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;zigbee2mqtt.` + zigbeePlugId + `&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;ON&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>{})</span>
</code></pre></div>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-f398915e040cbcdbf88478a38ed8f7c1>1.2.2 - Conditions</h1>
<figure>
<img src=/smart-home/condition_window1.png>
</figure>
<p> </p>
<p> </p>
<p>Условие определяет дополнительную проверку, которая должна быть выполнена перед выполнением сценария. Это условие может
проверять текущее состояние устройства или другие факторы. Условие является опциональным компонентом, и если оно присутствует,
то выполнение сценария будет зависеть от его результата.</p>
<p>Пример реализации обработчика:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript><span style=color:#000>automationCondition = </span><span style=color:#000>(entityId)-&gt;</span>
    <span style=color:#8f5902;font-style:italic>#print &#39;---condition---&#39;
</span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#000>entity = </span><span style=color:#000>Condition</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>getEntityById</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;zigbee2mqtt.` + zigbeePlugId + `&#39;</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>!</span><span style=color:#000>entity</span> <span style=color:#ce5c00;font-weight:700>||</span> <span style=color:#ce5c00;font-weight:700>!</span><span style=color:#000>entity</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>state</span> 
        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#204a87;font-weight:700>false</span>
    <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>entity</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>state</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>name</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#39;ON&#39;</span>
        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#204a87;font-weight:700>true</span>
    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#204a87;font-weight:700>false</span>
</code></pre></div><p>Обратите внимание, что условие (Condition) является опциональным компонентом. Если условие присутствует, то перед выполнением
действий будет выполнена проверка условия. Если условие возвращает положительный результат, то действия будут выполнены.
В противном случае, если условие возвращает отрицательный результат или не указано, действия будут выполнены без дополнительной проверки.</p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-649333aa8bab35b619f6967595405b2d>1.2.3 - Triggers</h1>
<figure>
<img src=/smart-home/trigger_window1.png>
</figure>
<p> </p>
<p> </p>
<p>Каждый тип триггера имеет свой собственный обработчик (handler) для выполнения соответствующих действий.</p>
<p>Вот примеры различных типов триггеров и соответствующих им обработчиков:</p>
<ol>
<li><code>TriggerAlexa</code>:</li>
</ol>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript><span style=color:#000>automationTriggerAlexa = </span><span style=color:#000>(msg) -&gt;</span>
  <span style=color:#000>p = </span><span style=color:#000>unmarshal</span> <span style=color:#000>msg</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>payload</span>
  <span style=color:#000>Done</span> <span style=color:#000>p</span>
  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#204a87;font-weight:700>false</span>
</code></pre></div><p>Обработчик <code>automationTriggerAlexa</code> вызывается в ответ на триггер от Amazon Alexa. Он принимает объект сообщения <code>msg</code>
и может выполнять определенные действия, связанные с этим триггером.</p>
<ol start=2>
<li><code>TriggerStateChanged</code>:</li>
</ol>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript><span style=color:#000>automationTriggerStateChanged = </span><span style=color:#000>(msg) -&gt;</span>
  <span style=color:#000>print</span> <span style=color:#4e9a06>&#39;---trigger---&#39;</span>
  <span style=color:#000>p = </span><span style=color:#000>unmarshal</span> <span style=color:#000>msg</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>payload</span>
  <span style=color:#000>Done</span> <span style=color:#000>p</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>new_state</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>state</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>name</span>
  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#204a87;font-weight:700>false</span>
</code></pre></div><p>Обработчик <code>automationTriggerStateChanged</code> вызывается при изменении состояния устройства. Он принимает объект сообщения
<code>msg</code> и может выполнить определенные действия на основе нового состояния устройства.</p>
<ol start=3>
<li><code>TriggerSystem</code>:</li>
</ol>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript><span style=color:#000>automationTriggerSystem = </span><span style=color:#000>(msg) -&gt;</span>
  <span style=color:#000>p = </span><span style=color:#000>unmarshal</span> <span style=color:#000>msg</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>payload</span>
  <span style=color:#000>Done</span> <span style=color:#000>p</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>event</span>
  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#204a87;font-weight:700>false</span>
</code></pre></div><p>Обработчик <code>automationTriggerSystem</code> вызывается в ответ на события системы. Он принимает объект сообщения <code>msg</code> и может
выполнить определенные действия, связанные с этим событием.</p>
<ol start=4>
<li><code>TriggerTime</code>:</li>
</ol>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript><span style=color:#000>automationTriggerTime = </span><span style=color:#000>(msg) -&gt;</span>
  <span style=color:#000>p = </span><span style=color:#000>unmarshal</span> <span style=color:#000>msg</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>payload</span>
  <span style=color:#000>Done</span> <span style=color:#000>p</span>
  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#204a87;font-weight:700>false</span>
</code></pre></div><p>Обработчик <code>automationTriggerTime</code> вызывается по истечении определенного времени. Он принимает объект сообщения <code>msg</code> и
может выполнить определенные действия, связанные с этим временем.</p>
<p>Каждый обработчик триггера может выполнять необходимую логику в ответ на соответствующий триггер, а затем возвращать
значение <code>false</code>, чтобы указать, что дальнейшая обработка не требуется.</p>
<p>Пример реализации:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript><span style=color:#000>automationTriggerStateChanged = </span><span style=color:#000>(msg)-&gt;</span>
    <span style=color:#8f5902;font-style:italic>#print &#39;---trigger---&#39;
</span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#000>p = </span><span style=color:#000>unmarshal</span> <span style=color:#000>msg</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>payload</span>
    <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>!</span><span style=color:#000>p</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>new_state</span> <span style=color:#ce5c00;font-weight:700>||</span> <span style=color:#ce5c00;font-weight:700>!</span><span style=color:#000>p</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>new_state</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>state</span>
        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#204a87;font-weight:700>false</span>
    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>msg</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>new_state</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>state</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>name</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#39;DOUBLE_CLICK&#39;</span>
</code></pre></div>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-4177dcddfec763697e168bfb1da48ab1>1.3 - MQTT</h1>
<p>Система проекта <strong>Smart Home</strong> включает встроенный MQTT брокер, что позволяет обмениваться сообщениями и управлять
устройствами в умном доме с помощью протокола MQTT (Message Queuing Telemetry Transport).</p>
<p>MQTT - это легковесный протокол обмена сообщениями, разработанный для обмена данными между устройствами в сетях с
ограниченной пропускной способностью или низкой надежностью соединения. Он основан на модели издатель-подписчик
(publisher-subscriber) и обеспечивает надежную доставку сообщений между устройствами.</p>
<p>Встроенный MQTT брокер в проекте <strong>Smart Home</strong> предоставляет серверную часть для обработки MQTT сообщений.
Он выполняет следующие функции:</p>
<ol>
<li>
<p>Поддержка издателей и подписчиков: MQTT брокер принимает сообщения от издателей (publishers) и перенаправляет их
подписчикам (subscribers). Это позволяет устройствам в умном доме обмениваться данными и управляться друг другом.</p>
</li>
<li>
<p>Топики и фильтрация: MQTT брокер использует понятие &ldquo;топика&rdquo; (topic) для классификации сообщений. Подписчики могут
подписываться на определенные топики, чтобы получать только интересующие их данные. Брокер выполняет фильтрацию
сообщений и пересылает их только тем подписчикам, которые подписаны на соответствующие топики.</p>
</li>
<li>
<p>Гарантированная доставка сообщений: MQTT брокер обеспечивает надежную доставку сообщений, гарантируя, что сообщения
будут доставлены подписчикам даже при временных проблемах с соединением или недоступности устройств.</p>
</li>
<li>
<p>Управление доступом: MQTT брокер предоставляет возможности для аутентификации и авторизации, что позволяет контролировать
доступ к различным топикам и ограничивать доступ к устройствам и данным в умном доме.</p>
</li>
</ol>
<p>Встроенный MQTT брокер в проекте <strong>Smart Home</strong> упрощает взаимодействие и интеграцию устройств в умном доме. Он предоставляет
стабильную и эффективную среду для обмена данными и управления устройствами с использованием протокола MQTT. Это позволяет
создавать сложные сценарии автоматизации, контролировать состояние устройств и обмениваться данными между различ</p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-d7eeb6b04c8fab1ac4227a60a3668820>2 - Javascript</h1>
<p>Программная логика и приложения в проекте <strong>Smart Home</strong> разрабатываются с использованием языка JavaScript, CoffeeScript и TypeScript.
JavaScript - это широко используемый язык программирования, который обеспечивает гибкость и мощность в создании
интерактивных компонентоа.</p>
<p>Проект <strong>Smart Home</strong> использует JavaScript для написания всех основных компонентов, которые управляют умным домом.
Это включает логику управления устройствами, обработку данных, взаимодействие с внешними API, создание пользовательского
интерфейса и многое другое.</p>
<p>В проекте <strong>Smart Home</strong> вы можете использовать JavaScript для создания правил автоматизации, настройки расписаний,
обработки данных с датчиков, управления освещением, отоплением, системой безопасности и многими другими аспектами вашего
умного дома. JavaScript обеспечивает простоту взаимодействия с устройствами и системами, а также позволяет создавать
пользовательские интерфейсы для управления всеми функциями вашего дома.</p>
<p>Благодаря гибкости и популярности JavaScript, вы можете легко настроить и расширить проект <strong>Smart Home</strong> в соответствии
с вашими потребностями и предпочтениями. Вам предоставляется возможность использовать широкий спектр инструментов и
библиотек JavaScript, чтобы адаптировать проект под ваши уникальные требования и расширить его функциональность.</p>
<p>Независимо от ваших навыков в программировании, JavaScript предоставляет мощный инструментарий для разработки программной
логики и приложений в проекте <strong>Smart Home</strong>.</p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-f2652915967ab8262030eca600e1a90e>2.1 - Actor</h1>
<p>В проекте <strong>Smart Home</strong> в коде JavaScript доступен объект Actor, который представляет упрощенную модль сущности &ldquo;entity&rdquo;.
Объект Actor предоставляет удобные методы и свойства для взаимодействия с состоянием плагинов.</p>
<p>Управление состоянием устройства: Объект Actor предоставляет методы для чтения и установки состояния устройства.
Вы можете проверять текущее состояние устройства и изменять его в соответствии с требованиями.</p>
<div class="alert alert-warning" role=alert>
Объект доступен не во всех областях видимости.
</div>
<p>Объект &ldquo;Actor&rdquo; в проекте <strong>Smart Home</strong> предоставляет следующие методы:</p>
<ol>
<li><code>setState(entityStateParams)</code>: Этот метод позволяет установить состояние актера на основе переданных параметров.</li>
<li>Вы передаете объект <code>entityStateParams</code> в качестве аргумента, содержащий параметры состояния актера, которые нужно</li>
<li>установить. Например:</li>
</ol>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>entityStateParams</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>{</span>
  <span style=color:#000>power</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>true</span><span style=color:#000;font-weight:700>,</span>
  <span style=color:#000>brightness</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>80</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#000;font-weight:700>};</span>

<span style=color:#000>actor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>setState</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>entityStateParams</span><span style=color:#000;font-weight:700>);</span>
</code></pre></div><ol start=2>
<li><code>getSettings() -> Map[string]any</code>: Данный метод возвращает настройки актера в виде ассоциативного массива.</li>
<li>Возвращаемый результат представляет собой карту (Map), где ключами являются строки (string), а значениями могут быть</li>
<li>любые типы данных. Вы можете использовать этот метод для получения настроек актера. Пример использования:</li>
</ol>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>settings</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>actor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>getSettings</span><span style=color:#000;font-weight:700>();</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>settings</span><span style=color:#000;font-weight:700>);</span>
</code></pre></div><p>Методы объекта &ldquo;Actor&rdquo; предоставляют функциональность для установки состояния актера на основе переданных параметров
и получения настроек актера. Вы можете использовать эти методы для работы с актерами в вашем проекте <strong>Smart Home</strong> и
настроить их состояния в соответствии с требованиями.</p>
<hr>
<h3 id=объект-actor>объект Actor</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript><span style=color:#8f5902;font-style:italic># Пример чтения состояния устройства
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>Actor</span>
  <span style=color:#000;font-weight:700>.</span><span style=color:#000>setState</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>entityStateParams</span><span style=color:#000;font-weight:700>)</span>
  <span style=color:#000;font-weight:700>.</span><span style=color:#000>getSettings</span><span style=color:#000>() -&gt;</span> <span style=color:#000>map</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>string</span><span style=color:#000;font-weight:700>]</span><span style=color:#000>any</span>
</code></pre></div><h3 id=объект-entitystateparams>объект entityStateParams</h3>
<table>
<thead>
<tr>
<th>значение</th>
<th>type</th>
<th>описание</th>
</tr>
</thead>
<tbody>
<tr>
<td>new_state</td>
<td>string</td>
<td>наименование нового состояния (не обязательное поле)</td>
</tr>
<tr>
<td>attribute_values</td>
<td>map[string]any</td>
<td>описание атрибутов</td>
</tr>
<tr>
<td>settings_value</td>
<td>map[string]any</td>
<td>описание настоек</td>
</tr>
<tr>
<td>storage_save</td>
<td>bool</td>
<td>признак записи в бд</td>
</tr>
</tbody>
</table>
<hr>
<h3 id=пример-кода>пример кода</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript><span style=color:#000>settings = </span><span style=color:#000>Actor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>getSettings</span><span style=color:#000;font-weight:700>()</span>
<span style=color:#000>headers = </span><span style=color:#000;font-weight:700>[{</span><span style=color:#4e9a06>&#39;apikey&#39;</span><span style=color:#ce5c00;font-weight:700>:</span><span style=color:#000>settings</span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;apikey&#39;</span><span style=color:#000;font-weight:700>]}]</span>
<span style=color:#000>url = </span><span style=color:#4e9a06>&#39;https://webhook.site/2692a589-a5bc-4156-af7d-75875578798f&#39;</span>
<span style=color:#000>res = </span><span style=color:#000>http</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>headers</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>headers</span><span style=color:#000;font-weight:700>).</span><span style=color:#000>get</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>url</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-06d7c61a07052c87c879ee9a9edbc449>2.2 - Устройство</h1>
<p>В проекте <strong>Smart Home</strong> объект &ldquo;Entity&rdquo; является основной единицей и главным объектом, который хранит состояние и настройки устройства.</p>
<p>&ldquo;Entity&rdquo; представляет собой абстракцию конкретного устройства в умном доме. Он содержит информацию о типе устройства, его идентификаторе, текущем состоянии и других настройках.</p>
<p>Основные атрибуты &ldquo;Entity&rdquo; включают:</p>
<ol>
<li>
<p>Тип устройства: Определяет категорию или класс устройства, например, &ldquo;светильник&rdquo;, &ldquo;термостат&rdquo;, &ldquo;дверной замок&rdquo; и т.д.
Это позволяет классифицировать устройства и определить доступные для них операции и настройки.</p>
</li>
<li>
<p>Идентификатор: Уникальный идентификатор, присвоенный устройству, который позволяет однозначно идентифицировать его в
системе умного дома. Это может быть числовое значение, строка или другой формат идентификации.</p>
</li>
<li>
<p>Состояние устройства: Содержит информацию о текущем состоянии устройства, например, &ldquo;включено/выключено&rdquo;,
&ldquo;открыто/закрыто&rdquo;, &ldquo;температура&rdquo; и т.д. Состояние может изменяться в результате операций или событий, связанных с устройством.</p>
</li>
<li>
<p>Настройки устройства: Включает в себя различные параметры и настройки, связанные с конкретным устройством. Например,
это могут быть параметры освещенности для светильника, предпочитаемая температура для термостата и т.д.</p>
</li>
</ol>
<p>&ldquo;Entity&rdquo; является основной абстракцией устройства в проекте <strong>Smart Home</strong> и обеспечивает единый интерфейс для работы с
различными типами устройств. Это позволяет удобно управлять состоянием и настройками устройств, а также создавать гибкие
сценарии автоматизации и взаимодействия между устройствами в вашем умном доме.</p>
<h3 id=свойства-объекта-entity>свойства объекта Entity</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript><span style=color:#000;font-weight:700>{</span>
  <span style=color:#4e9a06>&#34;id&#34;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;sensor.device1&#34;</span><span style=color:#000;font-weight:700>,</span>
  <span style=color:#4e9a06>&#34;type&#34;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;sensor&#34;</span><span style=color:#000;font-weight:700>,</span>
  <span style=color:#4e9a06>&#34;name&#34;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;&#34;</span><span style=color:#000;font-weight:700>,</span>
  <span style=color:#4e9a06>&#34;description&#34;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;device description&#34;</span><span style=color:#000;font-weight:700>,</span>
  <span style=color:#4e9a06>&#34;icon&#34;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>null</span><span style=color:#000;font-weight:700>,</span>
  <span style=color:#4e9a06>&#34;image_url&#34;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>null</span><span style=color:#000;font-weight:700>,</span>
  <span style=color:#4e9a06>&#34;actions&#34;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
    <span style=color:#000;font-weight:700>{</span>
      <span style=color:#4e9a06>&#34;name&#34;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;ENABLE&#34;</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#4e9a06>&#34;description&#34;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;включить&#34;</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#4e9a06>&#34;image_url&#34;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>null</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#4e9a06>&#34;icon&#34;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>null</span>
    <span style=color:#000;font-weight:700>},</span>
    <span style=color:#000;font-weight:700>{</span>
      <span style=color:#4e9a06>&#34;name&#34;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;DISABLE&#34;</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#4e9a06>&#34;description&#34;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;выключить&#34;</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#4e9a06>&#34;image_url&#34;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>null</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#4e9a06>&#34;icon&#34;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>null</span>
    <span style=color:#000;font-weight:700>}</span>
  <span style=color:#000;font-weight:700>],</span>
  <span style=color:#4e9a06>&#34;states&#34;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
    <span style=color:#000;font-weight:700>{</span>
      <span style=color:#4e9a06>&#34;name&#34;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;ENABLED&#34;</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#4e9a06>&#34;description&#34;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;enabled state&#34;</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#4e9a06>&#34;image_url&#34;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>null</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#4e9a06>&#34;icon&#34;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>null</span>
    <span style=color:#000;font-weight:700>},</span>
    <span style=color:#000;font-weight:700>{</span>
      <span style=color:#4e9a06>&#34;name&#34;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;DISABLED&#34;</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#4e9a06>&#34;description&#34;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;disabled state&#34;</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#4e9a06>&#34;image_url&#34;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>null</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#4e9a06>&#34;icon&#34;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>null</span>
    <span style=color:#000;font-weight:700>}</span>
  <span style=color:#000;font-weight:700>],</span>
  <span style=color:#4e9a06>&#34;state&#34;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#4e9a06>&#34;name&#34;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;ENABLED&#34;</span><span style=color:#000;font-weight:700>,</span>
    <span style=color:#4e9a06>&#34;description&#34;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;enabled state&#34;</span><span style=color:#000;font-weight:700>,</span>
    <span style=color:#4e9a06>&#34;image_url&#34;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>null</span><span style=color:#000;font-weight:700>,</span>
    <span style=color:#4e9a06>&#34;icon&#34;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>null</span>
  <span style=color:#000;font-weight:700>},</span>
  <span style=color:#4e9a06>&#34;attributes&#34;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000;font-weight:700>{},</span>
  <span style=color:#4e9a06>&#34;area&#34;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>null</span><span style=color:#000;font-weight:700>,</span>
  <span style=color:#4e9a06>&#34;metrics&#34;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000;font-weight:700>[],</span>
  <span style=color:#4e9a06>&#34;hidden&#34;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>false</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><p>Абстрактный объект &ldquo;Entity&rdquo; в проекте <strong>Smart Home</strong> предоставляет следующие методы:</p>
<ol>
<li><code>setState(state)</code>: Этот метод позволяет установить состояние устройства. Вы передаете новое состояние в качестве</li>
<li>аргумента <code>state</code>, которое будет применено к устройству. Например:</li>
</ol>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#000>entity</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>setState</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;on&#39;</span><span style=color:#000;font-weight:700>);</span>
</code></pre></div><ol start=2>
<li><code>setAttributes(attributes)</code>: Этот метод используется для установки атрибутов устройства. Вы передаете объект</li>
<li><code>attributes</code> в качестве аргумента, содержащий новые атрибуты, которые нужно применить к устройству. Пример использования:</li>
</ol>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>newAttributes</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>{</span>
  <span style=color:#000>brightness</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>80</span><span style=color:#000;font-weight:700>,</span>
  <span style=color:#000>color</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;red&#39;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#000;font-weight:700>};</span>

<span style=color:#000>entity</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>setAttributes</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>newAttributes</span><span style=color:#000;font-weight:700>);</span>
</code></pre></div><ol start=3>
<li><code>getAttributes()</code>: Данный метод позволяет получить текущие атрибуты устройства. Он возвращает объект с текущими</li>
<li>значениями атрибутов. Пример использования:</li>
</ol>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>attributes</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>entity</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>getAttributes</span><span style=color:#000;font-weight:700>();</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>attributes</span><span style=color:#000;font-weight:700>);</span>
</code></pre></div><ol start=4>
<li><code>setMetric(metric, value)</code>: С помощью этого метода можно установить метрику устройства. Вы передаете имя метрики в</li>
<li>аргументе <code>metric</code> и значение метрики в аргументе <code>value</code>. Пример использования:</li>
</ol>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#000>entity</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>setMetric</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;temperature&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>25</span><span style=color:#000;font-weight:700>);</span>
</code></pre></div><ol start=5>
<li><code>callAction(action, params)</code>: Данный метод позволяет вызвать определенное действие на устройстве. Вы передаете имя</li>
<li>действия в аргументе <code>action</code> и необходимые параметры в аргументе <code>params</code>. Пример использования:</li>
</ol>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#000>entity</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>callAction</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;turnOn&#39;</span><span style=color:#000;font-weight:700>);</span>
</code></pre></div><p>Методы объекта &ldquo;Entity&rdquo; предоставляют удобные возможности для управления состоянием, атрибутами, метриками и выполнения
действий на устройстве. Вы можете использовать эти методы для создания логики управления устройствами в вашем проекте
<strong>Smart Home</strong>.</p>
<h3 id=методы-объекта-entity>методы объекта Entity</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript><span style=color:#000>Entity</span>
  <span style=color:#000;font-weight:700>.</span><span style=color:#000>setState</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>stateName</span><span style=color:#000;font-weight:700>)</span>
  <span style=color:#000;font-weight:700>.</span><span style=color:#000>setAttributes</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>key</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>attrs</span><span style=color:#000;font-weight:700>)</span>
  <span style=color:#000;font-weight:700>.</span><span style=color:#000>getAttributes</span><span style=color:#000>() -&gt;</span> <span style=color:#000>attrs</span>
  <span style=color:#000;font-weight:700>.</span><span style=color:#000>setMetric</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>name</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>value</span><span style=color:#000;font-weight:700>)</span>
  <span style=color:#000;font-weight:700>.</span><span style=color:#000>callAction</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>name</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>value</span><span style=color:#000;font-weight:700>)</span>
  <span style=color:#000;font-weight:700>.</span><span style=color:#000>getSettings</span><span style=color:#000>() -&gt;</span> <span style=color:#000>map</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>string</span><span style=color:#000;font-weight:700>]</span><span style=color:#000>any</span>
</code></pre></div><table>
<thead>
<tr>
<th>значение</th>
<th>описание</th>
</tr>
</thead>
<tbody>
<tr>
<td>setState</td>
<td>изменить текущее состояние, <strong>stateName</strong> - наименования будущего состояния</td>
</tr>
<tr>
<td>setAttributes</td>
<td>изменить атрибуты текущего состояния, <strong>attr</strong> - map параметрый {key:val}</td>
</tr>
<tr>
<td>getAttributes</td>
<td>текущее атрибуты устройства, <strong>attrs</strong> - map параметрый {key:val}</td>
</tr>
<tr>
<td>setMetric</td>
<td>обновить метрики устройства, <strong>name</strong> - наименование метрики, <strong>attr</strong> - map параметрый {key:val}</td>
</tr>
<tr>
<td>callAction</td>
<td>иcполнение команды на устройстве, <strong>actionName</strong> - наименование команды, <strong>args</strong> - map параметрый {key:val}</td>
</tr>
</tbody>
</table>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-e20be52d8b581bb8e117649fd2265871>2.3 - entityManager</h1>
<p>В проекте <strong>Smart Home</strong> имеется менеджер устройств &ldquo;Entity Manager&rdquo;, который обеспечивает удобный доступ к устройствам,
их настройкам и текущему состоянию.</p>
<div class="alert alert-success" role=alert>
Функция доступна в любом скрипте системы.
</div>
<p>Менеджер устройств &ldquo;Entity Manager&rdquo; предоставляет набор методов и функций для управления устройствами и получения
информации о них. Некоторые основные возможности &ldquo;Entity Manager&rdquo; включают:</p>
<ol>
<li>
<p><code>getEntity(id) -> Entity</code>: Этот метод позволяет получить объект &ldquo;Entity&rdquo; по его идентификатору. Вы передаете идентификатор устройства в качестве аргумента <code>id</code>, и метод возвращает соответствующий объект &ldquo;Entity&rdquo;.</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>entity</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>entityManager</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>getEntity</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>id</span><span style=color:#000;font-weight:700>);</span>
</code></pre></div></li>
<li>
<p><code>setState(id, stateName)</code>: Данный метод используется для установки состояния устройства с заданным идентификатором. Вы передаете идентификатор устройства в аргументе <code>id</code> и имя состояния в аргументе <code>stateName</code>. Например:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#000>entityManager</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>setState</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>id</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;on&#39;</span><span style=color:#000;font-weight:700>);</span>
</code></pre></div></li>
<li>
<p><code>setAttributes(id, attrs)</code>: Этот метод позволяет установить атрибуты устройства с заданным идентификатором. Вы передаете идентификатор устройства в аргументе <code>id</code> и объект с новыми атрибутами в аргументе <code>attrs</code>.</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>newAttributes</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>{</span>
  <span style=color:#000>brightness</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>80</span><span style=color:#000;font-weight:700>,</span>
  <span style=color:#000>color</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;red&#39;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#000;font-weight:700>};</span>

<span style=color:#000>entityManager</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>setAttributes</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>id</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>newAttributes</span><span style=color:#000;font-weight:700>);</span>
</code></pre></div></li>
<li>
<p><code>setMetric(id, name, value)</code>: Этот метод используется для установки метрики устройства с заданным идентификатором. Вы передаете идентификатор устройства в аргументе <code>id</code>, имя метрики в аргументе <code>name</code> и значение метрики в аргументе <code>value</code>.</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#000>entityManager</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>setMetric</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>id</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;temperature&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>25</span><span style=color:#000;font-weight:700>);</span>
</code></pre></div></li>
<li>
<p><code>callAction(id, actionName, args)</code>: Данный метод позволяет вызвать определенное действие на устройстве с заданным идентификатором. Вы передаете идентификатор устройства в аргументе <code>id</code>, имя действия в аргументе <code>actionName</code> и аргументы, связанные с действием, в аргументе <code>args</code>.</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#000>entityManager</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>callAction</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>id</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;turnOn&#39;</span><span style=color:#000;font-weight:700>);</span>
</code></pre></div></li>
<li>
<p><code>callScene(id, args)</code>: Этот метод используется для вызова сцены с заданным идентификатором. Вы передаете идентификатор сцены в аргументе <code>id</code> и аргументы, связанные со сценой, в аргументе <code>args</code>.</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#000>entityManager</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>callScene</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>id</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>args</span><span style=color:#000;font-weight:700>);</span>
</code></pre></div></li>
</ol>
<p>Менеджер устройств &ldquo;Entity Manager&rdquo; упрощает управление устройствами, настройками и состоянием в проекте <strong>Smart Home</strong>.
Он предоставляет удобный интерфейс для получения информации о устройствах, управления ими и обработки связанных с ними
событий. Это позволяет вам создавать более гибкие и функциональные приложения для вашего умного дома.</p>
<hr>
<h3 id=объект-entitymanager>объект entityManager</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript><span style=color:#8f5902;font-style:italic># доступные метода
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>entityManager</span>
  <span style=color:#000;font-weight:700>.</span><span style=color:#000>getEntity</span><span style=color:#000>(id) -&gt;</span> <span style=color:#000>Entity</span>
  <span style=color:#000;font-weight:700>.</span><span style=color:#000>setState</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>id</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>stateName</span><span style=color:#000;font-weight:700>)</span>
  <span style=color:#000;font-weight:700>.</span><span style=color:#000>setAttributes</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>id</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>attrs</span><span style=color:#000;font-weight:700>)</span>
  <span style=color:#000;font-weight:700>.</span><span style=color:#000>setMetric</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>id</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>name</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>value</span><span style=color:#000;font-weight:700>)</span>
  <span style=color:#000;font-weight:700>.</span><span style=color:#000>callAction</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>id</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>actionName</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>args</span><span style=color:#000;font-weight:700>)</span>
  <span style=color:#000;font-weight:700>.</span><span style=color:#000>callScene</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>id</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>args</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><table>
<thead>
<tr>
<th>значение</th>
<th>описание</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>уникальному id устройства</td>
</tr>
<tr>
<td>getEntity</td>
<td>поиск устройства, возвращает <a href=#%D0%BC%D0%B5%D1%82%D0%BE%D0%B4%D1%8B-%D0%BE%D0%B1%D1%8A%D0%B5%D0%BA%D1%82%D0%B0-entity>Entity</a></td>
</tr>
<tr>
<td>setState</td>
<td>изменить текущее состояние, <strong>stateName</strong> - наименования будущего состояния</td>
</tr>
<tr>
<td>setAttributes</td>
<td>изменить свойство текущего состояния, <strong>attr</strong> - map параметрый {key:val}</td>
</tr>
<tr>
<td>setMetric</td>
<td>обновить метрики устройства, <strong>name</strong> - наименование метрики, <strong>attr</strong> - map параметрый {key:val}</td>
</tr>
<tr>
<td>callAction</td>
<td>иcполнение команды на устройстве, <strong>actionName</strong> - наименование команды, <strong>args</strong> - map параметрый {key:val}</td>
</tr>
<tr>
<td>callScene</td>
<td>выполнить сцену с <strong>id</strong></td>
</tr>
</tbody>
</table>
<hr>
<h3 id=пример-кода>пример кода</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript><span style=color:#8f5902;font-style:italic># entity manager
</span><span style=color:#8f5902;font-style:italic># ##################################
</span><span style=color:#8f5902;font-style:italic></span>
<span style=color:#8f5902;font-style:italic># поиск устройства по уникальному id, возвращает [Entity](#объект-entity)
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>device = </span><span style=color:#000>entityManager</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>getEntity</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;telegram.clavicus&#39;</span><span style=color:#000;font-weight:700>)</span>

<span style=color:#8f5902;font-style:italic># изменить текущее состояние по уникальному наименованию состояния
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>entityManager</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>setState</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;telegram.clavicus&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;IN_WORK&#39;</span><span style=color:#000;font-weight:700>)</span>

<span style=color:#8f5902;font-style:italic># изменить свойство текущего состояния
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>entityManager</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>setAttributes</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;telegram.clavicus&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>{</span><span style=color:#4e9a06>&#39;temp&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>23.3</span><span style=color:#000;font-weight:700>})</span>

<span style=color:#8f5902;font-style:italic># обновить метрики устройства
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>entityManager</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>setMetric</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;telegram.clavicus&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;cpu&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>{</span><span style=color:#4e9a06>&#39;all&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>55</span><span style=color:#000;font-weight:700>})</span>

<span style=color:#8f5902;font-style:italic># иcполнение команды на устройстве
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>entityManager</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>callAction</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;floor.light&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;ON&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>{</span><span style=color:#4e9a06>&#39;power&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>30</span><span style=color:#000;font-weight:700>})</span>

<span style=color:#8f5902;font-style:italic># получение настроек
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>settings = </span><span style=color:#000>device</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>getSettings</span><span style=color:#000;font-weight:700>()</span>
<span style=color:#000>headers = </span><span style=color:#000;font-weight:700>[{</span><span style=color:#4e9a06>&#39;apikey&#39;</span><span style=color:#ce5c00;font-weight:700>:</span><span style=color:#000>settings</span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;apikey&#39;</span><span style=color:#000;font-weight:700>]}]</span>
<span style=color:#000>url = </span><span style=color:#4e9a06>&#39;https://webhook.site/2692a589-a5bc-4156-af7d-75875578798f&#39;</span>
<span style=color:#000>res = </span><span style=color:#000>http</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>headers</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>headers</span><span style=color:#000;font-weight:700>).</span><span style=color:#000>get</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>url</span><span style=color:#000;font-weight:700>)</span>

</code></pre></div>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-9da4eb53c4b9af52d6292b0dc7500e49>2.4 - hex2arr</h1>
<p>В JavaScript окружении доступна функция <code>hex2arr(hexString)</code>, которая преобразует строку шестнадцатеричных значений в
массив байт (<code>[]byte</code>).</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#000>hex2arr</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>function</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>hexString</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>result</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[];</span>
    <span style=color:#204a87;font-weight:700>while</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>hexString</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>length</span> <span style=color:#ce5c00;font-weight:700>&gt;=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
        <span style=color:#000>result</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>push</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87>parseInt</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>hexString</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>substring</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>),</span> <span style=color:#0000cf;font-weight:700>16</span><span style=color:#000;font-weight:700>));</span>
        <span style=color:#000>hexString</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>hexString</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>substring</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>hexString</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>length</span><span style=color:#000;font-weight:700>);</span>
    <span style=color:#000;font-weight:700>}</span>
    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>result</span><span style=color:#000;font-weight:700>;</span>
<span style=color:#000;font-weight:700>};</span>
</code></pre></div><p>Пример реализации функции <code>hex2arr</code>:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#204a87;font-weight:700>function</span> <span style=color:#000>hex2arr</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>hexString</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#8f5902;font-style:italic>// Удаляем все пробелы из строки
</span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#000>hexString</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>hexString</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>replace</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>/\s/g</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;&#39;</span><span style=color:#000;font-weight:700>);</span>

    <span style=color:#8f5902;font-style:italic>// Разбиваем строку на пары символов (каждая пара представляет байт)
</span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>hexPairs</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>hexString</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>match</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>/.{1,2}/g</span><span style=color:#000;font-weight:700>);</span>

    <span style=color:#8f5902;font-style:italic>// Преобразуем каждую пару символов в числовое значение
</span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>byteArr</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>hexPairs</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>map</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>function</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>hex</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#204a87>parseInt</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>hex</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>16</span><span style=color:#000;font-weight:700>);</span>
    <span style=color:#000;font-weight:700>});</span>

    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>byteArr</span><span style=color:#000;font-weight:700>;</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><p>Пример использования функции <code>hex2arr</code>:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>hexString</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;48656C6C6F20576F726C64&#34;</span><span style=color:#000;font-weight:700>;</span> <span style=color:#8f5902;font-style:italic>// &#34;Hello World&#34; в шестнадцатеричном формате
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>byteArr</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>hex2arr</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>hexString</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>byteArr</span><span style=color:#000;font-weight:700>);</span> <span style=color:#8f5902;font-style:italic>// [ 72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100 ]
</span></code></pre></div><p>В этом примере функция <code>hex2arr</code> принимает строку <code>"48656C6C6F20576F726C64"</code>, которая представляет &ldquo;Hello World&rdquo; в
шестнадцатеричном формате. Результатом выполнения функции будет массив байт, содержащий соответствующие значения ASCII
символов.</p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-0680a74cdf0541bf29b386fcca15603d>2.5 - marshal</h1>
<p>В JavaScript окружении доступна функция <code>marshal</code>, которая преобразует объект в его JSON-представление с помощью функции <code>JSON.stringify</code>.</p>
<p>Пример реализации функции <code>marshal</code>:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#204a87;font-weight:700>function</span> <span style=color:#000>marshal</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>obj</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>JSON</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>stringify</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>obj</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><p>Пример использования функции <code>marshal</code>:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>obj</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;John&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>age</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>30</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>city</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;New York&#34;</span> <span style=color:#000;font-weight:700>};</span>
<span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>jsonStr</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>marshal</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>obj</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>jsonStr</span><span style=color:#000;font-weight:700>);</span> <span style=color:#8f5902;font-style:italic>// {&#34;name&#34;:&#34;John&#34;,&#34;age&#34;:30,&#34;city&#34;:&#34;New York&#34;}
</span></code></pre></div><p>В этом примере функция <code>marshal</code> принимает объект <code>obj</code> и использует функцию <code>JSON.stringify</code> для преобразования объекта в его JSON-представление. Результатом выполнения функции будет строка JSON, содержащая сериализованные данные объекта.</p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-a9a66c35c8f75d979eae68e087939baf>2.6 - Mqtt</h1>
<p>Предостовляет возможность публиковать сообщения в mqtt брокере</p>
<h4 id=качество-обслуживания-в-протоколе-mqtt-qos>Качество обслуживания в протоколе MQTT (QoS)</h4>
<p>QoS 0 At most once. На этом уровне издатель один раз отправляет сообщение брокеру и не ждет подтверждения от него, то есть отправил и забыл.</p>
<p>QoS 1 At least once. Этот уровень гарантирует, что сообщение точно будет доставлено брокеру, но есть вероятность дублирования сообщений от издателя. После получения дубликата сообщения, брокер снова рассылает это сообщение подписчикам, а издателю снова отправляет подтверждение о получении сообщения. Если издатель не получил PUBACK сообщения от брокера, он повторно отправляет этот пакет, при этом в DUP устанавливается «1».</p>
<p>QoS 2 Exactly once. На этом уровне гарантируется доставка сообщений подписчику и исключается возможное дублирование отправленных сообщений.</p>
<div class="alert alert-success" role=alert>
Функция доступна в любом скрипте системы.
</div>
<p>Объект &ldquo;Mqtt&rdquo; в проекте <strong>Smart Home</strong> предоставляет следующий метод:</p>
<ol>
<li><code>publish(topic, payload, qos, retain)</code>: Этот метод используется для публикации сообщений на MQTT-брокере. Вы передаете аргументы <code>topic</code> (тема), <code>payload</code> (содержимое сообщения), <code>qos</code> (уровень обслуживания качества) и <code>retain</code> (флаг &ldquo;retain&rdquo;).</li>
</ol>
<ul>
<li><code>topic</code>: Строка, представляющая тему, на которую будет опубликовано сообщение.</li>
<li><code>payload</code>: Содержимое сообщения, которое может быть строкой, объектом или бинарными данными.</li>
<li><code>qos</code>: Уровень обслуживания качества (Quality of Service) определяет гарантии доставки сообщений. Возможные значения: 0 (минимальная гарантия доставки), 1 (гарантия доставки с подтверждением) или 2 (точная доставка с повторной отправкой при необходимости).</li>
<li><code>retain</code>: Флаг, указывающий, должно ли сообщение сохраняться на брокере и передаваться новым подписчикам. Значения: true (сохранять) или false (не сохранять).</li>
</ul>
<p>Пример использования:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>topic</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;smart-home/living-room/light&#39;</span><span style=color:#000;font-weight:700>;</span>
<span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>payload</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;on&#39;</span><span style=color:#000;font-weight:700>;</span>
<span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>qos</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span>
<span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>retain</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>true</span><span style=color:#000;font-weight:700>;</span>

<span style=color:#000>Mqtt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>publish</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>topic</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>payload</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>qos</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>retain</span><span style=color:#000;font-weight:700>);</span>
</code></pre></div><p>Метод <code>publish</code> позволяет отправлять сообщения на MQTT-брокер для передачи информации и управления устройствами или системой в целом в вашем проекте <strong>Smart Home</strong>.</p>
<hr>
<h3 id=объект-mqtt>объект Mqtt</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript><span style=color:#8f5902;font-style:italic># публикация сообщения
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>Mqtt</span>
  <span style=color:#000;font-weight:700>.</span><span style=color:#000>publish</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>topic</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>payload</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>qos</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>ratain</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><table>
<thead>
<tr>
<th>значение</th>
<th>описание</th>
</tr>
</thead>
<tbody>
<tr>
<td>topic</td>
<td>канал для сообщения</td>
</tr>
<tr>
<td>payload</td>
<td>json объект предназначеный для передачи</td>
</tr>
<tr>
<td>qos</td>
<td>качества обслуживания (1,2,3)</td>
</tr>
<tr>
<td>retain</td>
<td>при публикации данных с установленным флагом retain, брокер сохранит его. При следующей подписке на этот топик брокер незамедлительно отправит сообщение с этим флагом. Используется только в сообщениях с типом PUBLISH.</td>
</tr>
</tbody>
</table>
<hr>
<h3 id=пример-кода>пример кода</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript><span style=color:#8f5902;font-style:italic># mqtt
</span><span style=color:#8f5902;font-style:italic># ##################################
</span><span style=color:#8f5902;font-style:italic></span>
<span style=color:#000>payload = </span><span style=color:#000>JSON</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>stringify</span><span style=color:#000;font-weight:700>({</span><span style=color:#4e9a06>&#34;state&#34;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>actionName</span><span style=color:#000;font-weight:700>})</span>
<span style=color:#000>Mqtt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>publish</span><span style=color:#4e9a06>&#34;zigbee2mqtt/device/set&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>payload</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>false</span><span style=color:#000;font-weight:700>)</span>

</code></pre></div>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-ec6a1606c6e250e3fe20a21896c0fc43>2.7 - print</h1>
<p>В JavaScript окружении доступна функция <code>print(string)</code>, которая выводит указанную строку в консоль.</p>
<p>Пример использования функции <code>print</code>:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#000>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Hello, world!&#34;</span><span style=color:#000;font-weight:700>);</span>
</code></pre></div><p>В этом примере функция <code>print</code> принимает строку &ldquo;Hello, world!&rdquo; и выводит ее в консоль.</p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-9c346cca743f679c9d069ea0fb09421c>2.8 - unmarshal</h1>
<p>В JavaScript окружении доступна функция <code>unmarshal</code>, которая преобразует JSON-строку в объект с помощью функции <code>JSON.parse</code>.</p>
<p>Пример реализации функции <code>unmarshal</code>:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#204a87;font-weight:700>function</span> <span style=color:#000>unmarshal</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>j</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>JSON</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>parse</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>j</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><p>Пример использования функции <code>unmarshal</code>:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>jsonStr</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;{&#34;name&#34;:&#34;John&#34;,&#34;age&#34;:30,&#34;city&#34;:&#34;New York&#34;}&#39;</span><span style=color:#000;font-weight:700>;</span>
<span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>obj</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>unmarshal</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>jsonStr</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>obj</span><span style=color:#000;font-weight:700>);</span> <span style=color:#8f5902;font-style:italic>// { name: &#34;John&#34;, age: 30, city: &#34;New York&#34; }
</span></code></pre></div><p>В этом примере функция <code>unmarshal</code> принимает JSON-строку <code>jsonStr</code> и использует функцию <code>JSON.parse</code> для преобразования строки в объект. Результатом выполнения функции будет объект, содержащий данные из JSON-строки.</p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-32950fcaf7eadb1a6af01e12b8d6fccc>2.9 - Выполнение системных команд</h1>
<p>Система в проекте <strong>Smart Home</strong> предоставляет возможность запуска произвольных файлов и скриптов синхронно и асинхронно.</p>
<div class="alert alert-success" role=alert>
Функция доступна в любом скрипте системы.
</div>
<p>Для этого доступны следующие методы:</p>
<ol>
<li>
<p><code>ExecuteSync(file, args)</code>: Этот метод позволяет запускать файлы и скрипты синхронно. Вы передаете имя файла или путь к скрипту в аргументе <code>file</code>, а также необходимые аргументы в виде объекта <code>args</code>. Пример использования:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>file</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;script.js&#39;</span><span style=color:#000;font-weight:700>;</span>
<span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>args</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>param1</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;value1&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>param2</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;value2&#39;</span> <span style=color:#000;font-weight:700>};</span>

<span style=color:#000>ExecuteSync</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>file</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>args</span><span style=color:#000;font-weight:700>);</span>
</code></pre></div></li>
<li>
<p><code>ExecuteAsync(file, args)</code>: Данный метод позволяет запускать файлы и скрипты асинхронно. Аргументы <code>file</code> и <code>args</code>имеют такую же структуру, как и в методе <code>ExecuteSync</code>. Пример использования:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>file</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;script.js&#39;</span><span style=color:#000;font-weight:700>;</span>
<span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>args</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>param1</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;value1&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>param2</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;value2&#39;</span> <span style=color:#000;font-weight:700>};</span>

<span style=color:#000>ExecuteAsync</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>file</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>args</span><span style=color:#000;font-weight:700>);</span>
</code></pre></div></li>
</ol>
<p>Оба метода <code>ExecuteSync</code> и <code>ExecuteAsync</code> предоставляют возможность запуска произвольных файлов и скриптов в вашем проекте
<strong>Smart Home</strong>. Синхронный режим означает, что выполнение кода будет блокировать последующие операции до завершения скрипта,
в то время как асинхронный режим позволяет продолжить выполнение других операций без ожидания завершения скрипта.
Вы можете использовать эти методы для интеграции с другими системами, выполнения пользовательских скриптов или запуска
внешних приложений в вашем проекте <strong>Smart Home</strong>.</p>
<hr>
<h3 id=пример-кода>пример кода</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript><span style=color:#8f5902;font-style:italic># ExecuteSync
</span><span style=color:#8f5902;font-style:italic># ##################################
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#4e9a06>&#34;use strict&#34;</span><span style=color:#000;font-weight:700>;</span>

<span style=color:#000>r = </span><span style=color:#000>ExecuteSync</span> <span style=color:#4e9a06>&#34;data/scripts/ping.sh&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;google.com&#34;</span>
<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>r</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>out</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#39;ok&#39;</span>
    <span style=color:#000>print</span> <span style=color:#4e9a06>&#34;site is available ^^&#34;</span>
</code></pre></div><p>ping.sh</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#8f5902;font-style:italic>#!/usr/bin/env bash
</span><span style=color:#8f5902;font-style:italic></span>
ping -c1 <span style=color:#000>$1</span> &gt; /dev/null 2&gt; /dev/null<span style=color:#000;font-weight:700>;</span> <span style=color:#ce5c00;font-weight:700>[[</span> <span style=color:#000>$?</span> -eq <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#ce5c00;font-weight:700>]]</span> <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> <span style=color:#204a87>echo</span> ok <span style=color:#ce5c00;font-weight:700>||</span> <span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;err&#34;</span>
</code></pre></div>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-25ccac5b56080fcd6d09c27147bbc75c>2.10 - Логирование</h1>
<p>В проекте <strong>Smart Home</strong> имеется возможность логирования событий с использованием объекта &ldquo;Log&rdquo;.</p>
<div class="alert alert-success" role=alert>
Функция доступна в любом скрипте системы.
</div>
<p>Объект &ldquo;Log&rdquo; предоставляет следующие методы для различных уровней логирования:</p>
<ol>
<li><code>info(txt)</code>: Данный метод используется для логирования информационных сообщений. Вы передаете текстовое сообщение в</li>
<li>качестве аргумента <code>txt</code>. Пример использования:</li>
</ol>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#000>Log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>info</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;This is an informational message.&#39;</span><span style=color:#000;font-weight:700>);</span>
</code></pre></div><ol start=2>
<li><code>warn(txt)</code>: Этот метод используется для логирования предупреждающих сообщений. Вы передаете текстовое сообщение в</li>
<li>аргументе <code>txt</code>. Пример использования:</li>
</ol>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#000>Log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>warn</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;This is a warning message.&#39;</span><span style=color:#000;font-weight:700>);</span>
</code></pre></div><ol start=3>
<li><code>error(txt)</code>: Данный метод используется для логирования ошибок. Вы передаете текстовое сообщение об ошибке в</li>
<li>аргументе <code>txt</code>. Пример использования:</li>
</ol>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#000>Log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>error</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;An error occurred.&#39;</span><span style=color:#000;font-weight:700>);</span>
</code></pre></div><ol start=4>
<li><code>debug(txt)</code>: Этот метод используется для логирования отладочных сообщений. Вы передаете текстовое сообщение для</li>
<li>отладки в аргументе <code>txt</code>. Пример использования:</li>
</ol>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#000>Log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>debug</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;Debugging information.&#39;</span><span style=color:#000;font-weight:700>);</span>
</code></pre></div><p>Методы объекта &ldquo;Log&rdquo; позволяют логировать различные типы сообщений, такие как информационные сообщения, предупреждения,
ошибки и отладочные сообщения. Логирование помогает отслеживать и анализировать события, происходящие в проекте <strong>Smart Home</strong>,
и облегчает процесс разработки, тестирования и отладки вашего приложения.</p>
<hr>
<h3 id=пример-кода>пример кода</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript><span style=color:#8f5902;font-style:italic># Log
</span><span style=color:#8f5902;font-style:italic># ##################################
</span><span style=color:#8f5902;font-style:italic></span>
<span style=color:#000>Log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>info</span> <span style=color:#4e9a06>&#39;some text&#39;</span>
<span style=color:#000>Log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>warn</span> <span style=color:#4e9a06>&#39;some text&#39;</span>
<span style=color:#000>Log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>error</span> <span style=color:#4e9a06>&#39;some text&#39;</span>
<span style=color:#000>Log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>debug</span> <span style=color:#4e9a06>&#39;some text&#39;</span>
</code></pre></div>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-def052376f274f2e8abb4278c4e332e3>2.11 - Временное хранилище</h1>
<p>В проекте <strong>Smart Home</strong> предоставляется <code>in memory</code> хранилище, которое позволяет хранить и кэшировать произвольные значения
в памяти. Значения также периодически архивируются на диск каждую минуту.</p>
<div class="alert alert-success" role=alert>
Функция доступна в любом скрипте системы.
</div>
<p>Для работы с хранилищем доступны следующие методы через объект &ldquo;Storage&rdquo;:</p>
<ol>
<li><code>push(key, value)</code>: Этот метод используется для добавления значения в хранилище. Вы передаете ключ <code>key</code> и значение <code>value</code>,</li>
<li>которое будет сохранено в памяти. Пример использования:</li>
</ol>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#000>Storage</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>push</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;temperature&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>25.5</span><span style=color:#000;font-weight:700>);</span>
</code></pre></div><ol start=2>
<li><code>getByName(key)</code>: Данный метод позволяет получить значение из хранилища по указанному ключу <code>key</code>. Если значение найдено в</li>
<li>памяти, оно будет возвращено. Пример использования:</li>
</ol>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>temperature</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Storage</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>getByName</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;temperature&#39;</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>temperature</span><span style=color:#000;font-weight:700>);</span>
</code></pre></div><ol start=3>
<li><code>search(key)</code>: Этот метод выполняет поиск значения по ключу <code>key</code>. Сначала он ищет значение в памяти, и если не находит,</li>
<li>производит поиск в базе данных. Результат поиска возвращается. Пример использования:</li>
</ol>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>result</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Storage</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>search</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;temperature&#39;</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>result</span><span style=color:#000;font-weight:700>);</span>
</code></pre></div><ol start=4>
<li><code>pop(key)</code>: Данный метод удаляет значение из хранилища по указанному ключу <code>key</code>. Если значение найдено и удалено, метод</li>
<li>возвращает удаленное значение. Пример использования:</li>
</ol>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>removedValue</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Storage</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>pop</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;temperature&#39;</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>removedValue</span><span style=color:#000;font-weight:700>);</span>
</code></pre></div><p>Методы объекта &ldquo;Storage&rdquo; предоставляют возможность добавления, получения, поиска и удаления значений из <code>in memory</code> хранилища.
Вы можете использовать это хранилище для временного хранения данных в памяти, с возможностью сохранения на диск и выполнения
эффективного поиска значений.</p>
<hr>
<h3 id=работа-с-хранилищем>Работа с хранилищем</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript><span style=color:#000>Storage</span>
  <span style=color:#000;font-weight:700>.</span><span style=color:#000>push</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>key</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>value</span><span style=color:#000;font-weight:700>)</span>
  <span style=color:#000;font-weight:700>.</span><span style=color:#000>getByName</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>key</span><span style=color:#000;font-weight:700>)</span>
  <span style=color:#000;font-weight:700>.</span><span style=color:#000>search</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>key</span><span style=color:#000;font-weight:700>)</span>
  <span style=color:#000;font-weight:700>.</span><span style=color:#000>pop</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>key</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><table>
<thead>
<tr>
<th>значение</th>
<th>описание</th>
</tr>
</thead>
<tbody>
<tr>
<td>push</td>
<td>поместить значение в хранилище по ключу <code>key</code></td>
</tr>
<tr>
<td>getByName</td>
<td>получить значение из хранилища по ключу <code>key</code></td>
</tr>
<tr>
<td>search</td>
<td>поиск значения по ключу <code>key</code></td>
</tr>
<tr>
<td>pop</td>
<td>удаление записи</td>
</tr>
</tbody>
</table>
<hr>
<h3 id=пример-кода>пример кода</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript><span style=color:#8f5902;font-style:italic># Storage
</span><span style=color:#8f5902;font-style:italic># ##################################
</span><span style=color:#8f5902;font-style:italic></span>
<span style=color:#000>foo =
</span><span style=color:#000></span>  <span style=color:#4e9a06>&#39;bar&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;bar&#39;</span>

<span style=color:#000>value = </span><span style=color:#000>JSON</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>stringify</span> <span style=color:#000>foo</span>

<span style=color:#8f5902;font-style:italic># save var
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>Storage</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>push</span> <span style=color:#4e9a06>&#39;foo&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>value</span>

<span style=color:#8f5902;font-style:italic># get exist var
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>value = </span><span style=color:#000>Storage</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>getByName</span> <span style=color:#4e9a06>&#39;foo&#39;</span>

<span style=color:#8f5902;font-style:italic># search
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>list = </span><span style=color:#000>Storage</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>search</span> <span style=color:#4e9a06>&#39;bar&#39;</span>

<span style=color:#000>Storage</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>pop</span> <span style=color:#4e9a06>&#39;foo&#39;</span>
</code></pre></div>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-35746c1f299b0a71f998b8b6a7ff748a>2.12 - http запросы</h1>
<p>В проекте <strong>Smart Home</strong> имеется возможность выполнения произвольных HTTP запросов синхронно к сторонним ресурсам.</p>
<p>Объект <code>http</code> позволяет выполнять синхронные HTTP запросы к сторонним ресурсам, таким как API-сервисы,
и получать ответы. Вы можете использовать этот метод для интеграции с другими системами и получения или отправки данных
через HTTP протокол в вашем проекте <strong>Smart Home</strong>.</p>
<p>поддерживаемые методы:</p>
<ul>
<li>GET</li>
<li>POST</li>
<li>PUT</li>
<li>DELETE</li>
</ul>
<div class="alert alert-success" role=alert>
Функция доступна в любом скрипте системы.
</div>
<hr>
<p>Для этого доступен соответствующий метод:</p>
<h3 id=get-запрос>GET запрос</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript><span style=color:#000>response = </span><span style=color:#000>http</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>get</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>url</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><table>
<thead>
<tr>
<th>значение</th>
<th>описание</th>
</tr>
</thead>
<tbody>
<tr>
<td>url</td>
<td>адрес запроса</td>
</tr>
<tr>
<td>response</td>
<td>рекзультат запроса</td>
</tr>
</tbody>
</table>
<hr>
<h3 id=post-запрос>POST запрос</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript><span style=color:#000>response = </span><span style=color:#000>http</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>post</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>url</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>body</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><table>
<thead>
<tr>
<th>значение</th>
<th>описание</th>
</tr>
</thead>
<tbody>
<tr>
<td>url</td>
<td>адрес запроса</td>
</tr>
<tr>
<td>body</td>
<td>тело запроса</td>
</tr>
<tr>
<td>response</td>
<td>рекзультат запроса</td>
</tr>
</tbody>
</table>
<hr>
<h3 id=headers-запрос>Headers запрос</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript><span style=color:#000>response = </span><span style=color:#000>http</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>headers</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>headers</span><span style=color:#000;font-weight:700>).</span><span style=color:#000>post</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>url</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>body</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><table>
<thead>
<tr>
<th>значение</th>
<th>описание</th>
</tr>
</thead>
<tbody>
<tr>
<td>headers</td>
<td>адрес запроса</td>
</tr>
<tr>
<td>url</td>
<td>адрес запроса</td>
</tr>
<tr>
<td>body</td>
<td>тело запроса</td>
</tr>
<tr>
<td>response</td>
<td>рекзультат запроса</td>
</tr>
</tbody>
</table>
<hr>
<h3 id=пример-кода>пример кода</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript><span style=color:#8f5902;font-style:italic># GET http
</span><span style=color:#8f5902;font-style:italic># ##################################
</span><span style=color:#8f5902;font-style:italic></span>
<span style=color:#000>res = </span><span style=color:#000>http</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>get</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;%s&#34;</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>res</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>error</span>
  <span style=color:#204a87;font-weight:700>return</span>
<span style=color:#000>p = </span><span style=color:#000>JSON</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>parse</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>res</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>body</span><span style=color:#000;font-weight:700>)</span>


<span style=color:#8f5902;font-style:italic># POST http
</span><span style=color:#8f5902;font-style:italic># ##################################
</span><span style=color:#8f5902;font-style:italic></span>
<span style=color:#000>res = </span><span style=color:#000>http</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>post</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;%s&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>{</span><span style=color:#4e9a06>&#39;foo&#39;</span><span style=color:#ce5c00;font-weight:700>:</span><span style=color:#4e9a06>&#39;bar&#39;</span><span style=color:#000;font-weight:700>})</span>
<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>res</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>error</span>
  <span style=color:#204a87;font-weight:700>return</span>
<span style=color:#000>p = </span><span style=color:#000>JSON</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>parse</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>res</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>body</span><span style=color:#000;font-weight:700>)</span>


<span style=color:#8f5902;font-style:italic># PUT http
</span><span style=color:#8f5902;font-style:italic># ##################################
</span><span style=color:#8f5902;font-style:italic></span>
<span style=color:#000>res = </span><span style=color:#000>http</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>put</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;%s&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>{</span><span style=color:#4e9a06>&#39;foo&#39;</span><span style=color:#ce5c00;font-weight:700>:</span><span style=color:#4e9a06>&#39;bar&#39;</span><span style=color:#000;font-weight:700>})</span>
<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>res</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>error</span>
  <span style=color:#204a87;font-weight:700>return</span>
<span style=color:#000>p = </span><span style=color:#000>JSON</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>parse</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>res</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>body</span><span style=color:#000;font-weight:700>)</span>


<span style=color:#8f5902;font-style:italic># GET http + custom headers
</span><span style=color:#8f5902;font-style:italic># ##################################
</span><span style=color:#8f5902;font-style:italic></span>
<span style=color:#000>res = </span><span style=color:#000>http</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>headers</span><span style=color:#000;font-weight:700>([{</span><span style=color:#4e9a06>&#39;apikey&#39;</span><span style=color:#ce5c00;font-weight:700>:</span><span style=color:#4e9a06>&#39;some text&#39;</span><span style=color:#000;font-weight:700>}]).</span><span style=color:#000>get</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;%s&#34;</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>res</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>error</span>
<span style=color:#204a87;font-weight:700>return</span>
<span style=color:#000>p = </span><span style=color:#000>JSON</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>parse</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>res</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>body</span><span style=color:#000;font-weight:700>)</span>

<span style=color:#8f5902;font-style:italic># DELETE http
</span><span style=color:#8f5902;font-style:italic># ##################################
</span><span style=color:#8f5902;font-style:italic></span>
<span style=color:#000>res = </span><span style=color:#000>http</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>delete</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;%s&#34;</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>res</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>error</span>
  <span style=color:#204a87;font-weight:700>return</span>
<span style=color:#000>p = </span><span style=color:#000>JSON</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>parse</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>res</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>body</span><span style=color:#000;font-weight:700>)</span>

</code></pre></div>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-bb346cf0596c62e042775b393e7fd9b8>3 - Plugins</h1>
<p>Проект <strong>Smart Home</strong> также поддерживает систему плагинов, что позволяет легко расширять его функциональность и интегрировать
сторонние компоненты. Система плагинов обеспечивает гибкость и модульность, позволяя пользователям добавлять новые возможности
и настраивать проект согласно их потребностям.</p>
<p>Плагины в проекте <strong>Smart Home</strong> представляют собой отдельные модули, написанные на Go, которые можно подключать
и использовать для добавления новых функций и интеграции с различными устройствами и сервисами. Каждый плагин обеспечивает
определенную функциональность, такую как поддержка определенного типа устройств, интеграция с внешними сервисами или
реализация специфических правил автоматизации.</p>
<p>Система плагинов в проекте <strong>Smart Home</strong> предоставляет стандартные интерфейсы и соглашения, которые облегчают разработку
и интеграцию плагинов. Она позволяет разработчикам создавать плагины, которые могут взаимодействовать с основной системой
проекта, получать доступ к данным и устройствам, а также добавлять свои собственные функции и возможности.</p>
<p>Использование системы плагинов в проекте <strong>Smart Home</strong> позволяет пользователям выбирать и настраивать только те функции,
которые им необходимы, и избегать избыточности или излишней сложности. Они могут добавлять новые плагины или отключать уже
существующие, чтобы создать индивидуальное решение, полностью соответствующее их потребностям.</p>
<p>Благодаря системе плагинов, проект <strong>Smart Home</strong> становится более гибким и расширяемым, позволяя пользователям адаптировать
его под свои уникальные требования. Она также способствует активному сообществу разработчиков и увеличивает возможности совместной
работы и обмена плагинами, что способствует дальнейшему развитию проекта и расширению его экосистемы.</p>
<p>В документации проекта <strong>Smart Home</strong> вы найдете подробные инструкции по созданию, установке и настройке плагинов, а
также примеры использования. Это поможет вам начать разрабатывать свои собственные плагины и настроить проект <strong>Smart Home</strong>
в соответствии с вашими потребностями и предпочтениями.</p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-421d1625cd3fc0768a5e9395096f9ba0>3.1 - Modbus</h1>
<p>Расширение для работы с устройствами по открытому коммуникационному протоколу <strong>modbus</strong>
основанный на архитектуре ведущий — ведомый. Использует для передачи данных интерфейсы RS-485,
RS-422, RS-232, а также Ethernet сети TCP/IP (протокол Modbus TCP).</p>
<p><a href=https://ru.wikipedia.org/wiki/Modbus>wiki</a></p>
</div>
<div class=td-content>
<h1 id=pg-83ccc62bb21aa1015dc85c4aa89b620d>3.1.1 - Modbus rtu</h1>
<p>В системе <strong>Smart Home</strong> реализован плагин Modbus RTU, который обеспечивает взаимодействие с устройствами по протоколу
Modbus RTU. Плагин предоставляет метод <code>ModbusRtu(FUNC, ADDRESS, COUNT, COMMAND)</code>, позволяющий отправлять команды и
получать данные по указанному протоколу.</p>
<p>Аргументы метода <code>ModbusRtu</code>:</p>
<ol>
<li><code>FUNC</code>: Код функции Modbus, указывающий тип операции, которую следует выполнить с устройством.</li>
<li><code>ADDRESS</code>: Адрес устройства Modbus, к которому отправляется команда.</li>
<li><code>COUNT</code>: Количество регистров или битов, которые следует прочитать или записать.</li>
<li><code>COMMAND</code>: Команда, которую необходимо выполнить, указывающая дополнительные параметры и настройки.</li>
</ol>
<p>Пример использования:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>COMMAND</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[]</span>
<span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>FUNC</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;ReadHoldingRegisters&#39;</span>
<span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>ADDRESS</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span>
<span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>COUNT</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>16</span>

<span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>response</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>ModbusRtu</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>FUNC</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>ADDRESS</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>COUNT</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>COMMAND</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>response</span><span style=color:#000;font-weight:700>);</span>
</code></pre></div><p>Метод <code>ModbusRtu</code> позволяет отправлять команды Modbus RTU, выполнять чтение или запись регистров и получать данные от
устройств. Вы можете использовать этот метод в вашем проекте <strong>Smart Home</strong> для взаимодействия с устройствами, поддерживающими
протокол Modbus RTU.</p>
<div class="alert alert-warning" role=alert>
Для работы с modbus rtu устройством требуется настроенная <strong>нода</strong>
</div>
<h3 id=настройка>Настройка:</h3>
<ul>
<li>slave_id <code>1-32</code></li>
<li>baud <code>9600, 19200</code></li>
<li>data_bits <code>5-9</code></li>
<li>timeout <code>milliseconds</code></li>
<li>stop_bits <code>1-2</code></li>
<li>sleep <code>milliseconds</code></li>
<li>parity <code>none, odd, even</code></li>
</ul>
<h3 id=команды>Команды:</h3>
<ul>
<li>произвольный набор</li>
</ul>
<h3 id=атрибуты>Атрибуты</h3>
<ul>
<li>произвольный набор</li>
</ul>
<h3 id=статус>Статус</h3>
<ul>
<li>произвольный набор</li>
</ul>
<hr>
<h3 id=доступные-функции>Доступные функции</h3>
<p><strong>1 битные функции</strong></p>
<p>ReadCoils <br>
ReadDiscreteInputs<br>
WriteSingleCoil <br>
WriteMultipleCoils</p>
<p><strong>16 битные функции</strong></p>
<p>ReadInputRegisters <br>
ReadHoldingRegisters <br>
ReadWriteMultipleRegisters<br>
WriteSingleRegister <br>
WriteMultipleRegisters</p>
<hr>
<h3 id=javascript-свойства>javascript свойства</h3>
<ul>
<li>ENTITY_ID</li>
<li>ModbusRtu</li>
<li>entityAction</li>
<li>Action</li>
</ul>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript><span style=color:#8f5902;font-style:italic># константа с уникальным id устройства
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>const</span> <span style=color:#000>ENTITY_ID</span>
</code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript><span style=color:#8f5902;font-style:italic># выполнение команды(функции) на устройсте:
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>result = </span><span style=color:#000>ModbusRtu</span> <span style=color:#000>func</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>addr</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>count</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>command</span>
</code></pre></div><table>
<thead>
<tr>
<th>значение</th>
<th>описание</th>
</tr>
</thead>
<tbody>
<tr>
<td>func</td>
<td>функция для выполнения на устройстве</td>
</tr>
<tr>
<td>addr</td>
<td>Адрес первого регистра (40108-40001 = 107 =6B hex)</td>
</tr>
<tr>
<td>count</td>
<td>Количество требуемых регистров (чтение 3-х регистров с 40108 по 40110)</td>
</tr>
<tr>
<td>command</td>
<td>Команда</td>
</tr>
</tbody>
</table>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript><span style=color:#8f5902;font-style:italic># функция-обработчик события действий:
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>entityAction = </span><span style=color:#000>(entityId, actionName)-&gt;</span>
</code></pre></div><table>
<thead>
<tr>
<th>значение</th>
<th>описание</th>
</tr>
</thead>
<tbody>
<tr>
<td>entityId</td>
<td>уникальное id устройства</td>
</tr>
<tr>
<td>actionName</td>
<td>системное наименование действия</td>
</tr>
</tbody>
</table>
<div class="alert alert-warning" role=alert>
Объект <strong>Action</strong> доступен в скриптах действий и скриптах закрепленных за устройством.
</div>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript><span style=color:#000>state = </span><span style=color:#000;font-weight:700>{</span>
  <span style=color:#000>new_state: </span><span style=color:#4e9a06>&#39;ENABLED&#39;</span><span style=color:#000;font-weight:700>,</span>
  <span style=color:#000>attribute_values: </span><span style=color:#000;font-weight:700>{</span>
    <span style=color:#000>heat: </span><span style=color:#204a87;font-weight:700>false</span>
  <span style=color:#000;font-weight:700>},</span>
  <span style=color:#000>settings_value: </span><span style=color:#000;font-weight:700>{},</span>
  <span style=color:#000>storage_save: </span><span style=color:#204a87;font-weight:700>true</span>
<span style=color:#000;font-weight:700>}</span> 
<span style=color:#8f5902;font-style:italic># сохранение состояния 
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>Actor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>setState</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>state</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><table>
<thead>
<tr>
<th>значение</th>
<th>описание</th>
</tr>
</thead>
<tbody>
<tr>
<td>new_state</td>
<td>уникальное системное наименование состояния</td>
</tr>
<tr>
<td>attribute_values</td>
<td>значения атрибутов ранее определенных для устройства</td>
</tr>
<tr>
<td>settings_value</td>
<td>значения настроек ранее определенных для устройства</td>
</tr>
<tr>
<td>storage_save</td>
<td>признак записи среза состояния в БД</td>
</tr>
</tbody>
</table>
<hr>
<h3 id=пример-coffeescript-кода>пример coffeescript кода</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript><span style=color:#8f5902;font-style:italic># ModbusRtu
</span><span style=color:#8f5902;font-style:italic># ##################################
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#4e9a06>&#34;use strict&#34;</span><span style=color:#000;font-weight:700>;</span>

<span style=color:#000>checkStatus = </span><span style=color:#000>-&gt;</span>
  <span style=color:#000>COMMAND = </span><span style=color:#000;font-weight:700>[]</span>
  <span style=color:#000>FUNC = </span><span style=color:#4e9a06>&#39;ReadHoldingRegisters&#39;</span>
  <span style=color:#000>ADDRESS = </span><span style=color:#0000cf;font-weight:700>0</span>
  <span style=color:#000>COUNT = </span><span style=color:#0000cf;font-weight:700>16</span>
  
  <span style=color:#8f5902;font-style:italic># выполнение команды(функции) на устройсте:
</span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>res = </span><span style=color:#000>ModbusRtu</span> <span style=color:#000>FUNC</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>ADDRESS</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>COUNT</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>COMMAND</span>
  <span style=color:#000>print</span> <span style=color:#000>res</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>error</span>
  <span style=color:#000>print</span> <span style=color:#000>res</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>result</span>
  <span style=color:#000>print</span> <span style=color:#000>res</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>time</span>

<span style=color:#8f5902;font-style:italic># функция-обработчик события действий:
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>entityAction = </span><span style=color:#000>(entityId, actionName)-&gt;</span>
  <span style=color:#204a87;font-weight:700>switch</span> <span style=color:#000>actionName</span>
    <span style=color:#204a87;font-weight:700>when</span> <span style=color:#4e9a06>&#39;ON&#39;</span> <span style=color:#204a87;font-weight:700>then</span> <span style=color:#000>doOnAction</span><span style=color:#000;font-weight:700>()</span>
    <span style=color:#204a87;font-weight:700>when</span> <span style=color:#4e9a06>&#39;OFF&#39;</span> <span style=color:#204a87;font-weight:700>then</span> <span style=color:#000>doOffAction</span><span style=color:#000;font-weight:700>()</span>
    <span style=color:#204a87;font-weight:700>when</span> <span style=color:#4e9a06>&#39;CHECK&#39;</span> <span style=color:#204a87;font-weight:700>then</span> <span style=color:#000>checkStatus</span><span style=color:#000;font-weight:700>()</span>
    <span style=color:#204a87;font-weight:700>when</span> <span style=color:#4e9a06>&#39;ON_WITH_ERR&#39;</span> <span style=color:#204a87;font-weight:700>then</span> <span style=color:#000>doOnErrAction</span><span style=color:#000;font-weight:700>()</span>

</code></pre></div>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-2ab89625f67635397c493f87afe8c5f2>3.1.2 - Modbus tcp</h1>
<p>В системе <strong>Smart Home</strong> реализован плагин Modbus TCP, который обеспечивает взаимодействие с устройствами по протоколу Modbus TCP.
Плагин предоставляет метод <code>ModbusTcp(func, addr, count, command)</code>, позволяющий отправлять команды и получать данные по указанному протоколу.</p>
<p>Аргументы метода <code>ModbusTcp</code>:</p>
<ol>
<li><code>func</code>: Код функции Modbus, указывающий тип операции, которую следует выполнить с устройством.</li>
<li><code>addr</code>: Адрес устройства Modbus, к которому отправляется команда.</li>
<li><code>count</code>: Количество регистров или битов, которые следует прочитать или записать.</li>
<li><code>command</code>: Команда, которую необходимо выполнить, указывающая дополнительные параметры и настройки.</li>
</ol>
<p>Пример использования:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>COMMAND</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[]</span>
<span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>FUNC</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;ReadHoldingRegisters&#39;</span>
<span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>ADDRESS</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span>
<span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>COUNT</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>16</span>

<span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>response</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>ModbusTcp</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>FUNC</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>ADDRESS</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>COUNT</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>COMMAND</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>response</span><span style=color:#000;font-weight:700>);</span>
</code></pre></div><p>Метод <code>ModbusTcp</code> позволяет отправлять команды Modbus TCP, выполнять чтение или запись регистров и получать данные от устройств.
Вы можете использовать этот метод в вашем проекте <strong>Smart Home</strong> для взаимодействия с устройствами, поддерживающими протокол Modbus TCP.</p>
<div class="alert alert-warning" role=alert>
Для работы с modbus rtu устройством требуется настроенная <strong>нода</strong>
</div>
<h3 id=настройка>Настройка:</h3>
<ul>
<li>slave_id <code>1-32</code></li>
<li>address_port <code>localhost:502</code></li>
</ul>
<h3 id=команды>Команды:</h3>
<ul>
<li>произвольный набор</li>
</ul>
<h3 id=атрибуты>Атрибуты</h3>
<ul>
<li>произвольный набор</li>
</ul>
<h3 id=статус>Статус</h3>
<ul>
<li>произвольный набор</li>
</ul>
<hr>
<h3 id=доступные-функции>Доступные функции</h3>
<p><strong>1 битные функции</strong></p>
<p>ReadCoils <br>
ReadDiscreteInputs<br>
WriteSingleCoil <br>
WriteMultipleCoils</p>
<p><strong>16 битные функции</strong></p>
<p>ReadInputRegisters <br>
ReadHoldingRegisters <br>
ReadWriteMultipleRegisters<br>
WriteSingleRegister <br>
WriteMultipleRegisters</p>
<hr>
<h3 id=javascript-свойства>javascript свойства</h3>
<ul>
<li>ENTITY_ID</li>
<li>ModbusRtu</li>
<li>entityAction</li>
<li>Action</li>
</ul>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript><span style=color:#8f5902;font-style:italic># константа с уникальным id устройства
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>const</span> <span style=color:#000>ENTITY_ID</span>
</code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript><span style=color:#8f5902;font-style:italic># выполнение команды(функции) на устройсте:
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>result = </span><span style=color:#000>ModbusTcp</span> <span style=color:#000>func</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>addr</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>count</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>command</span>
</code></pre></div><table>
<thead>
<tr>
<th>значение</th>
<th>описание</th>
</tr>
</thead>
<tbody>
<tr>
<td>func</td>
<td>функция для выполнения на устройстве</td>
</tr>
<tr>
<td>addr</td>
<td>Адрес первого регистра (40108-40001 = 107 =6B hex)</td>
</tr>
<tr>
<td>count</td>
<td>Количество требуемых регистров (чтение 3-х регистров с 40108 по 40110)</td>
</tr>
<tr>
<td>command</td>
<td>Команда</td>
</tr>
</tbody>
</table>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript><span style=color:#8f5902;font-style:italic># функция-обработчик события действий:
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>entityAction = </span><span style=color:#000>(entityId, actionName)-&gt;</span>
</code></pre></div><table>
<thead>
<tr>
<th>значение</th>
<th>описание</th>
</tr>
</thead>
<tbody>
<tr>
<td>entityId</td>
<td>уникальное id устройства</td>
</tr>
<tr>
<td>actionName</td>
<td>системное наименование действия</td>
</tr>
</tbody>
</table>
<div class="alert alert-warning" role=alert>
Объект <strong>Action</strong> доступен в скриптах действий и скриптах закрепленных за устройством.
</div>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript><span style=color:#000>state = </span><span style=color:#000;font-weight:700>{</span>
  <span style=color:#000>new_state: </span><span style=color:#4e9a06>&#39;ENABLED&#39;</span><span style=color:#000;font-weight:700>,</span>
  <span style=color:#000>attribute_values: </span><span style=color:#000;font-weight:700>{</span>
    <span style=color:#000>heat: </span><span style=color:#204a87;font-weight:700>false</span>
  <span style=color:#000;font-weight:700>},</span>
  <span style=color:#000>settings_value: </span><span style=color:#000;font-weight:700>{},</span>
  <span style=color:#000>storage_save: </span><span style=color:#204a87;font-weight:700>true</span>
<span style=color:#000;font-weight:700>}</span> 
<span style=color:#8f5902;font-style:italic># сохранение состояния 
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>Actor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>setState</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>state</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><table>
<thead>
<tr>
<th>значение</th>
<th>описание</th>
</tr>
</thead>
<tbody>
<tr>
<td>new_state</td>
<td>уникальное системное наименование состояния</td>
</tr>
<tr>
<td>attribute_values</td>
<td>значения атрибутов ранее определенных для устройства</td>
</tr>
<tr>
<td>settings_value</td>
<td>значения настроек ранее определенных для устройства</td>
</tr>
<tr>
<td>storage_save</td>
<td>признак записи среза состояния в БД</td>
</tr>
</tbody>
</table>
<hr>
<h3 id=пример-coffeescript-кода>пример coffeescript кода</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript><span style=color:#8f5902;font-style:italic># ModbusTcp
</span><span style=color:#8f5902;font-style:italic># ##################################
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#4e9a06>&#34;use strict&#34;</span><span style=color:#000;font-weight:700>;</span>

<span style=color:#000>checkStatus = </span><span style=color:#000>-&gt;</span>
  <span style=color:#000>COMMAND = </span><span style=color:#000;font-weight:700>[]</span>
  <span style=color:#000>FUNC = </span><span style=color:#4e9a06>&#39;ReadHoldingRegisters&#39;</span>
  <span style=color:#000>ADDRESS = </span><span style=color:#0000cf;font-weight:700>0</span>
  <span style=color:#000>COUNT = </span><span style=color:#0000cf;font-weight:700>16</span>

  <span style=color:#8f5902;font-style:italic># выполнение команды(функции) на устройсте:
</span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>res = </span><span style=color:#000>ModbusTcp</span> <span style=color:#000>FUNC</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>ADDRESS</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>COUNT</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>COMMAND</span>
  <span style=color:#000>print</span> <span style=color:#000>res</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>error</span>
  <span style=color:#000>print</span> <span style=color:#000>res</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>result</span>
  <span style=color:#000>print</span> <span style=color:#000>res</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>time</span>

<span style=color:#8f5902;font-style:italic># функция-обработчик события действий:
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>entityAction = </span><span style=color:#000>(entityId, actionName)-&gt;</span>
  <span style=color:#204a87;font-weight:700>switch</span> <span style=color:#000>actionName</span>
    <span style=color:#204a87;font-weight:700>when</span> <span style=color:#4e9a06>&#39;ON&#39;</span> <span style=color:#204a87;font-weight:700>then</span> <span style=color:#000>doOnAction</span><span style=color:#000;font-weight:700>()</span>
    <span style=color:#204a87;font-weight:700>when</span> <span style=color:#4e9a06>&#39;OFF&#39;</span> <span style=color:#204a87;font-weight:700>then</span> <span style=color:#000>doOffAction</span><span style=color:#000;font-weight:700>()</span>
    <span style=color:#204a87;font-weight:700>when</span> <span style=color:#4e9a06>&#39;CHECK&#39;</span> <span style=color:#204a87;font-weight:700>then</span> <span style=color:#000>checkStatus</span><span style=color:#000;font-weight:700>()</span>
    <span style=color:#204a87;font-weight:700>when</span> <span style=color:#4e9a06>&#39;ON_WITH_ERR&#39;</span> <span style=color:#204a87;font-weight:700>then</span> <span style=color:#000>doOnErrAction</span><span style=color:#000;font-weight:700>()</span>

</code></pre></div>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-0369b4decf3a671c6e8e5d18b35ebcef>3.2 - Alexa</h1>
<div class="alert alert-warning" role=alert>
Не законченная статья
</div>
<p>В системе <strong>Smart Home</strong> реализован плагин Amazon Alexa, который обеспечивает интеграцию с голосовым помощником Amazon
Alexa. Этот плагин позволяет управлять устройствами и выполнить различные операции в вашем умном доме с помощью
голосовых команд.</p>
<p>Плагин Amazon Alexa обеспечивает следующий функционал:</p>
<ol>
<li>
<p>Распознавание и обработка голосовых команд: Плагин позволяет принимать голосовые команды от пользователя,
отправленные</p>
</li>
<li>
<p>через голосового помощника Amazon Alexa. Он распознает команды, анализирует их и выполняет соответствующие действия в
вашем умном доме.</p>
</li>
<li>
<p>Управление устройствами: Плагин позволяет управлять устройствами в вашем умном доме с помощью голосовых команд.</p>
</li>
<li>
<p>Например, вы можете сказать &ldquo;Alexa, включи свет в гостиной&rdquo; или &ldquo;Alexa, установи температуру на 25 градусов&rdquo;.</p>
</li>
<li>
<p>Интеграция с другими функциями системы: Плагин Amazon Alexa интегрируется с другими функциями системы <strong>Smart Home</strong>.</p>
</li>
<li>
<p>Например, вы можете использовать голосовые команды для запуска сценариев, управления автоматическими задачами или</p>
</li>
<li>
<p>получения информации о состоянии устройств.</p>
</li>
</ol>
<p>Для использования плагина Amazon Alexa в вашем проекте <strong>Smart Home</strong> требуется настройка и подключение к вашему аккаунту
Amazon Alexa. После этого вы можете настроить голосовые команды и действия для управления вашим умным домом через
голосового помощника Amazon Alexa.</p>
<p>В плагине Amazon Alexa для системы <strong>Smart Home</strong> реализованы следующие хэндлеры на языке JavaScript:</p>
<ol>
<li><code>skillOnLaunch</code>: Этот хэндлер вызывается при запуске навыка (skill) на устройстве Amazon Alexa. Он предназначен для</li>
<li>обработки начального события запуска навыка. Вы можете определить здесь логику или выполнить необходимые действия при</li>
<li>запуске навыка. Пример использования:</li>
</ol>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#000>skillOnLaunch</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>=&gt;</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#8f5902;font-style:italic>// Логика обработки события запуска навыка
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#000;font-weight:700>};</span>
</code></pre></div><ol start=2>
<li><code>skillOnSessionEnd</code>: Этот хэндлер вызывается при завершении сессии с навыком. Он позволяет выполнить определенные</li>
<li>действия при окончании сеанса с пользователем. Например, вы можете сохранить состояние или выполнить завершающие
операции. Пример использования:</li>
</ol>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#000>skillOnSessionEnd</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>=&gt;</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#8f5902;font-style:italic>// Логика завершения сессии
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#000;font-weight:700>};</span>
</code></pre></div><ol start=3>
<li><code>skillOnIntent</code>: Этот хэндлер вызывается при получении навыком интентов (намерений) от пользователя. Он предназначен</li>
<li>для обработки различных интентов и выполнения соответствующих действий. Вы можете определить здесь логику обработки</li>
<li>интентов и взаимодействия с вашим умным домом. Пример использования:</li>
</ol>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#000>skillOnIntent</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>=&gt;</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#8f5902;font-style:italic>// Логика обработки интентов
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#000;font-weight:700>};</span>
</code></pre></div><p>Эти хэндлеры предоставляют возможность обрабатывать события запуска навыка, завершения сессии и получения интентов от
пользователя в контексте плагина Amazon Alexa. Вы можете определить свою логику и выполнить необходимые действия в
каждом из этих хэндлеров в соответствии с требованиями вашего проекта.</p>
<h3 id=пример-кода>пример кода</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript><span style=color:#000>skillOnLaunch = </span><span style=color:#000>-&gt;</span>
<span style=color:#8f5902;font-style:italic>#print &#39;---action onLaunch---&#39;
</span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>Done</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;skillOnLaunch&#39;</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000>skillOnSessionEnd = </span><span style=color:#000>-&gt;</span>
<span style=color:#8f5902;font-style:italic>#print &#39;---action onSessionEnd---&#39;
</span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>Done</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;skillOnSessionEnd&#39;</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000>skillOnIntent = </span><span style=color:#000>-&gt;</span>
<span style=color:#8f5902;font-style:italic>#print &#39;---action onIntent---&#39;
</span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>state = </span><span style=color:#4e9a06>&#39;on&#39;</span>
  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>Alexa</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>slots</span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;state&#39;</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#39;off&#39;</span>
    <span style=color:#000>state = </span><span style=color:#4e9a06>&#39;off&#39;</span>

  <span style=color:#000>place = </span><span style=color:#000>Alexa</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>slots</span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;place&#39;</span><span style=color:#000;font-weight:700>]</span>

  <span style=color:#000>Done</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>#{</span><span style=color:#000>place</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>_</span><span style=color:#4e9a06>#{</span><span style=color:#000>state</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span><span style=color:#000;font-weight:700>)</span>

  <span style=color:#000>Alexa</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>sendMessage</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>#{</span><span style=color:#000>place</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>_</span><span style=color:#4e9a06>#{</span><span style=color:#000>state</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-ef2b94f1a2a793c6662e60a76d3c9154>3.3 - Cgminer</h1>
<p>Расширение контроля состояния <strong>ASIC</strong> устройств</p>
<p>Доступные бренды:</p>
<ul>
<li>Bitmine Antminer</li>
</ul>
<h3 id=настройка>Настройка:</h3>
<ul>
<li>host</li>
<li>port</li>
<li>timeout</li>
<li>user</li>
<li>pass</li>
<li>manufacturer</li>
<li>model</li>
</ul>
<h3 id=команды>Команды:</h3>
<ul>
<li>произвольный набор</li>
</ul>
<h3 id=атрибуты>Атрибуты</h3>
<ul>
<li>произвольный набор</li>
</ul>
<h3 id=статус>Статус</h3>
<ul>
<li>произвольный набор</li>
</ul>
</div>
<div class=td-content>
<h1 id=pg-e8459aa132552732476b3a393a8246c7>3.3.1 - Bitmine</h1>
<p>Работа с устройствами ASIC производителя Bitmine Antminer.</p>
<p>поддерживаемые усторойства:</p>
<ul>
<li>S9</li>
<li>S7</li>
<li>L3</li>
<li>L3</li>
<li>D3</li>
<li>T9</li>
</ul>
<h3 id=javascript-свойства>javascript свойства</h3>
<hr>
<h3 id=miner-базовая-сущность>Miner Базовая сущность</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript><span style=color:#8f5902;font-style:italic># константа с уникальным id устройства
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>const</span> <span style=color:#000>ENTITY_ID</span>
</code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript><span style=color:#000>result = </span><span style=color:#000>Miner</span>
    <span style=color:#000;font-weight:700>.</span><span style=color:#000>stats</span><span style=color:#000;font-weight:700>()</span>
    <span style=color:#000;font-weight:700>.</span><span style=color:#000>devs</span><span style=color:#000;font-weight:700>()</span>
    <span style=color:#000;font-weight:700>.</span><span style=color:#000>summary</span><span style=color:#000;font-weight:700>()</span>
    <span style=color:#000;font-weight:700>.</span><span style=color:#000>pools</span><span style=color:#000;font-weight:700>()</span>
    <span style=color:#000;font-weight:700>.</span><span style=color:#000>addPool</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>url</span> <span style=color:#000>string</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#000;font-weight:700>.</span><span style=color:#000>version</span><span style=color:#000;font-weight:700>()</span>
    <span style=color:#000;font-weight:700>.</span><span style=color:#000>enable</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>poolId</span> <span style=color:#000>int64</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#000;font-weight:700>.</span><span style=color:#000>disable</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>poolId</span> <span style=color:#000>int64</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#000;font-weight:700>.</span><span style=color:#000>delete</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>poolId</span> <span style=color:#000>int64</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#000;font-weight:700>.</span><span style=color:#000>switchPool</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>poolId</span> <span style=color:#000>int64</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#000;font-weight:700>.</span><span style=color:#000>restart</span><span style=color:#000;font-weight:700>()</span>
</code></pre></div><table>
<thead>
<tr>
<th>значение</th>
<th>описание</th>
</tr>
</thead>
<tbody>
<tr>
<td>result</td>
<td>type: Object (Result)</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>значение</th>
<th>описание</th>
</tr>
</thead>
<tbody>
<tr>
<td>stats</td>
<td>type: метод, статистика</td>
</tr>
<tr>
<td>devs</td>
<td>type: метод, статистика</td>
</tr>
<tr>
<td>summary</td>
<td>type: метод, статистика</td>
</tr>
<tr>
<td>pools</td>
<td>type: метод, список серверов</td>
</tr>
<tr>
<td>addPool</td>
<td>type: метод, добавление сервера</td>
</tr>
<tr>
<td>version</td>
<td>type: метод, версия прошивки</td>
</tr>
<tr>
<td>enable</td>
<td>type: метод, включение в работу сервера</td>
</tr>
<tr>
<td>disable</td>
<td>type: метод, включение сервера</td>
</tr>
<tr>
<td>delete</td>
<td>type: метод, удаление сервера</td>
</tr>
<tr>
<td>switchPool</td>
<td>type: метод, переключние сервера</td>
</tr>
<tr>
<td>restart</td>
<td>type: метод, мягкий перезапуск устройства</td>
</tr>
</tbody>
</table>
<hr>
<h3 id=объект-result>объект Result</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript>  <span style=color:#000>result = </span><span style=color:#000;font-weight:700>{</span>
  <span style=color:#000>error: </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#000;font-weight:700>,</span>
  <span style=color:#000>errMessage: </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#000;font-weight:700>,</span>
  <span style=color:#000>result: </span><span style=color:#4e9a06>&#34;&#34;</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><table>
<thead>
<tr>
<th>значение</th>
<th>описание</th>
</tr>
</thead>
<tbody>
<tr>
<td>error</td>
<td>type: boolean, признак ошибки</td>
</tr>
<tr>
<td>errMessage</td>
<td>type: string, человекопонятное описание ошибки</td>
</tr>
<tr>
<td>result</td>
<td>type: string, json объект в текстовом формате, если запрос завершился без ошибок</td>
</tr>
</tbody>
</table>
<hr>
<h3 id=функция-entityaction>функция entityAction</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript><span style=color:#000>entityAction = </span><span style=color:#000>(entityId, actionName)-&gt;</span>
</code></pre></div><table>
<thead>
<tr>
<th>значение</th>
<th>описание</th>
</tr>
</thead>
<tbody>
<tr>
<td>entityId</td>
<td>type: string, id сущности отправляющего сообщение</td>
</tr>
<tr>
<td>actionName</td>
<td>type: string, название действия, без символа &lsquo;/&rsquo; в верхнем регистре</td>
</tr>
</tbody>
</table>
<hr>
<h3 id=обект-actor>Обект Actor</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript><span style=color:#000>Actor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>setState</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>entityStateParams</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><table>
<thead>
<tr>
<th>значение</th>
<th>описание</th>
</tr>
</thead>
<tbody>
<tr>
<td>setState</td>
<td>type: метод, обновление статуса сущности</td>
</tr>
<tr>
<td>entityStateParams</td>
<td>type: Object EntityStateParams</td>
</tr>
</tbody>
</table>
<hr>
<h3 id=объект-entitystateparams>объект EntityStateParams</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript>  <span style=color:#000>entityStateParams = </span><span style=color:#000;font-weight:700>{</span>
    <span style=color:#4e9a06>&#34;new_state&#34;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;&#34;</span>
    <span style=color:#4e9a06>&#34;attribute_values&#34;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000;font-weight:700>{}</span>
    <span style=color:#4e9a06>&#34;settings_value&#34;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000;font-weight:700>{}</span>
    <span style=color:#4e9a06>&#34;storage_save&#34;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>true</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><table>
<thead>
<tr>
<th>значение</th>
<th>описание</th>
</tr>
</thead>
<tbody>
<tr>
<td>new_state</td>
<td>type: *string, наименование статуса</td>
</tr>
<tr>
<td>attribute_values</td>
<td>type: Object, новое состяние аттрибутов сущности</td>
</tr>
<tr>
<td>settings_value</td>
<td>type: Object, новое состояние настроек сущности</td>
</tr>
<tr>
<td>storage_save</td>
<td>type: boolean, признак записи нового состояния в бд</td>
</tr>
</tbody>
</table>
<hr>
<h3 id=пример-кода>пример кода</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript><span style=color:#8f5902;font-style:italic># cgminer
</span><span style=color:#8f5902;font-style:italic># ##################################
</span><span style=color:#8f5902;font-style:italic></span>
<span style=color:#000>ifError</span> <span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>(res)-&gt;</span>
  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#ce5c00;font-weight:700>!</span><span style=color:#000>res</span> <span style=color:#ce5c00;font-weight:700>||</span> <span style=color:#000>res</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>error</span> <span style=color:#ce5c00;font-weight:700>||</span> <span style=color:#000>res</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87>Error</span>

<span style=color:#000>checkStatus</span> <span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>-&gt;</span>
  <span style=color:#000>stats = </span><span style=color:#000>Miner</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>stats</span><span style=color:#000;font-weight:700>()</span>
  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>ifError</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>stats</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#000>Actor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>setState</span>
      <span style=color:#4e9a06>&#39;new_state&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;ERROR&#39;</span>
    <span style=color:#204a87;font-weight:700>return</span>
  <span style=color:#000>p = </span><span style=color:#000>JSON</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>parse</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>stats</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>result</span><span style=color:#000;font-weight:700>)</span>
  <span style=color:#000>print</span> <span style=color:#000>p</span>

<span style=color:#000>checkSum</span> <span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>-&gt;</span>
  <span style=color:#000>summary = </span><span style=color:#000>Miner</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>summary</span><span style=color:#000;font-weight:700>()</span>
  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>ifError</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>summary</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#000>Actor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>setState</span>
      <span style=color:#4e9a06>&#39;new_state&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;ERROR&#39;</span>
    <span style=color:#204a87;font-weight:700>return</span>
  <span style=color:#000>p = </span><span style=color:#000>JSON</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>parse</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>summary</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>result</span><span style=color:#000;font-weight:700>)</span>
  <span style=color:#000>print</span> <span style=color:#000>p</span>

<span style=color:#000>entityAction = </span><span style=color:#000>(entityId, actionName)-&gt;</span>
  <span style=color:#204a87;font-weight:700>switch</span> <span style=color:#000>actionName</span>
    <span style=color:#204a87;font-weight:700>when</span> <span style=color:#4e9a06>&#39;CHECK&#39;</span> <span style=color:#204a87;font-weight:700>then</span> <span style=color:#000>checkStatus</span><span style=color:#000;font-weight:700>()</span>
    <span style=color:#204a87;font-weight:700>when</span> <span style=color:#4e9a06>&#39;SUM&#39;</span> <span style=color:#204a87;font-weight:700>then</span> <span style=color:#000>checkSum</span><span style=color:#000;font-weight:700>()</span>
</code></pre></div>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-2cd4f07024ce46a2072e53614567c7fb>3.4 - CPU</h1>
<figure>
<img src=/smart-home/cpuspeed1.png>
</figure>
<p> </p>
<p> </p>
<p>В системе <strong>Smart Home</strong> присутствует плагин &ldquo;cpuspeed&rdquo;, который обеспечивает отображение параметров CPU. Плагин предоставляет
доступ к следующим параметрам:</p>
<ol>
<li>
<p><code>cores</code>: Этот параметр позволяет получить информацию о количестве ядер процессора. Он возвращает число, указывающее на
общее количество ядер CPU.</p>
</li>
<li>
<p><code>mhz</code>: Данный параметр предоставляет информацию о текущей частоте процессора. Он возвращает значение в мегагерцах (MHz)
и указывает текущую работающую частоту процессора.</p>
</li>
<li>
<p><code>all</code>: Параметр <code>all</code> предоставляет информацию о средне взвешанной загрузке процессора в процентах</p>
</li>
<li>
<p><code>load_min</code>: Этот параметр отображает минимальную нагрузку процессора за определенный период времени. Он позволяет
получить информацию о минимальной нагрузке CPU и может быть полезным для мониторинга и анализа нагрузки на процессор.</p>
</li>
<li>
<p><code>load_max</code>: Параметр <code>load_max</code> предоставляет информацию о максимальной нагрузке процессора за определенный период
времени. Он позволяет получить информацию о максимальной нагрузке CPU и может быть полезным для анализа производительности
системы.</p>
</li>
</ol>
<p>Пример использования плагина &ldquo;cpuspeed&rdquo; для получения параметров CPU:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>entity</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>entityManager</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>getEntity</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;cpuspeed.cpuspeed&#39;</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>cpuParams</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>entity</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>getAttributes</span><span style=color:#000;font-weight:700>()</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>cpuParams</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>cores</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>cpuParams</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>mhz</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>cpuParams</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>all</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>cpuParams</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>load_min</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>cpuParams</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>load_max</span><span style=color:#000;font-weight:700>);</span>
</code></pre></div><p>Вы можете использовать эти параметры для отображения и мониторинга информации о CPU в вашем проекте <strong>Smart Home</strong>.</p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-d57edab1df39efff0606d11217501497>3.5 - HDD</h1>
<figure>
<img src=/smart-home/hdd1.png>
</figure>
<p> </p>
<p> </p>
<p>В системе <strong>Smart Home</strong> присутствует плагин &ldquo;hdd&rdquo;, который обеспечивает отображение параметров жесткого диска. Этот плагин позволяет получать информацию о различных характеристиках жесткого диска. Вот некоторые из этих параметров:</p>
<ol>
<li>
<p><code>path</code>: Параметр <code>path</code> содержит путь к точке монтирования (mount point) жесткого диска.</p>
</li>
<li>
<p><code>fstype</code>: Параметр <code>fstype</code> указывает тип файловой системы, используемой на жестком диске.</p>
</li>
<li>
<p><code>total</code>: Параметр <code>total</code> отображает общий объем жесткого диска в байтах.</p>
</li>
<li>
<p><code>free</code>: Параметр <code>free</code> показывает свободное пространство на жестком диске в байтах.</p>
</li>
<li>
<p><code>used</code>: Параметр <code>used</code> указывает использованное пространство на жестком диске в байтах.</p>
</li>
<li>
<p><code>used_percent</code>: Параметр <code>used_percent</code> показывает процент использования пространства на жестком диске.</p>
</li>
<li>
<p><code>inodes_total</code>: Параметр <code>inodes_total</code> отображает общее количество инодов (inode) на жестком диске.</p>
</li>
<li>
<p><code>inodes_used</code>: Параметр <code>inodes_used</code> указывает количество использованных инодов на жестком диске.</p>
</li>
<li>
<p><code>inodes_free</code>: Параметр <code>inodes_free</code> показывает количество свободных инодов на жестком диске.</p>
</li>
<li>
<p><code>inodes_used_percent</code>: Параметр <code>inodes_used_percent</code> указывает процент использования инодов на жестком диске.</p>
</li>
</ol>
<p>Кроме того, плагин &ldquo;hdd&rdquo; имеет опцию настроек <code>mount_point</code>, которая позволяет указать точку монтирования для отображения параметров конкретного жесткого диска.</p>
<p>Пример использования плагина &ldquo;hdd&rdquo; для получения параметров жесткого диска:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>entity</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>entityManager</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>getEntity</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;hdd.hdd1&#39;</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>hddParams</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>entity</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>getAttributes</span><span style=color:#000;font-weight:700>()</span>
<span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>hddSettings</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>entity</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>getSettings</span><span style=color:#000;font-weight:700>()</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>hddSettings</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>mount_point</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>hddParams</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>path</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>hddParams</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>fstype</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>hddParams</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>total</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>hddParams</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>free</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>hddParams</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>used</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>hddParams</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>used_percent</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>hddParams</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>inodes_total</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>hddParams</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>inodes_used</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>hddParams</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>inodes_free</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>hddParams</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>inodes_used_percent</span><span style=color:#000;font-weight:700>);</span>
</code></pre></div><p>Вы можете использовать эти параметры для отображения информации о жестком диске в вашем проекте <strong>Smart Home</strong>.</p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-ad72d5bfe8ed58703be4f95c5433bbbb>3.6 - Memory</h1>
<figure>
<img src=/smart-home/ram1.png>
</figure>
<p> </p>
<p> </p>
<p>В системе <strong>Smart Home</strong> имеется плагин &ldquo;memory&rdquo;, который позволяет отображать параметры оперативной памяти (RAM). Этот плагин предоставляет доступ к следующим параметрам:</p>
<ol>
<li>
<p><code>total</code>: Параметр <code>total</code> отображает общий объем оперативной памяти системы в байтах.</p>
</li>
<li>
<p><code>free</code>: Параметр <code>free</code> указывает на свободную оперативную память в байтах.</p>
</li>
<li>
<p><code>used_percent</code>: Параметр <code>used_percent</code> показывает процент использования оперативной памяти.</p>
</li>
</ol>
<p>Пример использования плагина &ldquo;memory&rdquo; для получения параметров оперативной памяти:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>entity</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>entityManager</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>getEntity</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;memory.memory&#39;</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>ramParams</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>entity</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>getAttributes</span><span style=color:#000;font-weight:700>()</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ramParams</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>total</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ramParams</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>free</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ramParams</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>used_percent</span><span style=color:#000;font-weight:700>);</span>
</code></pre></div><p>Вы можете использовать эти параметры для отображения информации об оперативной памяти в вашем проекте <strong>Smart Home</strong>.</p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-646b43ce7e0c9ecd76b7e1b081534840>3.7 - Memory app</h1>
<figure>
<img src=/smart-home/memory_app.png>
</figure>
<p> </p>
<p> </p>
<p>В системе <strong>Smart Home</strong> присутствует плагин &ldquo;memory_app&rdquo;, который предоставляет отображение параметров памяти приложения.
Этот плагин позволяет получать информацию о различных характеристиках памяти приложения. Вот некоторые из этих параметров:</p>
<ol>
<li>
<p><code>alloc</code>: Параметр <code>alloc</code> отображает количество выделенной памяти для приложения в байтах. Он указывает текущее значение
выделенной памяти.</p>
</li>
<li>
<p><code>heap_alloc</code>: Параметр <code>heap_alloc</code> показывает количество выделенной кучи (heap) памяти для приложения в байтах. Это
значение указывает текущее выделение памяти в куче.</p>
</li>
<li>
<p><code>total_alloc</code>: Параметр <code>total_alloc</code> указывает общее количество выделенной памяти для приложения с момента его запуска
в байтах. Он отражает общий объем памяти, выделенный приложению.</p>
</li>
<li>
<p><code>sys</code>: Параметр <code>sys</code> показывает количество системной памяти, используемой приложением. Он указывает текущее значение
использования системной памяти.</p>
</li>
<li>
<p><code>num_gc</code>: Параметр <code>num_gc</code> отображает количество сборок мусора (garbage collection), которые произошли с момента
запуска приложения.</p>
</li>
<li>
<p><code>last_gc</code>: Параметр <code>last_gc</code> указывает время последней сборки мусора (garbage collection). Он позволяет получить
информацию о времени последней проведенной сборки мусора в приложении.</p>
</li>
</ol>
<p>Пример использования плагина &ldquo;memory_app&rdquo; для получения параметров памяти приложения:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>entity</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>entityManager</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>getEntity</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;memory.memory&#39;</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>memoryParams</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>entity</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>getAttributes</span><span style=color:#000;font-weight:700>()</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>memoryParams</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>alloc</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>memoryParams</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>heap_alloc</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>memoryParams</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>total_alloc</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>memoryParams</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>sys</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>memoryParams</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>num_gc</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>memoryParams</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>last_gc</span><span style=color:#000;font-weight:700>);</span>
</code></pre></div><p>Вы можете использовать эти параметры для отображения информации о памяти приложения в вашем проекте <strong>Smart Home</strong>.</p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-95c950e340c5f9306b492b322325c66d>3.8 - Moon</h1>
<figure>
<img src=/smart-home/moon1.png>
</figure>
<p> </p>
<p> </p>
<p>В системе <strong>Smart Home</strong> присутствует плагин &ldquo;moon&rdquo;, который позволяет отображать различные параметры, связанные с фазами луны и ее положением на небе. Этот плагин предоставляет доступ к следующим параметрам:</p>
<ol>
<li>
<p><code>horizonState</code>: Параметр <code>horizonState</code> указывает состояние луны относительно горизонта. Это может быть &ldquo;aboveHorizon&rdquo; (над горизонтом) или &ldquo;belowHorizon&rdquo; (под горизонтом).</p>
</li>
<li>
<p><code>phase</code>: Параметр <code>phase</code> отображает текущую фазу луны. Например, &ldquo;new_moon&rdquo; (новолуние), &ldquo;waxing_crescent&rdquo; (растущая полумесяц), &ldquo;first_quarter&rdquo; (первая четверть), &ldquo;waxing_gibbous&rdquo; (растущая луна), &ldquo;full_moon&rdquo; (полнолуние), &ldquo;waning_gibbous&rdquo; (убывающая луна), &ldquo;third_quarter&rdquo; (третья четверть), &ldquo;waning_crescent&rdquo; (убывающая полумесяц).</p>
</li>
<li>
<p><code>azimuth</code>: Параметр <code>azimuth</code> указывает азимутное положение луны в градусах.</p>
</li>
<li>
<p><code>elevation</code>: Параметр <code>elevation</code> отображает угол возвышения луны над горизонтом.</p>
</li>
<li>
<p><code>aboveHorizon</code>: Параметр <code>aboveHorizon</code> указывает, находится ли луна над горизонтом (true/false).</p>
</li>
<li>
<p><code>belowHorizon</code>: Параметр <code>belowHorizon</code> указывает, находится ли луна под горизонтом (true/false).</p>
</li>
</ol>
<p>Кроме того, плагин &ldquo;moon&rdquo; имеет настройки <code>lat</code> и <code>lon</code>, которые позволяют указать широту и долготу для определения положения луны на небе.</p>
<p>Пример использования плагина &ldquo;moon&rdquo; для получения параметров луны:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>entity</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>entityManager</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>getEntity</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;moon.moon1&#39;</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>moonParams</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>entity</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>getAttributes</span><span style=color:#000;font-weight:700>()</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>moonParams</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>horizonState</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>moonParams</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>phase</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>moonParams</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>azimuth</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>moonParams</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>elevation</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>moonParams</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>aboveHorizon</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>moonParams</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>belowHorizon</span><span style=color:#000;font-weight:700>);</span>
</code></pre></div><p>Вы можете использовать эти параметры для отображения информации о луне в вашем проекте <strong>Smart Home</strong>.</p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-75a67472ccb2a758f48c263d48be08d3>3.9 - MQTT</h1>
<p>Плагин &ldquo;mqtt&rdquo; является расширенной версией плагина &ldquo;sensor&rdquo; и предоставляет возможность работы с протоколом MQTT.
Вот некоторые настройки, доступные для плагина &ldquo;mqtt&rdquo;:</p>
<ol>
<li><code>subscribe_topic</code>: Топик MQTT, на который выполняется подписка для получения данных.</li>
<li><code>mqtt_login</code>: Логин для аутентификации при подключении к MQTT-брокеру.</li>
<li><code>mqtt_pass</code>: Пароль для аутентификации при подключении к MQTT-брокеру.</li>
</ol>
<p>Эти настройки позволяют задать параметры подключения к MQTT-брокеру и определить топик, на который будет выполняться подписка
для получения данных. Таким образом, плагин &ldquo;mqtt&rdquo; обеспечивает интеграцию с MQTT-сообщениями, что позволяет получать данные
с устройств, использующих этот протокол, и использовать их в системе автоматизации или других компонентах.</p>
<p>Плагин &ldquo;sensor&rdquo; также реализует JavaScript-обработчик (handler) под названием <code>entityAction</code>. Этот обработчик предназначен
для обработки действий, связанных с устройствами типа &ldquo;entity&rdquo; на основе плагина &ldquo;sensor&rdquo;.</p>
<p>Пример реализации обработчика <code>entityAction</code>:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#000>entityAction</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>entityId</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>actionName</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>=&gt;</span> <span style=color:#000;font-weight:700>{</span>
  <span style=color:#8f5902;font-style:italic>// Код обработки действия
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#000;font-weight:700>};</span>
</code></pre></div><p>Также реализует JavaScript-обработчик (handler) под названием <code>mqttEvent</code>. Этот обработчик предназначен
для обработки действий, связанных с устройствами типа &ldquo;entity&rdquo; на основе плагина &ldquo;sensor&rdquo;.</p>
<p>Пример реализации обработчика <code>mqttEvent</code>:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#000>mqttEvent</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>entityId</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>actionName</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>=&gt;</span> <span style=color:#000;font-weight:700>{</span>
  <span style=color:#8f5902;font-style:italic>// Код обработки действия
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#000;font-weight:700>};</span>
</code></pre></div><p>Пример использования обработчика mqttEvent:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript><span style=color:#000>mqttEvent = </span><span style=color:#000>-&gt;</span>
  <span style=color:#8f5902;font-style:italic>#print &#39;---mqtt new event from plug---&#39;
</span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>!</span><span style=color:#000>message</span> <span style=color:#ce5c00;font-weight:700>||</span> <span style=color:#000>message</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>topic</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>includes</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;/set&#39;</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#204a87;font-weight:700>return</span>
  <span style=color:#000>payload = </span><span style=color:#000>unmarshal</span> <span style=color:#000>message</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>payload</span>
  <span style=color:#000>attrs =
</span><span style=color:#000></span>    <span style=color:#4e9a06>&#39;consumption&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>payload</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>consumption</span>
    <span style=color:#4e9a06>&#39;linkquality&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>payload</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>linkquality</span>
    <span style=color:#4e9a06>&#39;power&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>payload</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>power</span>
    <span style=color:#4e9a06>&#39;state&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>payload</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>state</span>
    <span style=color:#4e9a06>&#39;temperature&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>payload</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>temperature</span>
    <span style=color:#4e9a06>&#39;voltage&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>payload</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>voltage</span>
  <span style=color:#000>Actor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>setState</span>
    <span style=color:#4e9a06>&#39;new_state&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>payload</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>state</span>
    <span style=color:#4e9a06>&#39;attribute_values&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>attrs</span>
</code></pre></div>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-98e5f3c64adb1e62039387bca695fb54>3.10 - Node</h1>
<p>Не законченная статья</p>
<h3 id=настройка>Настройка:</h3>
<h3 id=команды>Команды:</h3>
<ul>
<li>произвольный набор</li>
</ul>
<h3 id=атрибуты>Атрибуты</h3>
<ul>
<li>произвольный набор</li>
</ul>
<h3 id=статус>Статус</h3>
<ul>
<li>произвольный набор</li>
</ul>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-25150d443099ad5064f1a3a39214945d>3.11 - Отправка сообщений</h1>
<p>В системе есть плагин под названием «notifr», который предоставляет возможности уведомлений. Он поддерживает методы отправки уведомлений по различным каналам, включая SMS, push-уведомления, электронную почту, Telegram и уведомления HTML5.</p>
<p>Вот поддерживаемые методы уведомления, предоставляемые плагином notifr:</p>
<p>SMS: позволяет отправлять SMS-уведомления.
Push: позволяет отправлять push-уведомления на мобильные устройства.
Электронная почта: поддерживает отправку уведомлений по электронной почте.
Telegram: Предоставляет возможность отправлять уведомления через мессенджер Telegram.
Уведомления HTML5: позволяет отображать уведомления с использованием возможностей HTML5.</p>
<h3 id=javascript-свойства>javascript свойства</h3>
<hr>
<h3 id=новое-сообщение>Новое сообщение</h3>
<p>создает объект сообщения</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript>  <span style=color:#000>msg = </span><span style=color:#000>notifr</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>newMessage</span><span style=color:#000;font-weight:700>();</span>
</code></pre></div><table>
<thead>
<tr>
<th>значение</th>
<th>описание</th>
</tr>
</thead>
<tbody>
<tr>
<td>newMessage()</td>
<td>метод</td>
</tr>
<tr>
<td>msg</td>
<td>type: Object <a href=#%D0%BE%D0%B1%D1%8A%D0%B5%D0%BA%D1%82-message>Message</a></td>
</tr>
</tbody>
</table>
<hr>
<h3 id=отправка-сообщения>отправка сообщения</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript>  <span style=color:#000>notifr</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>send</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>msg</span><span style=color:#000;font-weight:700>);</span>
</code></pre></div><table>
<thead>
<tr>
<th>значение</th>
<th>описание</th>
</tr>
</thead>
<tbody>
<tr>
<td>send()</td>
<td>метод</td>
</tr>
<tr>
<td>msg</td>
<td>type: Object (Message)</td>
</tr>
</tbody>
</table>
<h3 id=объект-message>объект Message</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript>  <span style=color:#000>message = </span><span style=color:#000;font-weight:700>{</span>
  <span style=color:#000>from: </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#000;font-weight:700>,</span>
  <span style=color:#000>type: </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#000;font-weight:700>,</span>
  <span style=color:#000>attributes: </span><span style=color:#000;font-weight:700>{</span>
    <span style=color:#4e9a06>&#34;key&#34;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;vlue&#34;</span>
  <span style=color:#000;font-weight:700>}</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><table>
<thead>
<tr>
<th>значение</th>
<th>описание</th>
</tr>
</thead>
<tbody>
<tr>
<td>from</td>
<td>type: string</td>
</tr>
<tr>
<td>type</td>
<td>type: string</td>
</tr>
<tr>
<td>attributes</td>
<td>type: map[string]string</td>
</tr>
</tbody>
</table>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-db0e74844d4ec70b97b7eed2dcaa6fde>3.11.1 - Push уведомления</h1>
<p>Web push — это короткие сообщения, которые smart home отправляет в браузер, чтобы сообщить о какой-либо важной информации. Они показываются даже тем, кто ушел с сайта, и не требуют указания почты или телефона.</p>
<h3 id=настройка>Настройка</h3>
<ul>
<li>public key</li>
<li>private key</li>
</ul>
<h3 id=атрибуты>Атрибуты</h3>
<ul>
<li>userIDS</li>
<li>title</li>
<li>body</li>
</ul>
<h3 id=javascript-свойства>javascript свойства</h3>
<hr>
<h3 id=новое-сообщение>Новое сообщение</h3>
<p>создает объект сообщения</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript><span style=color:#000>msg = </span><span style=color:#000>notifr</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>newMessage</span><span style=color:#000;font-weight:700>();</span>
<span style=color:#000>msg.type = </span><span style=color:#4e9a06>&#39;webpush&#39;</span><span style=color:#000;font-weight:700>;</span>
<span style=color:#000>msg.attributes = </span><span style=color:#000;font-weight:700>{</span>
  <span style=color:#4e9a06>&#39;userIDS&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;14&#39;</span><span style=color:#000;font-weight:700>,</span>
  <span style=color:#4e9a06>&#39;title&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;Lorem Ipsum is simply&#39;</span><span style=color:#000;font-weight:700>,</span>
  <span style=color:#4e9a06>&#39;body&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum&#39;</span>
<span style=color:#000;font-weight:700>};</span>

</code></pre></div><table>
<thead>
<tr>
<th>значение</th>
<th>описание</th>
</tr>
</thead>
<tbody>
<tr>
<td>newMessage()</td>
<td>метод</td>
</tr>
<tr>
<td>msg</td>
<td>type: Object (Message)</td>
</tr>
</tbody>
</table>
<hr>
<h3 id=пример-кода>пример кода</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript><span style=color:#8f5902;font-style:italic># webpush
</span><span style=color:#8f5902;font-style:italic># ##################################
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>sendMsg</span> <span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>()-&gt;</span>
  <span style=color:#000>msg = </span><span style=color:#000>notifr</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>newMessage</span><span style=color:#000;font-weight:700>();</span>
  <span style=color:#000>msg.type = </span><span style=color:#4e9a06>&#39;webpush&#39;</span><span style=color:#000;font-weight:700>;</span>
  <span style=color:#000>msg.attributes = </span><span style=color:#000;font-weight:700>{</span>
    <span style=color:#4e9a06>&#39;userIDS&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;14&#39;</span><span style=color:#000;font-weight:700>,</span>
    <span style=color:#4e9a06>&#39;title&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;Lorem Ipsum is simply&#39;</span><span style=color:#000;font-weight:700>,</span>
    <span style=color:#4e9a06>&#39;body&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum&#39;</span>
  <span style=color:#000;font-weight:700>};</span>
  <span style=color:#000>notifr</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>send</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>msg</span><span style=color:#000;font-weight:700>);</span>

<span style=color:#000>sendMsg</span><span style=color:#000;font-weight:700>()</span>
</code></pre></div>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-b9e7dc050746e93f66a3fcdc54072720>3.11.2 - HTML5 Уведомления</h1>
<p>HTML5 уведомление - это способ показать пользователю информацию на веб-странице без перезагрузки или перехода на другую страницу. Уведомления могут содержать текст, изображения, звук или видео и появляются в правом нижнем углу экрана. Уведомления на HTML5 используют API, который позволяет веб-приложениям отправлять уведомления браузеру с помощью JavaScript</p>
<h3 id=атрибуты>Атрибуты</h3>
<ul>
<li>userIDS</li>
<li>title</li>
<li>body</li>
</ul>
<h3 id=javascript-свойства>javascript свойства</h3>
<hr>
<h3 id=новое-сообщение>Новое сообщение</h3>
<p>создает объект сообщения</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript><span style=color:#000>msg = </span><span style=color:#000>notifr</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>newMessage</span><span style=color:#000;font-weight:700>();</span>
<span style=color:#000>msg.type = </span><span style=color:#4e9a06>&#39;html5_notify&#39;</span><span style=color:#000;font-weight:700>;</span>
<span style=color:#000>msg.attributes = </span><span style=color:#000;font-weight:700>{</span>
  <span style=color:#4e9a06>&#39;userIDS&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;14&#39;</span><span style=color:#000;font-weight:700>,</span>
  <span style=color:#4e9a06>&#39;title&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;Lorem Ipsum is simply&#39;</span><span style=color:#000;font-weight:700>,</span>
  <span style=color:#4e9a06>&#39;body&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum&#39;</span>
<span style=color:#000;font-weight:700>};</span>

</code></pre></div><table>
<thead>
<tr>
<th>значение</th>
<th>описание</th>
</tr>
</thead>
<tbody>
<tr>
<td>newMessage()</td>
<td>метод</td>
</tr>
<tr>
<td>msg</td>
<td>type: Object (Message)</td>
</tr>
</tbody>
</table>
<hr>
<h3 id=пример-кода>пример кода</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript><span style=color:#8f5902;font-style:italic># html5_notify
</span><span style=color:#8f5902;font-style:italic># ##################################
</span><span style=color:#8f5902;font-style:italic></span>
<span style=color:#000>sendMsg</span> <span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>()-&gt;</span>
  <span style=color:#000>msg = </span><span style=color:#000>notifr</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>newMessage</span><span style=color:#000;font-weight:700>();</span>
  <span style=color:#000>msg.type = </span><span style=color:#4e9a06>&#39;html5_notify&#39;</span><span style=color:#000;font-weight:700>;</span>
  <span style=color:#000>msg.attributes = </span><span style=color:#000;font-weight:700>{</span>
    <span style=color:#4e9a06>&#39;userIDS&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;14&#39;</span><span style=color:#000;font-weight:700>,</span>
    <span style=color:#4e9a06>&#39;title&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;Lorem Ipsum is simply&#39;</span><span style=color:#000;font-weight:700>,</span>
    <span style=color:#4e9a06>&#39;body&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum&#39;</span>
  <span style=color:#000;font-weight:700>};</span>
  <span style=color:#000>notifr</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>send</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>msg</span><span style=color:#000;font-weight:700>);</span>

<span style=color:#000>sendMsg</span><span style=color:#000;font-weight:700>()</span>
</code></pre></div>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-ffcf992bf86dcf75fc98ea391689be36>3.11.3 - Messagebird</h1>
<p>Отправка sms уведомлений через провайдера услуг оповещения <a href=https://messagebird.com>messagebird</a>. Для возможности
отправки сообщений потребуется регистрация в <a href=https://messagebird.com>messagebird</a>, и положительный баланс.</p>
<h3 id=настройка>Настройка</h3>
<ul>
<li>Access Key</li>
<li>Name</li>
</ul>
<h3 id=атрибуты>Атрибуты</h3>
<ul>
<li>Payment</li>
<li>Type</li>
<li>Amount</li>
</ul>
<h3 id=javascript-свойства>javascript свойства</h3>
<hr>
<h3 id=новое-сообщение>Новое сообщение</h3>
<p>создает объект сообщения</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript><span style=color:#000>msg = </span><span style=color:#000>notifr</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>newMessage</span><span style=color:#000;font-weight:700>();</span>
<span style=color:#000>msg.type = </span><span style=color:#4e9a06>&#39;messagebird&#39;</span><span style=color:#000;font-weight:700>;</span>
<span style=color:#000>msg.attributes = </span><span style=color:#000;font-weight:700>{</span>
  <span style=color:#4e9a06>&#39;phone&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;+79990000001&#39;</span><span style=color:#000;font-weight:700>,</span>
  <span style=color:#4e9a06>&#39;body&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;some text&#39;</span>
<span style=color:#000;font-weight:700>};</span>

</code></pre></div><table>
<thead>
<tr>
<th>значение</th>
<th>описание</th>
</tr>
</thead>
<tbody>
<tr>
<td>newMessage()</td>
<td>метод</td>
</tr>
<tr>
<td>msg</td>
<td>type: Object (Message)</td>
</tr>
</tbody>
</table>
<hr>
<h3 id=пример-кода>пример кода</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript><span style=color:#8f5902;font-style:italic># messagebird
</span><span style=color:#8f5902;font-style:italic># ##################################
</span><span style=color:#8f5902;font-style:italic></span>
<span style=color:#000>sendMsg</span> <span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>(body)-&gt;</span>
  <span style=color:#000>msg = </span><span style=color:#000>notifr</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>newMessage</span><span style=color:#000;font-weight:700>();</span>
  <span style=color:#000>msg.type = </span><span style=color:#4e9a06>&#39;messagebird&#39;</span><span style=color:#000;font-weight:700>;</span>
  <span style=color:#000>msg.attributes = </span><span style=color:#000;font-weight:700>{</span>
    <span style=color:#4e9a06>&#39;phone&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;+79990000001&#39;</span><span style=color:#000;font-weight:700>,</span>
    <span style=color:#4e9a06>&#39;body&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;some text&#39;</span>
  <span style=color:#000;font-weight:700>};</span>
  <span style=color:#000>notifr</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>send</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>msg</span><span style=color:#000;font-weight:700>);</span>
</code></pre></div>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-ae8769291a804111fe0f11577b37bb14>3.11.4 - Slack</h1>
<p>Отправка уведомлений в чат slack</p>
<h3 id=настройка>Настройка</h3>
<ul>
<li>Token</li>
<li>User name</li>
</ul>
<h3 id=javascript-свойства>javascript свойства</h3>
<hr>
<h3 id=новое-сообщение>Новое сообщение</h3>
<p>создает объект сообщения</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript><span style=color:#000>msg = </span><span style=color:#000>notifr</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>newMessage</span><span style=color:#000;font-weight:700>();</span>
<span style=color:#000>msg.type = </span><span style=color:#4e9a06>&#39;slack&#39;</span><span style=color:#000;font-weight:700>;</span>
<span style=color:#000>msg.attributes = </span><span style=color:#000;font-weight:700>{</span>
  <span style=color:#4e9a06>&#39;channel&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;#ch&#39;</span><span style=color:#000;font-weight:700>,</span>
  <span style=color:#4e9a06>&#39;text&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;some text&#39;</span>
<span style=color:#000;font-weight:700>};</span>

</code></pre></div><table>
<thead>
<tr>
<th>значение</th>
<th>описание</th>
</tr>
</thead>
<tbody>
<tr>
<td>newMessage()</td>
<td>метод</td>
</tr>
<tr>
<td>msg</td>
<td>type: Object (Message)</td>
</tr>
</tbody>
</table>
<hr>
<h3 id=пример-кода>пример кода</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript><span style=color:#8f5902;font-style:italic># slack
</span><span style=color:#8f5902;font-style:italic># ##################################
</span><span style=color:#8f5902;font-style:italic></span>
<span style=color:#000>sendMsg</span> <span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>(body)-&gt;</span>
  <span style=color:#000>msg = </span><span style=color:#000>notifr</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>newMessage</span><span style=color:#000;font-weight:700>();</span>
    <span style=color:#000>msg.type = </span><span style=color:#4e9a06>&#39;slack&#39;</span><span style=color:#000;font-weight:700>;</span>
    <span style=color:#000>msg.attributes = </span><span style=color:#000;font-weight:700>{</span>
      <span style=color:#4e9a06>&#39;channel&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;#ch&#39;</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#4e9a06>&#39;text&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;some text&#39;</span>
  <span style=color:#000;font-weight:700>};</span>
  <span style=color:#000>notifr</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>send</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>msg</span><span style=color:#000;font-weight:700>);</span>
</code></pre></div>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-3474b889257fbfc72d90e2b2883e468a>3.11.5 - Telegram</h1>
<p>Позволяет работать с telegram api, обеспечивая интерактивную обработку комманд от клиентов либо использовать
событийное оповещение. Система не имеет ограничение на количество ботов, один entity - один бот.</p>
<h3 id=настройка>Настройка</h3>
<ul>
<li>Token</li>
</ul>
<h3 id=команды>Команды:</h3>
<ul>
<li>произвольный набор</li>
</ul>
<h3 id=атрибуты>Атрибуты</h3>
<ul>
<li>произвольный набор</li>
</ul>
<h3 id=действия>Действия</h3>
<p>В системе зарезервированно три команды:</p>
<ul>
<li><strong>/start</strong> - подписаться на уведомления</li>
<li><strong>/quit</strong> - отписаться от уведомлений</li>
<li><strong>/help</strong> - вывод доступных команд</li>
</ul>
<p><strong>Action</strong> (действие) - должно наименоваться в нижнем регистре, без знаков &ldquo;/&rdquo;.
Кастомная команда в системе автоматически добавится в список доступных команд раздела <strong>/help</strong>.
Вызов кастомной команды с клиента следует производить в верхнем регистре <strong>/ACTION</strong> -> <strong>/action</strong></p>
<h3 id=javascript-свойства>javascript свойства</h3>
<hr>
<h3 id=новое-сообщение>Новое сообщение</h3>
<p>создает объект сообщения</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript><span style=color:#000>msg = </span><span style=color:#000>notifr</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>newMessage</span><span style=color:#000;font-weight:700>();</span>
<span style=color:#000>msg.type = </span><span style=color:#4e9a06>&#39;telegram&#39;</span><span style=color:#000;font-weight:700>;</span>
<span style=color:#000>msg.attributes = </span><span style=color:#000;font-weight:700>{</span>
  <span style=color:#4e9a06>&#39;name&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;clavicus&#39;</span><span style=color:#000;font-weight:700>,</span>
  <span style=color:#4e9a06>&#39;body&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;some text msg&#39;</span>
<span style=color:#000;font-weight:700>};</span>

</code></pre></div><table>
<thead>
<tr>
<th>значение</th>
<th>описание</th>
</tr>
</thead>
<tbody>
<tr>
<td>newMessage()</td>
<td>метод</td>
</tr>
<tr>
<td>msg</td>
<td>type: Object (Message)</td>
</tr>
</tbody>
</table>
<hr>
<h3 id=функция-telegramaction>функция telegramAction</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript><span style=color:#000>telegramAction = </span><span style=color:#000>(entityId, actionName)-&gt;</span>
</code></pre></div><table>
<thead>
<tr>
<th>значение</th>
<th>описание</th>
</tr>
</thead>
<tbody>
<tr>
<td>entityId</td>
<td>type: string, id сущности отправляющего сообщение</td>
</tr>
<tr>
<td>actionName</td>
<td>type: string, название действия, без символа &lsquo;/&rsquo; в верхнем регистре</td>
</tr>
</tbody>
</table>
<h3 id=пример-кода>пример кода</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript><span style=color:#8f5902;font-style:italic># telegram
</span><span style=color:#8f5902;font-style:italic># ##################################
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>telegramSendReport</span> <span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>-&gt;</span>
  <span style=color:#000>entities = </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;device.l3n1&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#39;device.l3n2&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#39;device.l3n3&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#39;device.l3n4&#39;</span><span style=color:#000;font-weight:700>]</span>
  <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>entityId</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>i</span> <span style=color:#204a87;font-weight:700>in</span> <span style=color:#000>entities</span>
    <span style=color:#000>entity = </span><span style=color:#000>entityManager</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>getEntity</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>entityId</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#000>attr = </span><span style=color:#000>entity</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>getAttributes</span><span style=color:#000;font-weight:700>()</span>
    <span style=color:#000>sendMsg</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>format</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>entityId</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>entity</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>state</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>name</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>attr</span><span style=color:#000;font-weight:700>))</span>
  
<span style=color:#000>telegramAction = </span><span style=color:#000>(entityId, actionName)-&gt;</span>
<span style=color:#204a87;font-weight:700>switch</span> <span style=color:#000>actionName</span>
    <span style=color:#204a87;font-weight:700>when</span> <span style=color:#4e9a06>&#39;CHECK&#39;</span> <span style=color:#204a87;font-weight:700>then</span> <span style=color:#000>telegramSendReport</span><span style=color:#000;font-weight:700>()</span>

<span style=color:#000>sendMsg</span> <span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>(body)-&gt;</span>
  <span style=color:#000>msg = </span><span style=color:#000>notifr</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>newMessage</span><span style=color:#000;font-weight:700>();</span>
  <span style=color:#000>msg.type = </span><span style=color:#4e9a06>&#39;telegram&#39;</span><span style=color:#000;font-weight:700>;</span>
  <span style=color:#000>msg.attributes = </span><span style=color:#000;font-weight:700>{</span>
    <span style=color:#4e9a06>&#39;name&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;clavicus&#39;</span><span style=color:#000;font-weight:700>,</span>
    <span style=color:#4e9a06>&#39;body&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>body</span>
  <span style=color:#000;font-weight:700>};</span>
  <span style=color:#000>notifr</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>send</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>msg</span><span style=color:#000;font-weight:700>);</span>
</code></pre></div>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-8d473157f65e8e52157febb9c1671a23>3.11.6 - Twilio</h1>
<p>Отправка sms уведомлений через провайдера услуг оповещения <a href=https://www.twilio.com/messaging>twilio</a>. Для возможности
отправки сообщений потребуется регистрация в <a href=https://www.twilio.com/messaging>twilio</a>, и положительный баланс.</p>
<h3 id=настройка>Настройка</h3>
<ul>
<li>Token</li>
<li>Sid</li>
<li>From</li>
</ul>
<h3 id=атрибуты>Атрибуты</h3>
<ul>
<li>Amount</li>
<li>Sid</li>
<li>Currency</li>
</ul>
<h3 id=javascript-свойства>javascript свойства</h3>
<hr>
<h3 id=новое-сообщение>Новое сообщение</h3>
<p>создает объект сообщения</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript><span style=color:#000>msg = </span><span style=color:#000>notifr</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>newMessage</span><span style=color:#000;font-weight:700>();</span>
<span style=color:#000>msg.type = </span><span style=color:#4e9a06>&#39;twilio&#39;</span><span style=color:#000;font-weight:700>;</span>
<span style=color:#000>msg.attributes = </span><span style=color:#000;font-weight:700>{</span>
  <span style=color:#4e9a06>&#39;phone&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;+79990000001&#39;</span><span style=color:#000;font-weight:700>,</span>
  <span style=color:#4e9a06>&#39;body&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;some text&#39;</span>
<span style=color:#000;font-weight:700>};</span>

</code></pre></div><table>
<thead>
<tr>
<th>значение</th>
<th>описание</th>
</tr>
</thead>
<tbody>
<tr>
<td>newMessage()</td>
<td>метод</td>
</tr>
<tr>
<td>msg</td>
<td>type: Object (Message)</td>
</tr>
</tbody>
</table>
<hr>
<h3 id=пример-кода>пример кода</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript><span style=color:#8f5902;font-style:italic># twilio
</span><span style=color:#8f5902;font-style:italic># ##################################
</span><span style=color:#8f5902;font-style:italic></span>
<span style=color:#000>sendMsg</span> <span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>(body)-&gt;</span>
  <span style=color:#000>msg = </span><span style=color:#000>notifr</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>newMessage</span><span style=color:#000;font-weight:700>();</span>
  <span style=color:#000>msg.type = </span><span style=color:#4e9a06>&#39;twilio&#39;</span><span style=color:#000;font-weight:700>;</span>
  <span style=color:#000>msg.attributes = </span><span style=color:#000;font-weight:700>{</span>
    <span style=color:#4e9a06>&#39;phone&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;+79990000001&#39;</span><span style=color:#000;font-weight:700>,</span>
    <span style=color:#4e9a06>&#39;body&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;some text&#39;</span>
  <span style=color:#000;font-weight:700>};</span>
  <span style=color:#000>notifr</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>send</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>msg</span><span style=color:#000;font-weight:700>);</span>
</code></pre></div>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-56027f5b7f86e356eca9778287b4e9b7>3.11.7 - Шаблон сообщения</h1>
<p><strong>Template</strong> (Шаблон) - инструмент для заполнения и рассылки готовых сообщений.</p>
<p>преимущества:</p>
<ul>
<li>чистый код</li>
<li>разные шаблоны для разных типов</li>
<li>удобный вызов</li>
</ul>
<h3 id=javascript-свойства>javascript свойства</h3>
<hr>
<h3 id=генерация-сообщения-из-шаблона>Генерация сообщения из шаблона</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript>  <span style=color:#000>tpl = </span><span style=color:#000>template</span>
    <span style=color:#000;font-weight:700>.</span><span style=color:#000>render</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>name</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>params</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><table>
<thead>
<tr>
<th>значение</th>
<th>описание</th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>type: string, название шаблона</td>
</tr>
<tr>
<td>params</td>
<td>type: Object, параметры шаблона, пример: {&lsquo;key&rsquo;:&lsquo;val&rsquo;}</td>
</tr>
<tr>
<td>tpl</td>
<td>type: string, сгенерированное сообщение, готовое к отправке</td>
</tr>
</tbody>
</table>
<h3 id=пример-кода>пример кода</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript><span style=color:#8f5902;font-style:italic># telegram
</span><span style=color:#8f5902;font-style:italic># ##################################
</span><span style=color:#8f5902;font-style:italic></span>

<span style=color:#000>sendMsg</span> <span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>(body)-&gt;</span>
  <span style=color:#000>tpl = </span><span style=color:#000>template</span>
    <span style=color:#000;font-weight:700>.</span><span style=color:#000>render</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;name&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>{</span><span style=color:#4e9a06>&#39;key&#39;</span><span style=color:#ce5c00;font-weight:700>:</span><span style=color:#4e9a06>&#39;val&#39;</span><span style=color:#000;font-weight:700>})</span>
  
  <span style=color:#000>msg = </span><span style=color:#000>notifr</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>newMessage</span><span style=color:#000;font-weight:700>();</span>
  <span style=color:#000>msg.type = </span><span style=color:#4e9a06>&#39;telegram&#39;</span><span style=color:#000;font-weight:700>;</span>
  <span style=color:#000>msg.attributes = </span><span style=color:#000;font-weight:700>{</span>
    <span style=color:#4e9a06>&#39;name&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;clavicus&#39;</span><span style=color:#000;font-weight:700>,</span>
    <span style=color:#4e9a06>&#39;body&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>tpl</span>
  <span style=color:#000;font-weight:700>};</span>
  <span style=color:#000>notifr</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>send</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>msg</span><span style=color:#000;font-weight:700>);</span>
</code></pre></div>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-c611e1f9047c1d78be304f536e42a8a9>3.12 - Scene</h1>
<p>Не законченная статья</p>
<h3 id=настройка>Настройка:</h3>
<h3 id=команды>Команды:</h3>
<ul>
<li>произвольный набор</li>
</ul>
<h3 id=атрибуты>Атрибуты</h3>
<ul>
<li>произвольный набор</li>
</ul>
<h3 id=статус>Статус</h3>
<ul>
<li>произвольный набор</li>
</ul>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-0a07d6aae278970d2834de3c5c8ba6fd>3.13 - Sensor</h1>
<p>Этот плагин &ldquo;sensor&rdquo; позволяет создавать и управлять различными типами датчиков, которые могут измерять и отслеживать
различные параметры окружающей среды, например температуру, влажность, освещенность и другие физические величины.</p>
<p>Создание абстрактного устройства на основе плагина &ldquo;sensor&rdquo; позволяет упростить процесс интеграции различных датчиков в
систему умного дома. Это предоставляет единый интерфейс для работы с разными типами датчиков и позволяет легко получать
данные от них, устанавливать их состояние и настраивать параметры работы.</p>
<p>Благодаря гибкости и универсальности плагина &ldquo;sensor&rdquo;, он подходит для большинства случаев использования, где требуется
работа с датчиками и получение данных о состоянии окружающей среды.</p>
<p>Плагин &ldquo;sensor&rdquo; также реализует JavaScript-обработчик (handler) под названием <code>entityAction</code>. Этот обработчик предназначен
для обработки действий, связанных с устройствами типа &ldquo;entity&rdquo; на основе плагина &ldquo;sensor&rdquo;.</p>
<p>Пример реализации обработчика <code>entityAction</code>:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#000>entityAction</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>entityId</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>actionName</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>=&gt;</span> <span style=color:#000;font-weight:700>{</span>
  <span style=color:#8f5902;font-style:italic>// Код обработки действия
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#000;font-weight:700>};</span>
</code></pre></div><p>В этом примере обработчик <code>entityAction</code> принимает два параметра: <code>entityId</code>, представляющий идентификатор устройства типа
&ldquo;entity&rdquo;, и <code>actionName</code>, представляющий имя действия, которое требуется выполнить.</p>
<p>Обработчик <code>entityAction</code> позволяет выполнять необходимую логику в ответ на действия, связанные с устройствами типа &ldquo;entity&rdquo;.
Внутри обработчика можно обращаться к функциям и методам плагина &ldquo;sensor&rdquo; для выполнения определенных операций, обновления
состояния устройств или взаимодействия с другими компонентами системы умного дома.</p>
<p>Пример использования обработчика <code>entityAction</code>:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#000>entityManager</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>callAction</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;sensor.sensor123&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;turnOn&#39;</span><span style=color:#000;font-weight:700>);</span>
</code></pre></div><p>В этом примере вызывается обработчик <code>entityAction</code> с идентификатором устройства &ldquo;sensor123&rdquo; и именем действия &ldquo;turnOn&rdquo;.
Внутри обработчика можно определить логику, связанную с выполнением требуемого действия для указанного устройства.</p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-07071769f18bcd958fb6807bfc051634>3.14 - Sun</h1>
<figure>
<img src=/smart-home/sun1.png>
</figure>
<p> </p>
<p> </p>
<p>Плагин &ldquo;sun&rdquo; позволяет получать информацию о текущем положении и времени солнца на заданных координатах (широта и долгота).
Он предоставляет различные параметры, связанные с положением солнца в течение дня, а также время восхода, заката, сумерек и
другие моменты. Состояние плагина может указывать, находится ли солнце над горизонтом или под ним.</p>
<p>Параметры:</p>
<ol>
<li><code>horizonState</code>: Состояние горизонта</li>
<li><code>phase</code>: Фаза солнца</li>
<li><code>azimuth</code>: Азимут солнца</li>
<li><code>elevation</code>: Высота солнца над горизонтом</li>
<li><code>sunrise</code>: Время восхода солнца</li>
<li><code>sunset</code>: Время заката солнца</li>
<li><code>sunriseEnd</code>: Время окончания восхода солнца</li>
<li><code>sunsetStart</code>: Время начала заката солнца</li>
<li><code>dawn</code>: Время рассвета</li>
<li><code>dusk</code>: Время сумерек</li>
<li><code>nauticalDawn</code>: Время навигационного рассвета</li>
<li><code>nauticalDusk</code>: Время навигационных сумерек</li>
<li><code>nightEnd</code>: Время окончания ночи</li>
<li><code>night</code>: Время ночи</li>
<li><code>goldenHourEnd</code>: Время окончания золотого часа</li>
<li><code>goldenHour</code>: Золотой час</li>
<li><code>solarNoon</code>: Солнечный полдень</li>
<li><code>nadir</code>: Надир (наименьшая высота солнца над горизонтом)</li>
</ol>
<p>Настройки:</p>
<ol>
<li><code>lat</code>: Широта (географическая широта)</li>
<li><code>lon</code>: Долгота (географическая долгота)</li>
</ol>
<p>Состояния:</p>
<ol>
<li><code>aboveHorizon</code>: Солнце находится над горизонтом</li>
<li><code>belowHorizon</code>: Солнце находится под горизонтом</li>
</ol>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-e2fff1dd07e3240d15c8fe3dda77a94e>3.15 - Triggers</h1>
<p>Плагин &ldquo;trigger&rdquo; является частью системы автоматизации и предоставляет различные типы триггеров, которые запускают
определенные сценарии в ответ на определенные события.</p>
<p>Смотрите раздел automation</p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-4183e9971a270328fbc64107268e1231>3.16 - Updater</h1>
<p>Плагин &ldquo;updated&rdquo; позволяет системе проверять наличие обновлений и предоставлять информацию о самой свежей версии.
Это полезно для пользователей, которые хотят быть в курсе последних обновлений и внедрять новые функции или исправления ошибок.
Он отображает следующие параметры:</p>
<ol>
<li><code>latest_version</code>: Номер последней доступной версии системы <strong>Smart Home</strong>.</li>
<li><code>latest_version_time</code>: Дата и время выпуска последней версии.</li>
<li><code>latest_download_url</code>: URL-адрес, по которому можно скачать последнюю версию системы.</li>
<li><code>last_check</code>: Дата и время последней проверки наличия обновлений.</li>
</ol>
<p>Пример использования плагина &ldquo;updated&rdquo;:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>entity</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>entityManager</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>getEntity</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;updater.updater&#39;</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>updateInfo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>entity</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>getAttributes</span><span style=color:#000;font-weight:700>()</span>

<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Latest version:&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>updateInfo</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>latest_version</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Latest version time:&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>updateInfo</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>latest_version_time</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Latest download URL:&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>updateInfo</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>latest_download_url</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Last check:&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>updateInfo</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>last_check</span><span style=color:#000;font-weight:700>);</span>
</code></pre></div>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-d3da1ca7f3ff8128df9b7a16dfe42fe6>3.17 - Uptime</h1>
<figure>
<img src=/smart-home/uptime1.png>
</figure>
<p> </p>
<p> </p>
<p>В системе <strong>Smart Home</strong> присутствует плагин &ldquo;uptime&rdquo;, который позволяет отображать параметры времени работы системы и приложения. Этот плагин предоставляет доступ к следующим параметрам:</p>
<ol>
<li>
<p><code>total</code>: Параметр <code>total</code> отображает общее время работы системы или приложения. Он указывает на количество времени, прошедшее с момента запуска.</p>
</li>
<li>
<p><code>app_started</code>: Параметр <code>app_started</code> указывает на время запуска приложения. Он показывает дату и время, когда приложение было запущено или перезапущено.</p>
</li>
</ol>
<p>Пример использования плагина &ldquo;uptime&rdquo; для получения параметров времени работы:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>entity</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>entityManager</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>getEntity</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;uptime.uptime&#39;</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>uptimeParams</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>entity</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>getAttributes</span><span style=color:#000;font-weight:700>()</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>uptimeParams</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>total</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>uptimeParams</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>app_started</span><span style=color:#000;font-weight:700>);</span>
</code></pre></div><p>Вы можете использовать эти параметры для отображения информации о времени работы системы или приложения в вашем проекте <strong>Smart Home</strong>.</p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-50e5123a4407c924b74ee84b77d3efbf>3.18 - Version</h1>
<p>Плагин &ldquo;version&rdquo; в системе предоставляет информацию о версии и сборке проекта. Он отображает следующие параметры:</p>
<ol>
<li><code>version</code>: Версия проекта.</li>
<li><code>revision</code>: Идентификатор ревизии (commit) в системе контроля версий.</li>
<li><code>revision_url</code>: URL-адрес, по которому можно просмотреть детали ревизии.</li>
<li><code>generated</code>: Дата и время генерации сборки проекта.</li>
<li><code>developers</code>: Список разработчиков, вовлеченных в проект.</li>
<li><code>build_num</code>: Номер сборки проекта.</li>
<li><code>docker_image</code>: Название Docker-образа, связанного с проектом.</li>
<li><code>go_version</code>: Версия языка программирования Go, используемого для разработки проекта.</li>
</ol>
<p>Плагин &ldquo;version&rdquo; предоставляет доступ к этой информации, что полезно для отслеживания версий и контроля процесса разработки.</p>
<p>Пример использования плагина &ldquo;version&rdquo;:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>entity</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>entityManager</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>getEntity</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;version.version&#39;</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>versionInfo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>entity</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>getAttributes</span><span style=color:#000;font-weight:700>()</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Project version:&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>versionInfo</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>version</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Revision:&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>versionInfo</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>revision</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Revision URL:&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>versionInfo</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>revision_url</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Generated:&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>versionInfo</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>generated</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Developers:&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>versionInfo</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>developers</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Build number:&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>versionInfo</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>build_num</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Docker image:&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>versionInfo</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>docker_image</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Go version:&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>versionInfo</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>go_version</span><span style=color:#000;font-weight:700>);</span>
</code></pre></div><p>Этот плагин позволяет получить актуальную информацию о версии проекта и использовать ее для различных целей, таких как отображение версии в пользовательском интерфейсе или логирование.</p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-64ab3664ef92bf81dcd376de6083e938>3.19 - Weather</h1>
<figure>
<img src=/smart-home/weather1.png>
</figure>
<p> </p>
<p> </p>
<p>В системе <strong>Smart Home</strong> присутствует базовый плагин &ldquo;weather&rdquo;, который предоставляет основу для реализации погодных плагинов.
Этот плагин обеспечивает доступ к информации о погоде, позволяя создавать и интегрировать специфичные погодные плагины для различных источников данных.</p>
<p>Плагин &ldquo;weather&rdquo; включает список состояний погоды, которые могут быть использованы для отображения текущих условий погоды.
Вот список состояний погоды, которые поддерживаются плагином &ldquo;weather&rdquo;:</p>
<ol>
<li><code>clearSky</code>: Чистое небо.</li>
<li><code>fair</code>: Ясно.</li>
<li><code>partlyCloudy</code>: Частичная облачность.</li>
<li><code>cloudy</code>: Облачно.</li>
<li><code>lightRainShowers</code>: Небольшие кратковременные дожди.</li>
<li><code>rainShowers</code>: Кратковременные дожди.</li>
<li><code>heavyRainShowers</code>: Сильные кратковременные дожди.</li>
<li><code>lightRainShowersAndThunder</code>: Небольшие кратковременные дожди и гроза.</li>
<li><code>rainShowersAndThunder</code>: Кратковременные дожди и гроза.</li>
<li><code>heavyRainShowersAndThunder</code>: Сильные кратковременные дожди и гроза.</li>
<li><code>lightSleetShowers</code>: Небольшие кратковременные метель и дождь.</li>
<li><code>sleetShowers</code>: Кратковременные метель и дождь.</li>
<li><code>heavySleetShowers</code>: Сильные кратковременные метель и дождь.</li>
<li><code>lightSleetShowersAndThunder</code>: Небольшие кратковременные метель, дождь и гроза.</li>
<li><code>sleetShowersAndThunder</code>: Кратковременные метель, дождь и гроза.</li>
<li><code>heavySleetShowersAndThunder</code>: Сильные кратковременные метель, дождь и гроза.</li>
<li><code>lightSnowShowers</code>: Небольшие кратковременные снегопады.</li>
<li><code>snowShowers</code>: Кратковременные снегопады.</li>
<li><code>heavySnowShowers</code>: Сильные кратковременные снегопады.</li>
<li><code>lightSnowShowersAndThunder</code>: Небольшие кратковременные снегопады и гроза.</li>
<li><code>snowShowersAndThunder</code>: Кратковременные снегопады и гроза.</li>
<li><code>heavySnowShowersAndThunder</code>: Сильные кратковременные снегопады и гроза.</li>
<li><code>lightRain</code>: Небольшой дождь.</li>
<li><code>rain</code>: Дождь.</li>
<li><code>heavyRain</code>: Сильный дождь.</li>
<li><code>lightRainAndThunder</code>: Небольшой дождь и гроза.</li>
<li><code>rainAndThunder</code>: Дождь и гроза.</li>
<li><code>heavyRainAndThunder</code>: Сильный дождь и гроза.</li>
<li><code>lightSleet</code>: Небольшая метель и дождь.</li>
<li><code>sleet</code>: Метель и дождь.</li>
<li><code>heavySleet</code>: Сильная метель и дож</li>
</ol>
<p>Плагин &ldquo;weather&rdquo; имеет базовые настройки, которые позволяют настроить его поведение и отображение погодной информации.
Вот описание базовых настроек плагина &ldquo;weather&rdquo;:</p>
<ol>
<li>
<p><code>lat</code>: Широта (latitude) - числовое значение, указывающее географическую широту местоположения для получения погодных
данных. Задание правильной широты позволяет получить актуальную погоду для указанного региона.</p>
</li>
<li>
<p><code>lon</code>: Долгота (longitude) - числовое значение, указывающее географическую долготу местоположения для получения погодных данных.
Задание правильной долготы помогает получить актуальную погоду для указанного региона.</p>
</li>
<li>
<p><code>theme</code>: Тема (theme) - параметр, определяющий внешний вид и стиль отображения погодных данных. Возможные значения
могут варьироваться в зависимости от реализации плагина и пользовательских настроек.</p>
</li>
<li>
<p><code>winter</code>: Зима (winter) - логическое значение, указывающее, какой вид погоды следует отображать для зимнего сезона.
Эта настройка позволяет адаптировать отображение погоды в зависимости от времени года.</p>
</li>
</ol>
<p>Пожалуйста, имейте в виду, что конкретные настройки и их значения могут отличаться в зависимости от реализации плагина &ldquo;weather&rdquo;.</p>
<p>Плагин &ldquo;weather&rdquo; реализует следующие базовые свойства для отображения погоды:</p>
<ol>
<li><code>main</code>: Основное описание погоды (например, &ldquo;Ясно&rdquo;, &ldquo;Облачно&rdquo;, &ldquo;Дождь&rdquo; и т.д.).</li>
<li><code>datetime</code>: Дата и время отображения погодных данных.</li>
<li><code>humidity</code>: Влажность воздуха.</li>
<li><code>max_temperature</code>: Максимальная температура.</li>
<li><code>min_temperature</code>: Минимальная температура.</li>
<li><code>pressure</code>: Атмосферное давление.</li>
<li><code>wind_bearing</code>: Направление ветра.</li>
<li><code>wind_speed</code>: Скорость ветра.</li>
</ol>
<p>Для каждого из пяти дней прогноза погоды (day1, day2, day3, day4, day5) также доступны аналогичные свойства, с добавлением
префикса соответствующего дня. Например, для первого дня прогноза доступны свойства <code>day1_main</code>, <code>day1_datetime</code>, <code>day1_humidity</code> и т.д.</p>
<p>Пример использования базовых свойств плагина &ldquo;weather&rdquo;:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>weatherPlugin</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>WeatherPlugin</span><span style=color:#000;font-weight:700>();</span>

<span style=color:#8f5902;font-style:italic>// Получение данных о текущей погоде
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>entity</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>entityManager</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>getEntity</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;weather_owm.weather1&#39;</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>currentWeather</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>entity</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>getAttributes</span><span style=color:#000;font-weight:700>()</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>currentWeather</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>main</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>currentWeather</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>datetime</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>currentWeather</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>humidity</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>currentWeather</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>max_temperature</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>currentWeather</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>min_temperature</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>currentWeather</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>pressure</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>currentWeather</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>wind_bearing</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>currentWeather</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>wind_speed</span><span style=color:#000;font-weight:700>);</span>

<span style=color:#8f5902;font-style:italic>// Получение данных о погоде на первый день прогноза
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>entity</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>entityManager</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>getEntity</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;weather_owm.weather1&#39;</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>day1Weather</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>entity</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>getAttributes</span><span style=color:#000;font-weight:700>()</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>day1Weather</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>day1_main</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>day1Weather</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>day1_datetime</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>day1Weather</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>day1_humidity</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>day1Weather</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>day1_max_temperature</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>day1Weather</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>day1_min_temperature</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>day1Weather</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>day1_pressure</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>day1Weather</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>day1_wind_bearing</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>day1Weather</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>day1_wind_speed</span><span style=color:#000;font-weight:700>);</span>
</code></pre></div><p>Обратите внимание, что конкретные свойства и их значения могут отличаться в зависимости от реализации плагина &ldquo;weather&rdquo; и источника погодных данных.</p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-4e6b5c2d397c558708e54206184aa268>3.19.1 - Met</h1>
<p>Weather forecast from met.no, delivered by the Norwegian Meteorological Institute.</p>
<p>Api version 2.0</p>
<p><a href=https://api.met.no/weatherapi/locationforecast/2.0/classic>https://api.met.no/weatherapi/locationforecast/2.0/classic</a></p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-b2af757d2aed5c975040722fd880df27>3.19.2 - Met</h1>
<p>Weather forecast from openweathermap.org</p>
<p>Api version 2.5</p>
<p><a href=https://api.openweathermap.org/data/2.5/onecall>https://api.openweathermap.org/data/2.5/onecall</a></p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-61b4e27718e29c034a152d0ee2706628>3.20 - Zigbee2mqtt</h1>
<p>Плагин &ldquo;Zigbee2mqtt&rdquo; является частью системы и предоставляет интеграцию между Zigbee-устройствами и MQTT-брокером. Этот
плагин позволяет контролировать и управлять Zigbee-устройствами через MQTT-сообщения.</p>
<p>В плагине &ldquo;Zigbee2mqtt&rdquo; реализован JavaScript-обработчик <code>zigbee2mqttEvent</code>, который не принимает параметры. Внутри
обработчика доступен объект <code>message</code>, представляющий информацию о полученном MQTT-сообщении.</p>
<p>Свойства объекта <code>message</code> включают:</p>
<ol>
<li><code>payload</code>: Значение сообщения, представленное в виде словаря (map), где ключи являются строками, а значения могут быть любого типа.</li>
<li><code>topic</code>: Топик MQTT-сообщения, указывающий на источник или назначение сообщения.</li>
<li><code>qos</code>: Уровень качества обслуживания (Quality of Service) MQTT-сообщения.</li>
<li><code>duplicate</code>: Флаг, указывающий, является ли сообщение дубликатом.</li>
<li><code>storage</code>: Объект <code>Storage</code>, предоставляющий доступ к хранилищу данных для кеширования и получения произвольных значений.</li>
<li><code>error</code>: Строка, содержащая информацию об ошибке, если таковая возникла при обработке сообщения.</li>
<li><code>success</code>: Булево значение, указывающее на успешное выполнение операции или обработку сообщения.</li>
<li><code>new_state</code>: Объект <code>Actor.StateParams</code>, представляющий новое состояние актора после выполнения операции.</li>
</ol>
<p>Пример использования обработчика <code>zigbee2mqttEvent</code>:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#204a87;font-weight:700>function</span> <span style=color:#000>zigbee2mqttEvent</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Received MQTT message:&#34;</span><span style=color:#000;font-weight:700>);</span>
    <span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Payload:&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>message</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>payload</span><span style=color:#000;font-weight:700>);</span>
    <span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Topic:&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>message</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>topic</span><span style=color:#000;font-weight:700>);</span>
    <span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;QoS:&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>message</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>qos</span><span style=color:#000;font-weight:700>);</span>
    <span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Duplicate:&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>message</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>duplicate</span><span style=color:#000;font-weight:700>);</span>

    <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>message</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>error</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
        <span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>error</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Error:&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>message</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>error</span><span style=color:#000;font-weight:700>);</span>
    <span style=color:#000;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>else</span> <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>message</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>success</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
        <span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Operation successful!&#34;</span><span style=color:#000;font-weight:700>);</span>
        <span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;New state:&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>message</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>new_state</span><span style=color:#000;font-weight:700>);</span>
    <span style=color:#000;font-weight:700>}</span>

    <span style=color:#8f5902;font-style:italic>// Доступ к хранилищу
</span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>value</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>message</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>storage</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>getByName</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;key&#34;</span><span style=color:#000;font-weight:700>);</span>
    <span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Value from storage:&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>value</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><p>Обработчик <code>zigbee2mqttEvent</code> может быть использован для обработки входящих MQTT-сообщений, а также для выполнения
дополнительных операций на основе полученных данных.</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript><span style=color:#000>zigbee2mqttEvent = </span><span style=color:#000>-&gt;</span>
<span style=color:#8f5902;font-style:italic>#print &#39;---mqtt new event from plug---&#39;
</span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>!</span><span style=color:#000>message</span> <span style=color:#ce5c00;font-weight:700>||</span> <span style=color:#000>message</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>topic</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>includes</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;/set&#39;</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#204a87;font-weight:700>return</span>
  <span style=color:#000>payload = </span><span style=color:#000>unmarshal</span> <span style=color:#000>message</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>payload</span>
  <span style=color:#000>attrs =
</span><span style=color:#000></span>    <span style=color:#4e9a06>&#39;consumption&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>payload</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>consumption</span>
    <span style=color:#4e9a06>&#39;linkquality&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>payload</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>linkquality</span>
    <span style=color:#4e9a06>&#39;power&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>payload</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>power</span>
    <span style=color:#4e9a06>&#39;state&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>payload</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>state</span>
    <span style=color:#4e9a06>&#39;temperature&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>payload</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>temperature</span>
    <span style=color:#4e9a06>&#39;voltage&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>payload</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>voltage</span>
  <span style=color:#000>Actor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>setState</span>
    <span style=color:#4e9a06>&#39;new_state&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>payload</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>state</span>
    <span style=color:#4e9a06>&#39;attribute_values&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>attrs</span>
</code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript><span style=color:#000>zigbee2mqttEvent = </span><span style=color:#000>-&gt;</span>
  <span style=color:#8f5902;font-style:italic>#print &#39;---mqtt new event from button---&#39;
</span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>!</span><span style=color:#000>message</span>
    <span style=color:#204a87;font-weight:700>return</span>
  <span style=color:#000>payload = </span><span style=color:#000>unmarshal</span> <span style=color:#000>message</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>payload</span>
  <span style=color:#000>attrs =
</span><span style=color:#000></span>    <span style=color:#4e9a06>&#39;battery&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>payload</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>battery</span>
    <span style=color:#4e9a06>&#39;linkquality&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>payload</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>linkquality</span>
    <span style=color:#4e9a06>&#39;voltage&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>payload</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>voltage</span>
  <span style=color:#000>state = </span><span style=color:#4e9a06>&#39;&#39;</span>
  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>payload</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>action</span>
    <span style=color:#000>attrs.action = </span><span style=color:#000>payload</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>action</span>
    <span style=color:#000>state = </span><span style=color:#000>payload</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>action</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#4e9a06>&#34;_action&#34;</span>
  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>payload</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>click</span>
    <span style=color:#000>attrs.click = </span><span style=color:#000>payload</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>click</span>
    <span style=color:#000>attrs.action = </span><span style=color:#4e9a06>&#34;&#34;</span>
    <span style=color:#000>state = </span><span style=color:#000>payload</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>click</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#4e9a06>&#34;_click&#34;</span>
  <span style=color:#000>Actor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>setState</span>
    <span style=color:#4e9a06>&#39;new_state&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>state</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>toUpperCase</span><span style=color:#000;font-weight:700>()</span>
    <span style=color:#4e9a06>&#39;attribute_values&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>attrs</span>
</code></pre></div>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-3d0aa008355dfb5e447bc3db96976c8e>3.21 - Zone</h1>
<p>Не законченная статья</p>
<h3 id=настройка>Настройка:</h3>
<h3 id=команды>Команды:</h3>
<ul>
<li>произвольный набор</li>
</ul>
<h3 id=атрибуты>Атрибуты</h3>
<ul>
<li>произвольный набор</li>
</ul>
<h3 id=статус>Статус</h3>
<ul>
<li>произвольный набор</li>
</ul>
</div>
</main>
</div>
</div>
<footer class="bg-dark py-5 row d-print-none">
<div class="container-fluid mx-sm-5">
<div class=row>
<div class="col-6 col-sm-4 text-xs-center order-sm-2">
</div>
<div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
<ul class="list-inline mb-0">
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub>
<a class=text-white target=_blank rel=noopener href=https://github.com/e154/smart-home aria-label=GitHub>
<i class="fab fa-github"></i>
</a>
</li>
</ul>
</div>
<div class="col-12 col-sm-4 text-center py-2 order-sm-2">
<small class=text-white>&copy; 2023 Разработано при поддержке <a href=http://e154.ru>e154.ru</a></small>
<div><small class="ml-1 text-white">Код лицензии <a href=https://github.com/e154/smart-home/blob/master/LICENSE>MIT</a> документы <a href=http://creativecommons.org/licenses/by/3.0/>CC BY 3.0</a></small></div>
</div>
</div>
</div>
</footer>
</div>
<script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js integrity=sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF crossorigin=anonymous></script>
<script src=/smart-home/js/tabpane-persist.js></script>
<script src=/smart-home/js/main.min.307d9740a83ff885dafd50af6ce4f79e2146b78e74ee078b11b627d0d02146a9.js integrity="sha256-MH2XQKg/+IXa/VCvbOT3niFGt4507geLEbYn0NAhRqk=" crossorigin=anonymous></script>
</body>
</html>